{"version":3,"sources":["layout/page.js"],"names":["View","Backbone","extend","el","className","_panelids","initialize","options","self","config","_","defaults","message_box_visible","message_box_content","message_box_class","show_inactivity_warning","inactivity_box_content","hide_panels","hide_masthead","Galaxy","modal","router","Router","masthead","center","CenterPanel","display","view","title","setWindowTitle","allow_title_display","active_tab","highlight","$el","attr","html","_template","$masthead","$","$center","$messagebox","$inactivebox","remove","css","replaceWith","append","frame","panels","each","panel_class_name","panel_id","charAt","toUpperCase","slice","panel_class","panel_instance","panel_el","toString","SidePanel","id","render","history","start","root","pushState","renderMessageBox","renderInactivityBox","renderPanels","_checkCommunicationServerOnline","content","level","addClass","toggle","show","removeClass","hide","verificationLink","text","panel","join","host","window","communication_server_host","port","communication_server_port","preferences","user","attributes","$chat_icon_element","indexOf","communication_server","ajax","url","success","error"],"mappings":"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","file":"../../scripts/layout/page.js","sourcesContent":["import Masthead from \"layout/masthead\";\nimport Panel from \"layout/panel\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport Utils from \"utils/utils\";\n\nvar View = Backbone.View.extend({\n    el: \"body\",\n    className: \"full-content\",\n    _panelids: [\"left\", \"right\"],\n\n    initialize: function(options) {\n        var self = this;\n        this.config = _.defaults(options.config || {}, {\n            message_box_visible: false,\n            message_box_content: \"\",\n            message_box_class: \"info\",\n            show_inactivity_warning: false,\n            inactivity_box_content: \"\",\n            hide_panels: false,\n            hide_masthead: false\n        });\n\n        // attach global objects, build mastheads\n        Galaxy.modal = this.modal = new Modal.View();\n        Galaxy.router = this.router = options.Router && new options.Router(self, options);\n        this.masthead = new Masthead.View(this.config);\n        this.center = new Panel.CenterPanel();\n\n        // display helper\n        Galaxy.display = this.display = view => {\n            if (view.title) {\n                Utils.setWindowTitle(view.title);\n                view.allow_title_display = false;\n            } else {\n                Utils.setWindowTitle();\n                view.allow_title_display = true;\n            }\n            if (view.active_tab) {\n                self.masthead.highlight(view.active_tab);\n            }\n            self.center.display(view);\n        };\n\n        // build page template\n        this.$el.attr(\"scroll\", \"no\");\n        this.$el.html(this._template());\n        this.$masthead = this.$(\"#masthead\");\n        this.$center = this.$(\"#center\");\n        this.$messagebox = this.$(\"#messagebox\");\n        this.$inactivebox = this.$(\"#inactivebox\");\n\n        // build components\n        if (this.config.hide_masthead) {\n            this.$masthead.remove();\n            this.$center.css(\"top\", 0);\n        } else {\n            this.$masthead.replaceWith(this.masthead.$el);\n        }\n        this.$center.append(this.center.$el);\n        this.$el.append(this.masthead.frame.$el);\n        this.$el.append(this.modal.$el);\n\n        // build panels\n        this.panels = {};\n        if (!this.config.hide_panels) {\n            _.each(this._panelids, panel_id => {\n                var panel_class_name = panel_id.charAt(0).toUpperCase() + panel_id.slice(1);\n                var panel_class = options[panel_class_name];\n                if (panel_class) {\n                    var panel_instance = new panel_class(self, options);\n                    var panel_el = self.$(`#${panel_id}`);\n                    self[panel_instance.toString()] = panel_instance;\n                    self.panels[panel_id] = new Panel.SidePanel({\n                        id: panel_id,\n                        el: panel_el,\n                        view: panel_instance\n                    });\n                    if (this.config.hide_masthead) {\n                        panel_el.css(\"top\", 0);\n                    }\n                }\n            });\n        }\n        this.render();\n\n        // start the router\n        if (this.router) {\n            Backbone.history.start({\n                root: Galaxy.root,\n                pushState: true\n            });\n        }\n    },\n\n    render: function() {\n        // TODO: Remove this line after select2 update\n        $(\".select2-hidden-accessible\").remove();\n        if (!this.config.hide_masthead) {\n            this.masthead.render();\n            this.renderMessageBox();\n            this.renderInactivityBox();\n        }\n        this.renderPanels();\n        this._checkCommunicationServerOnline();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox: function() {\n        if (this.config.message_box_visible) {\n            var content = this.config.message_box_content || \"\";\n            var level = this.config.message_box_class || \"info\";\n            this.$el.addClass(\"has-message-box\");\n            this.$messagebox\n                .attr(\"class\", `panel-${level}-message`)\n                .html(content)\n                .toggle(!!content)\n                .show();\n        } else {\n            this.$el.removeClass(\"has-message-box\");\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox: function() {\n        if (this.config.show_inactivity_warning) {\n            var content = this.config.inactivity_box_content || \"\";\n            var verificationLink = $(\"<a/>\")\n                .attr(\"href\", `${Galaxy.root}user/resend_verification`)\n                .text(\"Resend verification\");\n            this.$el.addClass(\"has-inactivity-box\");\n            this.$inactivebox\n                .html(`${content} `)\n                .append(verificationLink)\n                .toggle(!!content)\n                .show();\n        } else {\n            this.$el.removeClass(\"has-inactivity-box\");\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels: function() {\n        var self = this;\n        _.each(this._panelids, panel_id => {\n            var panel = self.panels[panel_id];\n            if (panel) {\n                panel.render();\n            } else {\n                self.$center.css(panel_id, 0);\n                self.$(`#${panel_id}`).hide();\n            }\n        });\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return [\n            `<div id=\"everything\">\n                <div id=\"background\"/>\n                <div id=\"masthead\"/>\n                <div id=\"messagebox\"/>\n                <div id=\"inactivebox\" class=\"panel-warning-message\" />\n                <div id=\"left\" />\n                <div id=\"center\" />\n                <div id=\"right\" />\n            </div>\n            <div id=\"dd-helper\" />`\n        ].join(\"\");\n    },\n\n    toString: function() {\n        return \"PageLayoutView\";\n    },\n\n    /** Check if the communication server is online and show the icon otherwise hide the icon */\n    _checkCommunicationServerOnline: function() {\n        var host = window.Galaxy.config.communication_server_host;\n        var port = window.Galaxy.config.communication_server_port;\n        var preferences = window.Galaxy.user.attributes.preferences;\n        var $chat_icon_element = $(\"#show-chat-online\");\n        /** Check if the user has deactivated the communication in it's personal settings */\n        if (preferences && [\"1\", \"true\"].indexOf(preferences.communication_server) != -1) {\n            // See if the configured communication server is available\n            $.ajax({\n                url: `${host}:${port}`\n            })\n                .success(data => {\n                    // enable communication only when a user is logged in\n                    if (window.Galaxy.user.id !== null) {\n                        if ($chat_icon_element.css(\"visibility\") === \"hidden\") {\n                            $chat_icon_element.css(\"visibility\", \"visible\");\n                        }\n                    }\n                })\n                .error(data => {\n                    // hide the communication icon if the communication server is not available\n                    $chat_icon_element.css(\"visibility\", \"hidden\");\n                });\n        } else {\n            $chat_icon_element.css(\"visibility\", \"hidden\");\n        }\n    }\n});\n\nexport default { View: View };\n"]}