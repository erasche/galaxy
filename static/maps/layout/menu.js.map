{"version":3,"sources":["layout/menu.js"],"names":["Backbone","_","Collection","extend","model","Model","defaults","visible","target","fetch","options","reset","extendedNavItem","add","render","id","title","url","tooltip","disabled","Galaxy","user","menu","load","type","callback","webhooks","$","document","ready","each","webhook","toJSON","activate","obj","icon","config","onclick","function","Function","page","masthead","collection","appendScriptStyle","get","cls","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","terms_url","push","biostar_url","unshift","biostar_url_redirect","userTab","allow_user_creation","noscratchbook","session_csrf_token","divider","Deferred","resolve","promise","Tab","View","initialize","setElement","_template","$link","$note","$menu","listenTo","events","remove","$el","removeClass","addClass","attr","css","visibility","set","_formatUrl","html","display","placement","show","off","on","hide","empty","append","_buildMenuItem","menuItem","e","preventDefault","frame","buildLink","label","root","_toggleClick","trigger","m","attributes","popover","content","window","setTimeout","indexOf","charAt"],"mappings":";;;;;;;QACYA,Q;;QACAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMZ;AACA;;AATA;AAWA,QAAIC,aAAaF,SAASE,UAAT,CAAoBC,MAApB,CAA2B;AACxCC,eAAOJ,SAASK,KAAT,CAAeF,MAAf,CAAsB;AACzBG,sBAAU;AACNC,yBAAS,IADH;AAENC,wBAAQ;AAFF;AADe,SAAtB,CADiC;AAOxCC,eAAO,eAASC,OAAT,EAAkB;AACrBA,sBAAUA,WAAW,EAArB;AACA,iBAAKC,KAAL;;AAEA;AACA;AACA;AACA,gBAAIC,kBAAkB,sDAAtB;AACA,iBAAKC,GAAL,CAASD,gBAAgBE,MAAhB,EAAT;;AAEA;AACA;AACA;AACA,iBAAKD,GAAL,CAAS;AACLE,oBAAI,UADC;AAELC,uBAAO,4BAAG,cAAH,CAFF;AAGLC,qBAAK,EAHA;AAILC,yBAAS,4BAAG,oBAAH;AAJJ,aAAT;;AAOA;AACA;AACA;AACA,iBAAKL,GAAL,CAAS;AACLE,oBAAI,UADC;AAELC,uBAAO,4BAAG,UAAH,CAFF;AAGLE,yBAAS,4BAAG,4BAAH,CAHJ;AAILC,0BAAU,CAACC,OAAOC,IAAP,CAAYN,EAJlB;AAKLE,qBAAK;AALA,aAAT;;AAQA;AACA;AACA;AACA,iBAAKJ,GAAL,CAAS;AACLE,oBAAI,eADC;AAELC,uBAAO,4BAAG,WAAH,CAFF;AAGLC,qBAAK,qBAHA;AAILC,yBAAS,4BAAG,oBAAH,CAJJ;AAKLC,0BAAU,CAACC,OAAOC,IAAP,CAAYN,EALlB;AAMLO,sBAAM,CACF;AACIN,2BAAO,4BAAG,sBAAH,CADX;AAEIC,yBAAK;AAFT,iBADE,EAKF;AACID,2BAAO,4BAAG,0BAAH,CADX;AAEIC,yBAAK,wBAFT;AAGIT,4BAAQ;AAHZ,iBALE,EAUF;AACIQ,2BAAO,4BAAG,sBAAH,CADX;AAEIC,yBAAK,qBAFT;AAGIT,4BAAQ;AAHZ,iBAVE;AAND,aAAT;;AAwBA;AACA;AACA;AACA,iBAAKK,GAAL,CAAS;AACLE,oBAAI,QADC;AAELC,uBAAO,4BAAG,aAAH,CAFF;AAGLC,qBAAK,eAHA;AAILC,yBAAS,4BAAG,4BAAH,CAJJ;AAKLI,sBAAM,CACF;AACIN,2BAAO,4BAAG,gBAAH,CADX;AAEIC,yBAAK;AAFT,iBADE,EAKF;AACID,2BAAO,4BAAG,WAAH,CADX;AAEIC,yBAAK;AAFT,iBALE,EASF;AACID,2BAAO,4BAAG,WAAH,CADX;AAEIC,yBAAK;AAFT,iBATE,EAaF;AACID,2BAAO,4BAAG,gBAAH,CADX;AAEIC,yBAAK;AAFT,iBAbE,EAiBF;AACID,2BAAO,4BAAG,OAAH,CADX;AAEIC,yBAAK;AAFT,iBAjBE;AALD,aAAT;;AA6BA;AACA;AACA;AACA,+BAASM,IAAT,CAAc;AACVC,sBAAM,UADI;AAEVC,0BAAU,kBAASC,QAAT,EAAmB;AACzBC,sBAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAM;AACpBH,iCAASI,IAAT,CAAc,iBAAS;AACnB,gCAAIC,UAAU3B,MAAM4B,MAAN,EAAd;AACA,gCAAID,QAAQE,QAAZ,EAAsB;AAClB,oCAAIC,MAAM;AACNnB,wCAAIgB,QAAQhB,EADN;AAENoB,0CAAMJ,QAAQK,MAAR,CAAeD,IAFf;AAGNlB,yCAAKc,QAAQK,MAAR,CAAenB,GAHd;AAINC,6CAASa,QAAQK,MAAR,CAAelB,OAJlB;AAKN;AACAmB,6CAASN,QAAQK,MAAR,CAAeE,QAAf,IAA2B,IAAIC,QAAJ,CAAaR,QAAQK,MAAR,CAAeE,QAA5B;AAN9B,iCAAV;;AASA;AACA,oCAAIlB,OAAOoB,IAAX,EAAiB;AACbpB,2CAAOoB,IAAP,CAAYC,QAAZ,CAAqBC,UAArB,CAAgC7B,GAAhC,CAAoCqB,GAApC;AACH,iCAFD,MAEO,IAAId,OAAOqB,QAAX,EAAqB;AACxBrB,2CAAOqB,QAAP,CAAgBC,UAAhB,CAA2B7B,GAA3B,CAA+BqB,GAA/B;AACH;;AAED;AACA,gDAAMS,iBAAN,CAAwBZ,OAAxB;AACH;AACJ,yBAtBD;AAuBH,qBAxBD;AAyBH;AA5BS,aAAd;;AA+BA;AACA;AACA;AACA,gBAAIX,OAAOC,IAAP,CAAYuB,GAAZ,CAAgB,UAAhB,CAAJ,EAAiC;AAC7B,qBAAK/B,GAAL,CAAS;AACLE,wBAAI,OADC;AAELC,2BAAO,4BAAG,OAAH,CAFF;AAGLC,yBAAK,OAHA;AAILC,6BAAS,4BAAG,wBAAH,CAJJ;AAKL2B,yBAAK;AALA,iBAAT;AAOH;;AAED;AACA;AACA;AACA,gBAAIC,UAAU;AACV/B,oBAAI,MADM;AAEVC,uBAAO,4BAAG,MAAH,CAFG;AAGVE,yBAAS,4BAAG,iCAAH,CAHC;AAIVI,sBAAM,CACF;AACIN,2BAAO,4BAAG,SAAH,CADX;AAEIC,yBAAKP,QAAQqC,WAFjB;AAGIvC,4BAAQ;AAHZ,iBADE,EAMF;AACIQ,2BAAO,4BAAG,QAAH,CADX;AAEIC,yBAAKP,QAAQsC,UAFjB;AAGIxC,4BAAQ;AAHZ,iBANE,EAWF;AACIQ,2BAAO,4BAAG,eAAH,CADX;AAEIC,yBAAKP,QAAQuC,aAFjB;AAGIzC,4BAAQ;AAHZ,iBAXE,EAgBF;AACIQ,2BAAO,4BAAG,QAAH,CADX;AAEIC,yBAAKP,QAAQwC,eAFjB;AAGI1C,4BAAQ;AAHZ,iBAhBE,EAqBF;AACIQ,2BAAO,4BAAG,MAAH,CADX;AAEIC,yBAAKP,QAAQyC,QAFjB;AAGI3C,4BAAQ;AAHZ,iBArBE,EA0BF;AACIQ,2BAAO,4BAAG,oBAAH,CADX;AAEIC,yBAAKP,QAAQ0C,YAFjB;AAGI5C,4BAAQ;AAHZ,iBA1BE,EA+BF;AACIQ,2BAAO,4BAAG,mBAAH,CADX;AAEIC,yBAAK;AAFT,iBA/BE;AAJI,aAAd;AAyCA,gBAAIP,QAAQ2C,SAAZ,EAAuB;AACnBP,wBAAQxB,IAAR,CAAagC,IAAb,CAAkB;AACdtC,2BAAO,4BAAG,sBAAH,CADO;AAEdC,yBAAKP,QAAQ2C,SAFC;AAGd7C,4BAAQ;AAHM,iBAAlB;AAKH;AACD,gBAAIE,QAAQ6C,WAAZ,EAAyB;AACrBT,wBAAQxB,IAAR,CAAakC,OAAb,CAAqB;AACjBxC,2BAAO,4BAAG,gBAAH,CADU;AAEjBC,yBAAK,mCAFY;AAGjBT,4BAAQ;AAHS,iBAArB;AAKH;AACD,gBAAIE,QAAQ6C,WAAZ,EAAyB;AACrBT,wBAAQxB,IAAR,CAAakC,OAAb,CAAqB;AACjBxC,2BAAO,4BAAG,gBAAH,CADU;AAEjBC,yBAAKP,QAAQ+C,oBAFI;AAGjBjD,4BAAQ;AAHS,iBAArB;AAKH;AACD,iBAAKK,GAAL,CAASiC,OAAT;;AAEA;AACA;AACA;AACA,gBAAIY,UAAU,EAAd;AACA,gBAAI,CAACtC,OAAOC,IAAP,CAAYN,EAAjB,EAAqB;AACjB,oBAAIL,QAAQiD,mBAAZ,EAAiC;AAC7BD,8BAAU;AACN3C,4BAAI,MADE;AAENC,+BAAO,4BAAG,mBAAH,CAFD;AAGN6B,6BAAK,gBAHC;AAIN3B,iCAAS,4BAAG,+BAAH,CAJH;AAKNI,8BAAM,CACF;AACIN,mCAAO,4BAAG,OAAH,CADX;AAEIC,iCAAK,YAFT;AAGIT,oCAAQ,aAHZ;AAIIoD,2CAAe;AAJnB,yBADE,EAOF;AACI5C,mCAAO,4BAAG,UAAH,CADX;AAEIC,iCAAK,aAFT;AAGIT,oCAAQ,aAHZ;AAIIoD,2CAAe;AAJnB,yBAPE;AALA,qBAAV;AAoBH,iBArBD,MAqBO;AACHF,8BAAU;AACN3C,4BAAI,MADE;AAENC,+BAAO,4BAAG,OAAH,CAFD;AAGN6B,6BAAK,gBAHC;AAIN3B,iCAAS,4BAAG,OAAH,CAJH;AAKND,6BAAK,YALC;AAMNT,gCAAQ,aANF;AAONoD,uCAAe;AAPT,qBAAV;AASH;AACJ,aAjCD,MAiCO;AACHF,0BAAU;AACN3C,wBAAI,MADE;AAENC,2BAAO,4BAAG,MAAH,CAFD;AAGN6B,yBAAK,eAHC;AAIN3B,6BAAS,4BAAG,wBAAH,CAJH;AAKNI,0BAAM,CACF;AACIN,+BAAU,4BAAG,cAAH,CAAV,SAAgCI,OAAOC,IAAP,CAAYuB,GAAZ,CAAgB,OAAhB;AADpC,qBADE,EAIF;AACI5B,+BAAO,4BAAG,aAAH,CADX;AAEIC,6BAAK;AAFT,qBAJE,EAQF;AACID,+BAAO,4BAAG,eAAH,CADX;AAEIC,6BAAK;AAFT,qBARE,EAYF;AACID,+BAAO,4BAAG,QAAH,CADX;AAEIC,iEAAuCG,OAAOyC,kBAFlD;AAGIrD,gCAAQ,MAHZ;AAIIsD,iCAAS;AAJb,qBAZE,EAkBF;AACI9C,+BAAO,4BAAG,gBAAH,CADX;AAEIC,6BAAK,eAFT;AAGIT,gCAAQ;AAHZ,qBAlBE,EAuBF;AACIQ,+BAAO,4BAAG,iBAAH,CADX;AAEIC,6BAAK,gBAFT;AAGIT,gCAAQ;AAHZ,qBAvBE,EA4BF;AACIQ,+BAAO,4BAAG,aAAH,CADX;AAEIC,6BAAK,YAFT;AAGIT,gCAAQ;AAHZ,qBA5BE,EAiCF;AACIQ,+BAAO,4BAAG,sBAAH,CADX;AAEIC,6BAAK,qBAFT;AAGIT,gCAAQ;AAHZ,qBAjCE;AALA,iBAAV;AA6CH;AACD,iBAAKK,GAAL,CAAS6C,OAAT;AACA,mBAAO,IAAI/B,EAAEoC,QAAN,GAAiBC,OAAjB,GAA2BC,OAA3B,EAAP;AACH;AAzSuC,KAA3B,CAAjB;;AA4SA;AACA,QAAIC,MAAMlE,SAASmE,IAAT,CAAchE,MAAd,CAAqB;AAC3BiE,oBAAY,oBAAS1D,OAAT,EAAkB;AAC1B,iBAAKN,KAAL,GAAaM,QAAQN,KAArB;AACA,iBAAKiE,UAAL,CAAgB,KAAKC,SAAL,EAAhB;AACA,iBAAKC,KAAL,GAAa,KAAK5C,CAAL,CAAO,WAAP,CAAb;AACA,iBAAK6C,KAAL,GAAa,KAAK7C,CAAL,CAAO,WAAP,CAAb;AACA,iBAAK8C,KAAL,GAAa,KAAK9C,CAAL,CAAO,gBAAP,CAAb;AACA,iBAAK+C,QAAL,CAAc,KAAKtE,KAAnB,EAA0B,QAA1B,EAAoC,KAAKU,MAAzC,EAAiD,IAAjD;AACH,SAR0B;;AAU3B6D,gBAAQ;AACJ,+BAAmB;AADf,SAVmB;;AAc3B7D,gBAAQ,kBAAW;AAAA;;AACfa,cAAE,UAAF,EAAciD,MAAd;AACA,iBAAKC,GAAL,CACKC,WADL,GAEKC,QAFL,CAEc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,UAAf,KAA8B,UAF5C,EAGKmC,QAHL,CAGc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,QAAf,KAA4B,QAH1C,EAIKmC,QAJL,CAIc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,MAAf,KAA0B,UAJxC,EAKKoC,IALL,CAKU,IALV,EAKgB,KAAK5E,KAAL,CAAWW,EAL3B,EAMKkE,GANL,CAMS;AACDC,4BAAa,KAAK9E,KAAL,CAAWwC,GAAX,CAAe,SAAf,KAA6B,SAA9B,IAA4C;AADvD,aANT;AASA,iBAAKxC,KAAL,CAAW+E,GAAX,CAAe,KAAf,EAAsB,KAAKC,UAAL,CAAgB,KAAKhF,KAAL,CAAWwC,GAAX,CAAe,KAAf,CAAhB,CAAtB;AACA,iBAAK4B,KAAL,CACKa,IADL,CACU,KAAKjF,KAAL,CAAWwC,GAAX,CAAe,MAAf,KAA0B,EADpC,EAEKkC,WAFL,GAGKC,QAHL,CAGc,UAHd,EAIKA,QAJL,CAIc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,UAAf,CAJd,EAKKqC,GALL,CAKS;AACDK,yBAAU,KAAKlF,KAAL,CAAWwC,GAAX,CAAe,WAAf,KAA+B,OAAhC,IAA4C;AADpD,aALT;AAQA,iBAAK2B,KAAL,CACKc,IADL,CACU,KAAKjF,KAAL,CAAWwC,GAAX,CAAe,OAAf,KAA2B,EADrC,EAEKkC,WAFL,GAGKC,QAHL,CAGc,UAHd,EAIKA,QAJL,CAIc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,KAAf,CAJd,EAKKmC,QALL,CAKc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,MAAf,sBAAyC,KAAKxC,KAAL,CAAWwC,GAAX,CAAe,MAAf,CALvD,EAMKmC,QANL,CAMc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,MAAf,KAA0B,iBANxC,EAOKmC,QAPL,CAOc,KAAK3E,KAAL,CAAWwC,GAAX,CAAe,QAAf,KAA4B,QAP1C,EAQKoC,IARL,CAQU,QARV,EAQoB,KAAK5E,KAAL,CAAWwC,GAAX,CAAe,QAAf,CARpB,EASKoC,IATL,CASU,MATV,EASkB,KAAK5E,KAAL,CAAWwC,GAAX,CAAe,KAAf,CATlB,EAUKoC,IAVL,CAUU,OAVV,EAUmB,KAAK5E,KAAL,CAAWwC,GAAX,CAAe,SAAf,CAVnB,EAWK1B,OAXL,CAWa,SAXb;AAYA,gBAAI,KAAKd,KAAL,CAAWwC,GAAX,CAAe,SAAf,CAAJ,EAA+B;AAC3B,qBAAK2B,KAAL,CAAWrD,OAAX,CAAmB,EAAEqE,WAAW,QAAb,EAAnB;AACH;AACD,gBAAI,KAAKnF,KAAL,CAAWwC,GAAX,CAAe,MAAf,KAA0B,KAAKxC,KAAL,CAAWwC,GAAX,CAAe,WAAf,CAA9B,EAA2D;AACvD,qBAAK6B,KAAL,CAAWe,IAAX;AACA7D,kBAAE,YAAF,EACK6D,IADL,GAEKC,GAFL,GAGKC,EAHL,CAGQ,OAHR,EAGiB,YAAM;AACf/D,sBAAE,YAAF,EAAgBgE,IAAhB;AACA,0BAAKvF,KAAL,CAAW+E,GAAX,CAAe,WAAf,EAA4B,KAA5B;AACH,iBANL;AAOH,aATD,MASO;AACH,qBAAKV,KAAL,CAAWkB,IAAX;AACAhE,kBAAE,YAAF,EAAgBgE,IAAhB;AACH;AACD,iBAAKlB,KAAL,CAAWmB,KAAX,GAAmBd,WAAnB;AACA,gBAAI,KAAK1E,KAAL,CAAWwC,GAAX,CAAe,MAAf,CAAJ,EAA4B;AACxB3C,kBAAE6B,IAAF,CAAO,KAAK1B,KAAL,CAAWwC,GAAX,CAAe,MAAf,CAAP,EAA+B,oBAAY;AACvC,0BAAK6B,KAAL,CAAWoB,MAAX,CAAkB,MAAKC,cAAL,CAAoBC,QAApB,CAAlB;AACA,wBAAIA,SAASjC,OAAb,EAAsB;AAClB,8BAAKW,KAAL,CAAWoB,MAAX,CAAkBlE,EAAE,QAAF,EAAYoD,QAAZ,CAAqB,kBAArB,CAAlB;AACH;AACJ,iBALD;AAMA,qBAAKN,KAAL,CAAWM,QAAX,CAAoB,eAApB;AACA,qBAAKR,KAAL,CAAWsB,MAAX,CAAkBlE,EAAE,MAAF,EAAUoD,QAAV,CAAmB,OAAnB,CAAlB;AACH;AACD,mBAAO,IAAP;AACH,SA1E0B;;AA4E3B;AACAe,wBAAgB,wBAASpF,OAAT,EAAkB;AAAA;;AAC9BA,sBAAUT,EAAEK,QAAF,CAAWI,WAAW,EAAtB,EAA0B;AAChCM,uBAAO,EADyB;AAEhCC,qBAAK,EAF2B;AAGhCT,wBAAQ,SAHwB;AAIhCoD,+BAAe;AAJiB,aAA1B,CAAV;AAMAlD,oBAAQO,GAAR,GAAc,KAAKmE,UAAL,CAAgB1E,QAAQO,GAAxB,CAAd;AACA,mBAAOU,EAAE,MAAF,EACFoD,QADE,CACO,eADP,EAEFC,IAFE,CAEG,MAFH,EAEWtE,QAAQO,GAFnB,EAGF+D,IAHE,CAGG,QAHH,EAGatE,QAAQF,MAHrB,EAIF6E,IAJE,CAIG3E,QAAQM,KAJX,EAKF0E,EALE,CAKC,OALD,EAKU,aAAK;AACdM,kBAAEC,cAAF;AACA,uBAAK7F,KAAL,CAAW+E,GAAX,CAAe,WAAf,EAA4B,KAA5B;AACA,oBAAIzE,QAAQ2B,OAAZ,EAAqB;AACjB3B,4BAAQ2B,OAAR;AACH,iBAFD,MAEO;AACHjB,2BAAO8E,KAAP,CAAarF,GAAb,CAAiBH,OAAjB;AACH;AACJ,aAbE,CAAP;AAcH,SAnG0B;;AAqG3ByF,mBAAW,mBAASC,KAAT,EAAgBnF,GAAhB,EAAqB;AAC5B,mBAAOU,EAAE,QAAF,EACFkE,MADE,CAEClE,EAAE,MAAF,EACKqD,IADL,CACU,MADV,EACkB5D,OAAOiF,IAAP,GAAcpF,GADhC,EAEKoE,IAFL,CAEUe,KAFV,CAFD,EAMFf,IANE,EAAP;AAOH,SA7G0B;;AA+G3B;AACAiB,sBAAc,sBAASN,CAAT,EAAY;AAAA;;AACtB,gBAAI5F,QAAQ,KAAKA,KAAjB;AACA4F,cAAEC,cAAF;AACAtE,cAAE,UAAF,EAAcgE,IAAd;AACAvF,kBAAMmG,OAAN,CAAc,UAAd,EAA0B,aAAK;AAC3B,oBAAInG,MAAMW,EAAN,KAAayF,EAAEzF,EAAf,IAAqByF,EAAE5D,GAAF,CAAM,MAAN,CAAzB,EAAwC;AACpC4D,sBAAErB,GAAF,CAAM,WAAN,EAAmB,KAAnB;AACH;AACJ,aAJD;AAKA,gBAAI,CAAC/E,MAAMwC,GAAN,CAAU,UAAV,CAAL,EAA4B;AACxB,oBAAI,CAACxC,MAAMwC,GAAN,CAAU,MAAV,CAAL,EAAwB;AACpB,wBAAIxC,MAAMwC,GAAN,CAAU,SAAV,CAAJ,EAA0B;AACtBxC,8BAAMwC,GAAN,CAAU,SAAV;AACH,qBAFD,MAEO;AACHxB,+BAAO8E,KAAP,CAAarF,GAAb,CAAiBT,MAAMqG,UAAvB;AACH;AACJ,iBAND,MAMO;AACHrG,0BAAM+E,GAAN,CAAU,WAAV,EAAuB,IAAvB;AACH;AACJ,aAVD,MAUO;AACH,oBAAI,KAAKZ,KAAL,CAAWmC,OAAf,EAAwB;AACpB,yBAAKnC,KAAL,CAAWmC,OAAX,CAAmB,SAAnB;AACH;AACD,qBAAKnC,KAAL,CACKmC,OADL,CACa;AACLrB,0BAAM,IADD;AAELE,+BAAW,QAFN;AAGLoB,yCAAmB,KAAKR,SAAL,CAAe,OAAf,EAAwB,4BAAxB,CAAnB,YAA+E,KAAKA,SAAL,CAC3E,UAD2E,EAE3E,6BAF2E,CAA/E;AAHK,iBADb,EASKO,OATL,CASa,MATb;AAUAE,uBAAOC,UAAP,CAAkB,YAAM;AACpB,2BAAKtC,KAAL,CAAWmC,OAAX,CAAmB,SAAnB;AACH,iBAFD,EAEG,IAFH;AAGH;AACJ,SArJ0B;;AAuJ3B;AACAtB,oBAAY,oBAASnE,GAAT,EAAc;AACtB,mBAAO,OAAOA,GAAP,IAAc,QAAd,IAA0BA,IAAI6F,OAAJ,CAAY,IAAZ,MAAsB,CAAC,CAAjD,IAAsD7F,IAAI8F,MAAJ,CAAW,CAAX,KAAiB,GAAvE,GAA6E3F,OAAOiF,IAAP,GAAcpF,GAA3F,GAAiGA,GAAxG;AACH,SA1J0B;;AA4J3B;AACAqD,mBAAW,qBAAW;AAClB;AAMH;AApK0B,KAArB,CAAV;;sBAuKe;AACXpE,oBAAYA,UADD;AAEXgE,aAAKA;AAFM,K","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\nimport * as Backbone from \"backbone\";\nimport * as _ from \"underscore\";\nimport { CommunicationServerView } from \"layout/communication-server-view\";\nimport Webhooks from \"mvc/webhooks\";\nimport _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\n\n/* global Galaxy */\n/* global $ */\n\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible: true,\n            target: \"_parent\"\n        }\n    }),\n    fetch: function(options) {\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new CommunicationServerView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id: \"analysis\",\n            title: _l(\"Analyze Data\"),\n            url: \"\",\n            tooltip: _l(\"Analysis home view\")\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id: \"workflow\",\n            title: _l(\"Workflow\"),\n            tooltip: _l(\"Chain tools into workflows\"),\n            disabled: !Galaxy.user.id,\n            url: \"workflows/list\"\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id: \"visualization\",\n            title: _l(\"Visualize\"),\n            url: \"visualizations/list\",\n            tooltip: _l(\"Visualize datasets\"),\n            disabled: !Galaxy.user.id,\n            menu: [\n                {\n                    title: _l(\"Create Visualization\"),\n                    url: \"visualizations\"\n                },\n                {\n                    title: _l(\"Interactive Environments\"),\n                    url: \"visualization/gie_list\",\n                    target: \"galaxy_main\"\n                },\n                {\n                    title: _l(\"Saved Visualizations\"),\n                    url: \"visualizations/list\",\n                    target: \"_frame\"\n                }\n            ]\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id: \"shared\",\n            title: _l(\"Shared Data\"),\n            url: \"library/index\",\n            tooltip: _l(\"Access published resources\"),\n            menu: [\n                {\n                    title: _l(\"Data Libraries\"),\n                    url: \"library/list\"\n                },\n                {\n                    title: _l(\"Histories\"),\n                    url: \"histories/list_published\"\n                },\n                {\n                    title: _l(\"Workflows\"),\n                    url: \"workflows/list_published\"\n                },\n                {\n                    title: _l(\"Visualizations\"),\n                    url: \"visualizations/list_published\"\n                },\n                {\n                    title: _l(\"Pages\"),\n                    url: \"pages/list_published\"\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.load({\n            type: \"masthead\",\n            callback: function(webhooks) {\n                $(document).ready(() => {\n                    webhooks.each(model => {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id: webhook.id,\n                                icon: webhook.config.icon,\n                                url: webhook.config.url,\n                                tooltip: webhook.config.tooltip,\n                                /*jslint evil: true */\n                                onclick: webhook.config.function && new Function(webhook.config.function)\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if (Galaxy.page) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            } else if (Galaxy.masthead) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n\n                            // Append masthead script and styles to Galaxy main\n                            Utils.appendScriptStyle(webhook);\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        if (Galaxy.user.get(\"is_admin\")) {\n            this.add({\n                id: \"admin\",\n                title: _l(\"Admin\"),\n                url: \"admin\",\n                tooltip: _l(\"Administer this Galaxy\"),\n                cls: \"admin-only\"\n            });\n        }\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id: \"help\",\n            title: _l(\"Help\"),\n            tooltip: _l(\"Support, contact, and community\"),\n            menu: [\n                {\n                    title: _l(\"Support\"),\n                    url: options.support_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Search\"),\n                    url: options.search_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Mailing Lists\"),\n                    url: options.mailing_lists,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Videos\"),\n                    url: options.screencasts_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Wiki\"),\n                    url: options.wiki_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"How to Cite Galaxy\"),\n                    url: options.citation_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Interactive Tours\"),\n                    url: \"tours\"\n                }\n            ]\n        };\n        if (options.terms_url) {\n            helpTab.menu.push({\n                title: _l(\"Terms and Conditions\"),\n                url: options.terms_url,\n                target: \"_blank\"\n            });\n        }\n        if (options.biostar_url) {\n            helpTab.menu.unshift({\n                title: _l(\"Ask a question\"),\n                url: \"biostar/biostar_question_redirect\",\n                target: \"_blank\"\n            });\n        }\n        if (options.biostar_url) {\n            helpTab.menu.unshift({\n                title: _l(\"Galaxy Biostar\"),\n                url: options.biostar_url_redirect,\n                target: \"_blank\"\n            });\n        }\n        this.add(helpTab);\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if (!Galaxy.user.id) {\n            if (options.allow_user_creation) {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login or Register\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Account registration or login\"),\n                    menu: [\n                        {\n                            title: _l(\"Login\"),\n                            url: \"user/login\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        },\n                        {\n                            title: _l(\"Register\"),\n                            url: \"user/create\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        }\n                    ]\n                };\n            } else {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Login\"),\n                    url: \"user/login\",\n                    target: \"galaxy_main\",\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id: \"user\",\n                title: _l(\"User\"),\n                cls: \"loggedin-only\",\n                tooltip: _l(\"Account and saved data\"),\n                menu: [\n                    {\n                        title: `${_l(\"Logged in as\")} ${Galaxy.user.get(\"email\")}`\n                    },\n                    {\n                        title: _l(\"Preferences\"),\n                        url: \"user\"\n                    },\n                    {\n                        title: _l(\"Custom Builds\"),\n                        url: \"custom_builds\"\n                    },\n                    {\n                        title: _l(\"Logout\"),\n                        url: `user/logout?session_csrf_token=${Galaxy.session_csrf_token}`,\n                        target: \"_top\",\n                        divider: true\n                    },\n                    {\n                        title: _l(\"Saved Datasets\"),\n                        url: \"datasets/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Histories\"),\n                        url: \"histories/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Pages\"),\n                        url: \"pages/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Visualizations\"),\n                        url: \"visualizations/list\",\n                        target: \"_top\"\n                    }\n                ]\n            };\n        }\n        this.add(userTab);\n        return new $.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$link = this.$(\".nav-link\");\n        this.$note = this.$(\".nav-note\");\n        this.$menu = this.$(\".dropdown-menu\");\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    events: {\n        \"click .nav-link\": \"_toggleClick\"\n    },\n\n    render: function() {\n        $(\".tooltip\").remove();\n        this.$el\n            .removeClass()\n            .addClass(this.model.get(\"disabled\") && \"disabled\")\n            .addClass(this.model.get(\"active\") && \"active\")\n            .addClass(this.model.get(\"menu\") && \"dropdown\")\n            .attr(\"id\", this.model.id)\n            .css({\n                visibility: (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n            });\n        this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n        this.$note\n            .html(this.model.get(\"note\") || \"\")\n            .removeClass()\n            .addClass(\"nav-note\")\n            .addClass(this.model.get(\"note_cls\"))\n            .css({\n                display: (this.model.get(\"show_note\") && \"block\") || \"none\"\n            });\n        this.$link\n            .html(this.model.get(\"title\") || \"\")\n            .removeClass()\n            .addClass(\"nav-link\")\n            .addClass(this.model.get(\"cls\"))\n            .addClass(this.model.get(\"icon\") && `nav-icon fa ${this.model.get(\"icon\")}`)\n            .addClass(this.model.get(\"menu\") && \"dropdown-toggle\")\n            .addClass(this.model.get(\"toggle\") && \"toggle\")\n            .attr(\"target\", this.model.get(\"target\"))\n            .attr(\"href\", this.model.get(\"url\"))\n            .attr(\"title\", this.model.get(\"tooltip\"))\n            .tooltip(\"dispose\");\n        if (this.model.get(\"tooltip\")) {\n            this.$link.tooltip({ placement: \"bottom\" });\n        }\n        if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n            this.$menu.show();\n            $(\"#dd-helper\")\n                .show()\n                .off()\n                .on(\"click\", () => {\n                    $(\"#dd-helper\").hide();\n                    this.model.set(\"show_menu\", false);\n                });\n        } else {\n            this.$menu.hide();\n            $(\"#dd-helper\").hide();\n        }\n        this.$menu.empty().removeClass();\n        if (this.model.get(\"menu\")) {\n            _.each(this.model.get(\"menu\"), menuItem => {\n                this.$menu.append(this._buildMenuItem(menuItem));\n                if (menuItem.divider) {\n                    this.$menu.append($(\"<div/>\").addClass(\"dropdown-divider\"));\n                }\n            });\n            this.$menu.addClass(\"dropdown-menu\");\n            this.$link.append($(\"<b/>\").addClass(\"caret\"));\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function(options) {\n        options = _.defaults(options || {}, {\n            title: \"\",\n            url: \"\",\n            target: \"_parent\",\n            noscratchbook: false\n        });\n        options.url = this._formatUrl(options.url);\n        return $(\"<a/>\")\n            .addClass(\"dropdown-item\")\n            .attr(\"href\", options.url)\n            .attr(\"target\", options.target)\n            .html(options.title)\n            .on(\"click\", e => {\n                e.preventDefault();\n                this.model.set(\"show_menu\", false);\n                if (options.onclick) {\n                    options.onclick();\n                } else {\n                    Galaxy.frame.add(options);\n                }\n            });\n    },\n\n    buildLink: function(label, url) {\n        return $(\"<div/>\")\n            .append(\n                $(\"<a/>\")\n                    .attr(\"href\", Galaxy.root + url)\n                    .html(label)\n            )\n            .html();\n    },\n\n    /** Handle click event */\n    _toggleClick: function(e) {\n        var model = this.model;\n        e.preventDefault();\n        $(\".tooltip\").hide();\n        model.trigger(\"dispatch\", m => {\n            if (model.id !== m.id && m.get(\"menu\")) {\n                m.set(\"show_menu\", false);\n            }\n        });\n        if (!model.get(\"disabled\")) {\n            if (!model.get(\"menu\")) {\n                if (model.get(\"onclick\")) {\n                    model.get(\"onclick\")();\n                } else {\n                    Galaxy.frame.add(model.attributes);\n                }\n            } else {\n                model.set(\"show_menu\", true);\n            }\n        } else {\n            if (this.$link.popover) {\n                this.$link.popover(\"dispose\");\n            }\n            this.$link\n                .popover({\n                    html: true,\n                    placement: \"bottom\",\n                    content: `Please ${this.buildLink(\"login\", \"user/login?use_panels=True\")} or ${this.buildLink(\n                        \"register\",\n                        \"user/create?use_panels=True\"\n                    )} to use this feature.`\n                })\n                .popover(\"show\");\n            window.setTimeout(() => {\n                this.$link.popover(\"dispose\");\n            }, 3000);\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function(url) {\n        return typeof url == \"string\" && url.indexOf(\"//\") === -1 && url.charAt(0) != \"/\" ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function() {\n        return `\n            <li class=\"nav-item\">\n                <a class=\"nav-link\"/>\n                <div class=\"nav-note\"/>\n                <div class=\"dropdown-menu\"/>\n            </li>`;\n    }\n});\n\nexport default {\n    Collection: Collection,\n    Tab: Tab\n};\n"]}