{"version":3,"sources":["layout/communication-server-view.js"],"names":["Backbone","_","CommunicationServerView","View","extend","initialize","modal","makeModalIframe","e","host","window","Galaxy","config","communication_server_host","port","communication_server_port","username","escape","user","attributes","persistent_communication_rooms","query_string","src","$el_chat_modal_header","$el_chat_modal_body","iframe_template","header_template","frame_height","frame_width","class_names","$","length","remove","body","height","width","closing_events","title_separator","cls","show","addClass","find","removeAttr","append","click","css","hasClass","removeClass","attr","render","self","navItem","id","icon","tooltip","visible","onclick"],"mappings":"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","file":"../../scripts/layout/communication-server-view.js","sourcesContent":["/** Real-time Communication feature **/\nimport * as Backbone from \"backbone\";\nimport * as _ from \"underscore\";\nimport _l from \"utils/localization\";\nimport Modal from \"mvc/ui/ui-modal\";\n/* global $ */\n\nexport var CommunicationServerView = Backbone.View.extend({\n    initialize: function() {\n        this.modal = null;\n    },\n\n    /** makes bootstrap modal and iframe inside it */\n    makeModalIframe: function(e) {\n        // make modal\n        var host = window.Galaxy.config.communication_server_host;\n\n        var port = window.Galaxy.config.communication_server_port;\n        var username = _.escape(window.Galaxy.user.attributes.username);\n\n        var persistent_communication_rooms = _.escape(window.Galaxy.config.persistent_communication_rooms);\n\n        var query_string = `?username=${username}&persistent_communication_rooms=${persistent_communication_rooms}`;\n\n        var src = `${host}:${port}${query_string}`;\n        var $el_chat_modal_header = null;\n        var $el_chat_modal_body = null;\n\n        var iframe_template = `<iframe class=\"f-iframe fade in communication-iframe\" src=\"${src}\"> </iframe>`;\n\n        var header_template =\n            '<i class=\"fa fa-comment\" aria-hidden=\"true\" title=\"Communicate with other users\"></i>' +\n            '<i class=\"fa fa-expand expand-compress-modal\" aria-hidden=\"true\" title=\"Maximize\"></i>' +\n            '<i class=\"fa fa-times close-modal\" aria-hidden=\"true\" title=\"Close\"></i>';\n\n        var frame_height = 350;\n        var frame_width = 600;\n        var class_names = \"ui-modal chat-modal\";\n\n        // deletes the chat modal if already present and create one\n        if ($(\".chat-modal\").length > 0) {\n            $(\".chat-modal\").remove();\n        }\n        // creates a modal\n        CommunicationServerView.modal = new Modal.View({\n            body: iframe_template,\n            height: frame_height,\n            width: frame_width,\n            closing_events: true,\n            title_separator: false,\n            cls: class_names\n        });\n\n        // shows modal\n        CommunicationServerView.modal.show();\n        $el_chat_modal_header = $(\".chat-modal .modal-header\");\n        $el_chat_modal_body = $(\".chat-modal .modal-body\");\n        // adjusts the css of bootstrap modal for chat\n        $el_chat_modal_header.addClass(\"modal-header-body\");\n        $el_chat_modal_body.addClass(\"modal-header-body\");\n        $el_chat_modal_header.find(\"h4\").remove();\n        $el_chat_modal_header.removeAttr(\"min-height padding border\");\n        $el_chat_modal_header.append(header_template);\n        // click event of the close button for chat\n        $(\".close-modal\").click(e => {\n            $(\".chat-modal\").css(\"display\", \"none\");\n        });\n        // click event of expand and compress icon\n        $(\".expand-compress-modal\").click(e => {\n            if ($(\".expand-compress-modal\").hasClass(\"fa-expand\")) {\n                $(\".chat-modal .modal-dialog\").width(\"1000px\");\n                $(\".chat-modal .modal-body\").height(\"575px\");\n                $(\".expand-compress-modal\")\n                    .removeClass(\"fa-expand\")\n                    .addClass(\"fa-compress\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Minimize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"96.2%\");\n            } else {\n                $(\".chat-modal .modal-dialog\").width(`${frame_width}px`);\n                $(\".chat-modal .modal-body\").height(`${frame_height}px`);\n                $(\".expand-compress-modal\")\n                    .removeClass(\"fa-compress\")\n                    .addClass(\"fa-expand\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Maximize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"93.2%\");\n            }\n        });\n        return this;\n    },\n\n    /**renders the chat icon as a nav item*/\n    render: function() {\n        var self = this;\n        var navItem = {};\n        navItem = {\n            id: \"show-chat-online\",\n            icon: \"fa-comment-o\",\n            tooltip: _l(\"Chat online\"),\n            visible: false,\n            onclick: self.makeModalIframe\n        };\n        return navItem;\n    }\n});\n"]}