{"version":3,"sources":["layout/scratchbook.js"],"names":["Backbone","_","View","extend","initialize","options","self","frames","visible","setElement","$el","buttonActive","collection","add","id","icon","tooltip","onclick","active","set","toggle","show_note","note_cls","hide","onbeforeunload","length","buttonLoad","e","show","on","note","history_cache","addDataset","dataset_id","current_dataset","Galaxy","currHistoryPanel","history_id","historyId","name","model","get","dataset_ids","each","push","_findDataset","dataset","offset","history_details","dataset_list","pos","indexOf","_loadDatasetOffset","frame","new_dataset_id","_loadDataset","new_dataset","config","trigger","menu","disabled","callback","Dataset","$","when","fetch","then","is_tabular","find","data_type","title","url","content","createTabularDatasetChunkedView","TabularDataset","toJSON","embedded","height","root","addTrackster","viz_id","viz","Visualization","ui","TracksterUI","frame_config","type","parent_elt","view_config","container","dbkey","stand_alone","latest_revision","drawables","view","d","hda_ldda","create_visualization","viewport","bookmarks","target","window","open","location","noscratchbook","$galaxy_main","parent","document","_build_url","use_panels","attr","hide_panels","hide_masthead","param"],"mappings":";;;;;;;QACYA,Q;;QACAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sBAUGD,SAASE,IAAT,CAAcC,MAAd,CAAqB;AAChCC,oBAAY,oBAASC,OAAT,EAAkB;AAC1B,gBAAIC,OAAO,IAAX;AACAD,sBAAUA,WAAW,EAArB;AACA,iBAAKE,MAAL,GAAc,IAAI,mBAAOL,IAAX,CAAgB,EAAEM,SAAS,KAAX,EAAhB,CAAd;AACA,iBAAKC,UAAL,CAAgB,KAAKF,MAAL,CAAYG,GAA5B;AACA,iBAAKC,YAAL,GAAoBN,QAAQO,UAAR,CAAmBC,GAAnB,CAAuB;AACvCC,oBAAI,oBADmC;AAEvCC,sBAAM,OAFiC;AAGvCC,yBAAS,4BAAG,4BAAH,CAH8B;AAIvCC,yBAAS,mBAAW;AAChBX,yBAAKY,MAAL,GAAc,CAACZ,KAAKY,MAApB;AACAZ,yBAAKK,YAAL,CAAkBQ,GAAlB,CAAsB;AAClBC,gCAAQd,KAAKY,MADK;AAElBG,mCAAWf,KAAKY,MAFE;AAGlBI,kCAAUhB,KAAKY,MAAL,IAAe;AAHP,qBAAtB;AAKA,wBAAI,CAACZ,KAAKY,MAAV,EAAkB;AACdZ,6BAAKC,MAAL,CAAYgB,IAAZ;AACH;AACJ,iBAdsC;AAevCC,gCAAgB,0BAAW;AACvB,wBAAIlB,KAAKC,MAAL,CAAYkB,MAAZ,KAAuB,CAA3B,EAA8B;AAC1B,+CAAqBnB,KAAKC,MAAL,CAAYkB,MAAZ,EAArB;AACH;AACJ;AAnBsC,aAAvB,CAApB;AAqBA,iBAAKC,UAAL,GAAkBrB,QAAQO,UAAR,CAAmBC,GAAnB,CAAuB;AACrCC,oBAAI,kBADiC;AAErCC,sBAAM,QAF+B;AAGrCC,yBAAS,4BAAG,uBAAH,CAH4B;AAIrCK,2BAAW,IAJ0B;AAKrCb,yBAAS,KAL4B;AAMrCS,yBAAS,iBAASU,CAAT,EAAY;AACjB,wBAAIrB,KAAKC,MAAL,CAAYC,OAAhB,EAAyB;AACrBF,6BAAKC,MAAL,CAAYgB,IAAZ;AACH,qBAFD,MAEO;AACHjB,6BAAKC,MAAL,CAAYqB,IAAZ;AACH;AACJ;AAZoC,aAAvB,CAAlB;AAcA,iBAAKrB,MAAL,CACKsB,EADL,CACQ,YADR,EACsB,YAAW;AACzB,oBAAI,KAAKrB,OAAL,IAAgB,KAAKiB,MAAL,OAAkB,CAAtC,EAAyC;AACrC,yBAAKF,IAAL;AACH;AACDjB,qBAAKoB,UAAL,CAAgBP,GAAhB,CAAoB;AAChBW,0BAAM,KAAKL,MAAL,EADU;AAEhBjB,6BAAS,KAAKiB,MAAL,KAAgB;AAFT,iBAApB;AAIH,aATL,EAUKI,EAVL,CAUQ,YAVR,EAUsB,YAAW;AACzBvB,qBAAKoB,UAAL,CAAgBP,GAAhB,CAAoB;AAChBC,4BAAQ,KAAKZ,OADG;AAEhBO,0BAAO,KAAKP,OAAL,IAAgB,QAAjB,IAA8B;AAFpB,iBAApB;AAIH,aAfL;AAgBA,iBAAKuB,aAAL,GAAqB,EAArB;AACH,SA1D+B;;AA4DhC;AACAC,oBAAY,oBAASC,UAAT,EAAqB;AAC7B,gBAAI3B,OAAO,IAAX;AACA,gBAAI4B,kBAAkB,IAAtB;AACA,gBAAIC,UAAUA,OAAOC,gBAArB,EAAuC;AACnC,oBAAIC,aAAaF,OAAOC,gBAAP,CAAwBxB,UAAxB,CAAmC0B,SAApD;AACA,qBAAKP,aAAL,CAAmBM,UAAnB,IAAiC;AAC7BE,0BAAMJ,OAAOC,gBAAP,CAAwBI,KAAxB,CAA8BC,GAA9B,CAAkC,MAAlC,CADuB;AAE7BC,iCAAa;AAFgB,iBAAjC;AAIAP,uBAAOC,gBAAP,CAAwBxB,UAAxB,CAAmC+B,IAAnC,CAAwC,iBAAS;AAC7C,wBAAI,CAACH,MAAMC,GAAN,CAAU,SAAV,CAAD,IAAyBD,MAAMC,GAAN,CAAU,SAAV,CAA7B,EAAmD;AAC/CnC,6BAAKyB,aAAL,CAAmBM,UAAnB,EAA+BK,WAA/B,CAA2CE,IAA3C,CAAgDJ,MAAMC,GAAN,CAAU,IAAV,CAAhD;AACH;AACJ,iBAJD;AAKH;AACD,gBAAII,eAAe,SAAfA,YAAe,CAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,oBAAID,OAAJ,EAAa;AACT,wBAAIE,kBAAkB1C,KAAKyB,aAAL,CAAmBe,QAAQL,GAAR,CAAY,YAAZ,CAAnB,CAAtB;AACA,wBAAIO,mBAAmBA,gBAAgBN,WAAvC,EAAoD;AAChD,4BAAIO,eAAeD,gBAAgBN,WAAnC;AACA,4BAAIQ,MAAMD,aAAaE,OAAb,CAAqBL,QAAQL,GAAR,CAAY,IAAZ,CAArB,CAAV;AACA,4BAAIS,QAAQ,CAAC,CAAT,IAAcA,MAAMH,MAAN,IAAgB,CAA9B,IAAmCG,MAAMH,MAAN,GAAeE,aAAaxB,MAAnE,EAA2E;AACvE,mCAAOwB,aAAaC,MAAMH,MAAnB,CAAP;AACH;AACJ;AACJ;AACJ,aAXD;AAYA,gBAAIK,qBAAqB,SAArBA,kBAAqB,CAACN,OAAD,EAAUC,MAAV,EAAkBM,KAAlB,EAA4B;AACjD,oBAAIC,iBAAiBT,aAAaC,OAAb,EAAsBC,MAAtB,CAArB;AACA,oBAAIO,cAAJ,EAAoB;AAChBhD,yBAAKiD,YAAL,CAAkBD,cAAlB,EAAkC,UAACE,WAAD,EAAcC,MAAd,EAAyB;AACvDvB,0CAAkBsB,WAAlB;AACAH,8BAAMb,KAAN,CAAYrB,GAAZ,CAAgBsC,MAAhB;AACH,qBAHD;AAIH,iBALD,MAKO;AACHJ,0BAAMb,KAAN,CAAYkB,OAAZ,CAAoB,QAApB;AACH;AACJ,aAVD;AAWA,iBAAKH,YAAL,CAAkBtB,UAAlB,EAA8B,UAACa,OAAD,EAAUW,MAAV,EAAqB;AAC/CvB,kCAAkBY,OAAlB;AACAxC,qBAAKO,GAAL,CACIZ,EAAEE,MAAF,CACI;AACIwD,0BAAM,CACF;AACI5C,8BAAM,2BADV;AAEIC,iCAAS,4BAAG,qBAAH,CAFb;AAGIC,iCAAS,iBAASoC,KAAT,EAAgB;AACrBD,+CAAmBlB,eAAnB,EAAoC,CAAC,CAArC,EAAwCmB,KAAxC;AACH,yBALL;AAMIO,kCAAU,oBAAW;AACjB,mCAAO,CAACf,aAAaX,eAAb,EAA8B,CAAC,CAA/B,CAAR;AACH;AARL,qBADE,EAWF;AACInB,8BAAM,4BADV;AAEIC,iCAAS,4BAAG,iBAAH,CAFb;AAGIC,iCAAS,iBAASoC,KAAT,EAAgB;AACrBD,+CAAmBlB,eAAnB,EAAoC,CAApC,EAAuCmB,KAAvC;AACH,yBALL;AAMIO,kCAAU,oBAAW;AACjB,mCAAO,CAACf,aAAaX,eAAb,EAA8B,CAA9B,CAAR;AACH;AARL,qBAXE;AADV,iBADJ,EAyBIuB,MAzBJ,CADJ;AA6BH,aA/BD;AAgCH,SAnI+B;;AAqIhCF,sBAAc,sBAAStB,UAAT,EAAqB4B,QAArB,EAA+B;AACzC,gBAAIvD,OAAO,IAAX;AACA,gBAAIwC,UAAU,IAAI,eAAKgB,OAAT,CAAiB,EAAEhD,IAAImB,UAAN,EAAjB,CAAd;AACA8B,cAAEC,IAAF,CAAOlB,QAAQmB,KAAR,EAAP,EAAwBC,IAAxB,CAA6B,YAAM;AAC/B,oBAAIC,aAAalE,EAAEmE,IAAF,CACb,CAAC,SAAD,EAAY,UAAZ,CADa,EAEb;AAAA,2BAAatB,QAAQL,GAAR,CAAY,WAAZ,EAAyBU,OAAzB,CAAiCkB,SAAjC,MAAgD,CAAC,CAA9D;AAAA,iBAFa,CAAjB;AAIA,oBAAIC,QAAQxB,QAAQL,GAAR,CAAY,MAAZ,CAAZ;AACA,oBAAIO,kBAAkB1C,KAAKyB,aAAL,CAAmBe,QAAQL,GAAR,CAAY,YAAZ,CAAnB,CAAtB;AACA,oBAAIO,eAAJ,EAAqB;AACjBsB,4BAAWtB,gBAAgBT,IAA3B,UAAoC+B,KAApC;AACH;AACDT,yBACIf,OADJ,EAEIqB,aACM;AACIG,2BAAOA,KADX;AAEIC,yBAAK,IAFT;AAGIC,6BAAS,eAAKC,+BAAL,CAAqC;AAC1CjC,+BAAO,IAAI,eAAKkC,cAAT,CAAwB5B,QAAQ6B,MAAR,EAAxB,CADmC;AAE1CC,kCAAU,IAFgC;AAG1CC,gCAAQ;AAHkC,qBAArC,EAINnE;AAPP,iBADN,GAUM;AACI4D,2BAAOA,KADX;AAEIC,yBAAQpC,OAAO2C,IAAf,iBAA+B7C,UAA/B,2BAFJ;AAGIuC,6BAAS;AAHb,iBAZV;AAkBH,aA5BD;AA6BH,SArK+B;;AAuKhC;AACAO,sBAAc,sBAASC,MAAT,EAAiB;AAC3B,gBAAI1E,OAAO,IAAX;AACA,gBAAI2E,MAAM,IAAI,wBAAcC,aAAlB,CAAgC,EAAEpE,IAAIkE,MAAN,EAAhC,CAAV;AACAjB,cAAEC,IAAF,CAAOiB,IAAIhB,KAAJ,EAAP,EAAoBC,IAApB,CAAyB,YAAM;AAC3B,oBAAIiB,KAAK,IAAI,oBAAUC,WAAd,CAA0BjD,OAAO2C,IAAjC,CAAT;;AAEA;AACA,oBAAIO,eAAe;AACff,2BAAOW,IAAIxC,GAAJ,CAAQ,MAAR,CADQ;AAEf6C,0BAAM,OAFS;AAGfd,6BAAS,iBAASe,UAAT,EAAqB;AAC1B;AACA,4BAAIC,cAAc;AACdC,uCAAWF,UADG;AAEdhD,kCAAM0C,IAAIxC,GAAJ,CAAQ,OAAR,CAFQ;AAGd3B,gCAAImE,IAAInE,EAHM;AAId;AACA4E,mCAAOT,IAAIxC,GAAJ,CAAQ,OAAR,CALO;AAMdkD,yCAAa;AANC,yBAAlB;;AASA,4BAAIC,kBAAkBX,IAAIxC,GAAJ,CAAQ,iBAAR,CAAtB;AACA,4BAAIoD,YAAYD,gBAAgBnC,MAAhB,CAAuBqC,IAAvB,CAA4BD,SAA5C;;AAEA;AACA5F,0BAAE0C,IAAF,CAAOkD,SAAP,EAAkB,aAAK;AACnBE,8BAAEjD,OAAF,GAAY;AACRkD,0CAAUD,EAAEC,QADJ;AAERlF,oCAAIiF,EAAE9D;AAFE,6BAAZ;AAIH,yBALD;AAMAkD,2BAAGc,oBAAH,CACIT,WADJ,EAEII,gBAAgBnC,MAAhB,CAAuByC,QAF3B,EAGIN,gBAAgBnC,MAAhB,CAAuBqC,IAAvB,CAA4BD,SAHhC,EAIID,gBAAgBnC,MAAhB,CAAuB0C,SAJ3B,EAKI,KALJ;AAOH;AA/Bc,iBAAnB;AAiCA7F,qBAAKO,GAAL,CAASwE,YAAT;AACH,aAtCD;AAuCH,SAlN+B;;AAoNhC;AACAxE,aAAK,aAASR,OAAT,EAAkB;AACnB,gBAAIA,QAAQ+F,MAAR,IAAkB,QAAtB,EAAgC;AAC5BC,uBAAOC,IAAP,CAAYjG,QAAQkE,GAApB;AACH,aAFD,MAEO,IAAIlE,QAAQ+F,MAAR,IAAkB,MAAlB,IAA4B/F,QAAQ+F,MAAR,IAAkB,SAA9C,IAA2D/F,QAAQ+F,MAAR,IAAkB,OAAjF,EAA0F;AAC7FC,uBAAOE,QAAP,GAAkBlG,QAAQkE,GAA1B;AACH,aAFM,MAEA,IAAI,CAAC,KAAKrD,MAAN,IAAgBb,QAAQmG,aAA5B,EAA2C;AAC9C,oBAAIC,eAAe1C,EAAEsC,OAAOK,MAAP,CAAcC,QAAhB,EAA0BvC,IAA1B,CAA+B,cAA/B,CAAnB;AACA,oBAAI/D,QAAQ+F,MAAR,IAAkB,aAAlB,IAAmC/F,QAAQ+F,MAAR,IAAkB,QAAzD,EAAmE;AAC/D,wBAAIK,aAAahF,MAAb,KAAwB,CAA5B,EAA+B;AAC3B4E,+BAAOE,QAAP,GAAkB,KAAKK,UAAL,CAAgBvG,QAAQkE,GAAxB,EAA6B,EAAEsC,YAAY,IAAd,EAA7B,CAAlB;AACH,qBAFD,MAEO;AACHJ,qCAAaK,IAAb,CAAkB,KAAlB,EAAyBzG,QAAQkE,GAAjC;AACH;AACJ,iBAND,MAMO8B,OAAOE,QAAP,GAAkBlG,QAAQkE,GAA1B;AACV,aATM,MASA;AACHlE,wBAAQkE,GAAR,GAAc,KAAKqC,UAAL,CAAgBvG,QAAQkE,GAAxB,EAA6B,EAAEwC,aAAa,IAAf,EAAqBC,eAAe,IAApC,EAA7B,CAAd;AACA,qBAAKzG,MAAL,CAAYM,GAAZ,CAAgBR,OAAhB;AACH;AACJ,SAvO+B;;AAyOhC;AACAuG,oBAAY,oBAASrC,GAAT,EAAclE,OAAd,EAAuB;AAC/B,gBAAIkE,GAAJ,EAAS;AACLA,uBAAOA,IAAIpB,OAAJ,CAAY,GAAZ,KAAoB,CAAC,CAArB,GAAyB,GAAzB,GAA+B,GAAtC;AACAoB,uBAAOR,EAAEkD,KAAF,CAAQ5G,OAAR,EAAiB,IAAjB,CAAP;AACA,uBAAOkE,GAAP;AACH;AACJ;AAhP+B,KAArB,C","file":"../../scripts/layout/scratchbook.js","sourcesContent":["/** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\nimport * as Backbone from \"backbone\";\nimport * as _ from \"underscore\";\nimport Frames from \"mvc/ui/ui-frames\";\nimport DATA from \"mvc/dataset/data\";\nimport visualization from \"viz/visualization\";\nimport trackster from \"viz/trackster\";\nimport _l from \"utils/localization\";\n\n/* global Galaxy */\n/* global $ */\n\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        options = options || {};\n        this.frames = new Frames.View({ visible: false });\n        this.setElement(this.frames.$el);\n        this.buttonActive = options.collection.add({\n            id: \"enable-scratchbook\",\n            icon: \"fa-th\",\n            tooltip: _l(\"Enable/Disable Scratchbook\"),\n            onclick: function() {\n                self.active = !self.active;\n                self.buttonActive.set({\n                    toggle: self.active,\n                    show_note: self.active,\n                    note_cls: self.active && \"fa fa-check\"\n                });\n                if (!self.active) {\n                    self.frames.hide();\n                }\n            },\n            onbeforeunload: function() {\n                if (self.frames.length() > 0) {\n                    return `You opened ${self.frames.length()} frame(s) which will be lost.`;\n                }\n            }\n        });\n        this.buttonLoad = options.collection.add({\n            id: \"show-scratchbook\",\n            icon: \"fa-eye\",\n            tooltip: _l(\"Show/Hide Scratchbook\"),\n            show_note: true,\n            visible: false,\n            onclick: function(e) {\n                if (self.frames.visible) {\n                    self.frames.hide();\n                } else {\n                    self.frames.show();\n                }\n            }\n        });\n        this.frames\n            .on(\"add remove\", function() {\n                if (this.visible && this.length() === 0) {\n                    this.hide();\n                }\n                self.buttonLoad.set({\n                    note: this.length(),\n                    visible: this.length() > 0\n                });\n            })\n            .on(\"show hide \", function() {\n                self.buttonLoad.set({\n                    toggle: this.visible,\n                    icon: (this.visible && \"fa-eye\") || \"fa-eye-slash\"\n                });\n            });\n        this.history_cache = {};\n    },\n\n    /** Add a dataset to the frames */\n    addDataset: function(dataset_id) {\n        var self = this;\n        var current_dataset = null;\n        if (Galaxy && Galaxy.currHistoryPanel) {\n            var history_id = Galaxy.currHistoryPanel.collection.historyId;\n            this.history_cache[history_id] = {\n                name: Galaxy.currHistoryPanel.model.get(\"name\"),\n                dataset_ids: []\n            };\n            Galaxy.currHistoryPanel.collection.each(model => {\n                if (!model.get(\"deleted\") && model.get(\"visible\")) {\n                    self.history_cache[history_id].dataset_ids.push(model.get(\"id\"));\n                }\n            });\n        }\n        var _findDataset = (dataset, offset) => {\n            if (dataset) {\n                var history_details = self.history_cache[dataset.get(\"history_id\")];\n                if (history_details && history_details.dataset_ids) {\n                    var dataset_list = history_details.dataset_ids;\n                    var pos = dataset_list.indexOf(dataset.get(\"id\"));\n                    if (pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length) {\n                        return dataset_list[pos + offset];\n                    }\n                }\n            }\n        };\n        var _loadDatasetOffset = (dataset, offset, frame) => {\n            var new_dataset_id = _findDataset(dataset, offset);\n            if (new_dataset_id) {\n                self._loadDataset(new_dataset_id, (new_dataset, config) => {\n                    current_dataset = new_dataset;\n                    frame.model.set(config);\n                });\n            } else {\n                frame.model.trigger(\"change\");\n            }\n        };\n        this._loadDataset(dataset_id, (dataset, config) => {\n            current_dataset = dataset;\n            self.add(\n                _.extend(\n                    {\n                        menu: [\n                            {\n                                icon: \"fa fa-chevron-circle-left\",\n                                tooltip: _l(\"Previous in History\"),\n                                onclick: function(frame) {\n                                    _loadDatasetOffset(current_dataset, -1, frame);\n                                },\n                                disabled: function() {\n                                    return !_findDataset(current_dataset, -1);\n                                }\n                            },\n                            {\n                                icon: \"fa fa-chevron-circle-right\",\n                                tooltip: _l(\"Next in History\"),\n                                onclick: function(frame) {\n                                    _loadDatasetOffset(current_dataset, 1, frame);\n                                },\n                                disabled: function() {\n                                    return !_findDataset(current_dataset, 1);\n                                }\n                            }\n                        ]\n                    },\n                    config\n                )\n            );\n        });\n    },\n\n    _loadDataset: function(dataset_id, callback) {\n        var self = this;\n        var dataset = new DATA.Dataset({ id: dataset_id });\n        $.when(dataset.fetch()).then(() => {\n            var is_tabular = _.find(\n                [\"tabular\", \"interval\"],\n                data_type => dataset.get(\"data_type\").indexOf(data_type) !== -1\n            );\n            var title = dataset.get(\"name\");\n            var history_details = self.history_cache[dataset.get(\"history_id\")];\n            if (history_details) {\n                title = `${history_details.name}: ${title}`;\n            }\n            callback(\n                dataset,\n                is_tabular\n                    ? {\n                          title: title,\n                          url: null,\n                          content: DATA.createTabularDatasetChunkedView({\n                              model: new DATA.TabularDataset(dataset.toJSON()),\n                              embedded: true,\n                              height: \"100%\"\n                          }).$el\n                      }\n                    : {\n                          title: title,\n                          url: `${Galaxy.root}datasets/${dataset_id}/display/?preview=True`,\n                          content: null\n                      }\n            );\n        });\n    },\n\n    /** Add a trackster visualization to the frames. */\n    addTrackster: function(viz_id) {\n        var self = this;\n        var viz = new visualization.Visualization({ id: viz_id });\n        $.when(viz.fetch()).then(() => {\n            var ui = new trackster.TracksterUI(Galaxy.root);\n\n            // Construct frame config based on dataset's type.\n            var frame_config = {\n                title: viz.get(\"name\"),\n                type: \"other\",\n                content: function(parent_elt) {\n                    // Create view config.\n                    var view_config = {\n                        container: parent_elt,\n                        name: viz.get(\"title\"),\n                        id: viz.id,\n                        // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n                        dbkey: viz.get(\"dbkey\"),\n                        stand_alone: false\n                    };\n\n                    var latest_revision = viz.get(\"latest_revision\");\n                    var drawables = latest_revision.config.view.drawables;\n\n                    // Set up datasets in drawables.\n                    _.each(drawables, d => {\n                        d.dataset = {\n                            hda_ldda: d.hda_ldda,\n                            id: d.dataset_id\n                        };\n                    });\n                    ui.create_visualization(\n                        view_config,\n                        latest_revision.config.viewport,\n                        latest_revision.config.view.drawables,\n                        latest_revision.config.bookmarks,\n                        false\n                    );\n                }\n            };\n            self.add(frame_config);\n        });\n    },\n\n    /** Add and display a new frame/window based on options. */\n    add: function(options) {\n        if (options.target == \"_blank\") {\n            window.open(options.url);\n        } else if (options.target == \"_top\" || options.target == \"_parent\" || options.target == \"_self\") {\n            window.location = options.url;\n        } else if (!this.active || options.noscratchbook) {\n            var $galaxy_main = $(window.parent.document).find(\"#galaxy_main\");\n            if (options.target == \"galaxy_main\" || options.target == \"center\") {\n                if ($galaxy_main.length === 0) {\n                    window.location = this._build_url(options.url, { use_panels: true });\n                } else {\n                    $galaxy_main.attr(\"src\", options.url);\n                }\n            } else window.location = options.url;\n        } else {\n            options.url = this._build_url(options.url, { hide_panels: true, hide_masthead: true });\n            this.frames.add(options);\n        }\n    },\n\n    /** Url helper */\n    _build_url: function(url, options) {\n        if (url) {\n            url += url.indexOf(\"?\") == -1 ? \"?\" : \"&\";\n            url += $.param(options, true);\n            return url;\n        }\n    }\n});\n"]}