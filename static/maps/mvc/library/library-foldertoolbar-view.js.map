{"version":3,"sources":["mvc/library/library-foldertoolbar-view.js"],"names":["FolderToolbarView","Backbone","View","extend","el","events","defaults","can_add_library_item","contains_file_or_folder","chain_call_control","total_number","failed_number","disabled_jstree_element","modal","jstree","histories","select_genome","select_extension","list_extensions","auto","id","text","description","list_genomes","initialize","options","_","fetchExtAndGenomes","render","toolbar_template","templateToolBar","template_defaults","is_admin","is_anonym","multiple_add_dataset_options","Galaxy","user","isAdmin","isAnonymous","config","user_library_import_dir","allow_library_path_paste","library_import_dir","$el","html","renderPaginator","paginator_template","templatePaginator","$","find","show_page","parseInt","page_count","total_items_count","items_shown","folder_page_size","libraries","preferences","get","configureElements","show","hide","tooltip","trigger","createFolderFromModal","event","preventDefault","stopPropagation","template","templateNewFolderInModal","closing_events","title","body","buttons","Create","createNewFolderEvent","Close","folderDetails","serializeNewFolder","validateNewFolder","folder","FolderAsModel","url_items","history","fragment","split","current_folder_id","indexOf","length","url","urlRoot","save","success","set","type","folderListView","collection","add","error","model","response","responseJSON","err_msg","name","val","importToHistoryModal","e","$checkedValues","findCheckedRows","templateImportIntoHistoryModal","info","promise","fetchUserHistories","done","models","Import","importAllIntoHistory","fail","GalaxyHistories","fetch","disableButton","new_history_name","createNewHistory","processImportToHistory","new_history","xhr","status","always","enableButton","history_id","history_name","post","root","checked_items","findCheckedItems","items_to_import","i","dataset_ids","library_dataset_id","historyItem","HistoryItem","content","source","push","folder_ids","library_folder_id","initChainCallControl","action","jQuery","getJSON","chainCallImportingIntoHistory","updateProgress","progress","progressStep","width","Math","round","txt_representation","download","format","data","ld_ids","processDownload","method","param","inputs","each","pair","appendTo","submit","remove","addFilesFromHistoryModal","template_modal","templateAddFilesFromHistory","Add","addAllDatasetsFromHistory","closing_callback","library_router","navigate","fetchAndDisplayHistoryContents","change","target","value","importFilesFromPathModal","templateImportPathModal","importFromPathsClicked","renderSelectBoxes","key","datatypes","extension","description_url","sort","a","b","unshift","cache","genomes","css","container","importFilesFromGalaxyFolderModal","templateBrowserModal","importFromJstreePath","bind","renderJstree","Jstree","core","plugins","types","icon","file","checkbox","three_state","err_code","warning","preserve_dirs","is","link_data","space_to_tab","to_posix_lines","tag_using_filenames","file_type","dbkey","paths","valid_paths","trimmed","trim","chainCallImportingFolders","templateAddingDatasetsProgressBar","folder_name","templateDeletingItemsProgressBar","templateImportIntoHistoryProgressBar","emit","that","all_nodes","get_selected","selected_nodes","filter","node","state","disabled","selection_type","li_attr","full_path","undefined","full_source","chainCallImportingUserdirFiles","history_contents","HistoryContents","history_contents_template","templateHistoryContents","contents","reverse","prop","checked_hdas","history_item_ids","history_item_types","items_to_add","hid","closest","item_type","history_item_id","folder_item","Item","from_hdca_id","from_hda_id","chainCallAddingHdas","history_item_set","popped_item","pop","onclick","window","location","when","hdas_set","added_hdas","Folder","chainCallDeletingItems","items_to_delete","deleted_items","item_to_delete","destroy","include_deleted","updated_item","item","model_class","checkIncludeDeleted","checked","fetchFolder","deleteSelectedItems","row_id","toString","substring","items_total","dataset","showLocInfo","library","libraryListView","parent_library_id","showLocInfoModal","Library","templateLocInfoInModal","showImportModal","back","showPageSizePrompt","prompt","showCollectionSelect","templateCollectionSelectModal","selected_datasets","Continue","showColectionBuilder","prepareCollectionTypeSelect","prepareHistoryTypeSelect","collectionType","select_collection_type","onchange","updateCollectionType","history_options","select_collection_history","collection_elements","elements_source","collection_item","folder_container","deleted","Collection","where","toJSON","collectionImport","selected_history_id","selected_history_name","modal_title","creator_class","creationFn","ListCollectionCreator","elements","hideSourceItems","map","element","src","createHDCA","collectionCreatorModal","defaultHideSourceItems","PairCollectionCreator","pairedCollectionCreatorModal","historyId","ruleBasedCollectionCreatorModal","elementIdentifiers","hdca","HistoryDatasetCollection","history_content_type","collection_type","hide_source_items","element_identifiers","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-foldertoolbar-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport mod_utils from \"utils/utils\";\nimport mod_toastr from \"libs/toastr\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_select from \"mvc/ui/ui-select\";\nimport LIST_CREATOR from \"mvc/collection/list-collection-creator\";\nimport PAIR_CREATOR from \"mvc/collection/pair-collection-creator\";\nimport PAIRED_CREATOR from \"mvc/collection/list-of-pairs-collection-creator\";\nimport HDCA_MODEL from \"mvc/history/hdca-model\";\nimport \"libs/jquery/jstree\";\n\nvar FolderToolbarView = Backbone.View.extend({\n    el: \"#center\",\n\n    events: {\n        \"click .toolbtn-create-folder\": \"createFolderFromModal\",\n        \"click .toolbtn-bulk-import\": \"importToHistoryModal\",\n        \"click .include-deleted-datasets-chk\": \"checkIncludeDeleted\",\n        \"click .toolbtn-bulk-delete\": \"deleteSelectedItems\",\n        \"click .toolbtn-show-locinfo\": \"showLocInfo\",\n        \"click .page-size-prompt\": \"showPageSizePrompt\",\n        \"click .toolbtn-collection-import\": \"showCollectionSelect\"\n    },\n\n    defaults: {\n        can_add_library_item: false,\n        contains_file_or_folder: false,\n        chain_call_control: {\n            total_number: 0,\n            failed_number: 0\n        },\n        disabled_jstree_element: \"folders\"\n    },\n\n    modal: null,\n\n    // directory browsing object\n    jstree: null,\n\n    // user's histories\n    histories: null,\n\n    // genome select\n    select_genome: null,\n\n    // extension select\n    select_extension: null,\n\n    // extension types\n    list_extensions: [],\n\n    // datatype placeholder for extension auto-detection\n    auto: {\n        id: \"auto\",\n        text: \"Auto-detect\",\n        description:\n            \"This system will try to detect the file type automatically.\" +\n            \" If your file is not detected properly as one of the known formats,\" +\n            \" it most likely means that it has some format problems (e.g., different\" +\n            \" number of columns on different rows). You can still coerce the system\" +\n            \" to set your data to the format you think it should be.\" +\n            \" You can also upload compressed files, which will automatically be decompressed.\"\n    },\n\n    // genomes\n    list_genomes: [],\n\n    initialize: function(options) {\n        this.options = _.defaults(options || {}, this.defaults);\n        this.fetchExtAndGenomes();\n        this.render();\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var toolbar_template = this.templateToolBar();\n        var template_defaults = {\n            id: this.options.id,\n            is_admin: false,\n            is_anonym: true,\n            multiple_add_dataset_options: false\n        };\n        if (Galaxy.user) {\n            template_defaults.is_admin = Galaxy.user.isAdmin();\n            template_defaults.is_anonym = Galaxy.user.isAnonymous();\n            if (\n                Galaxy.config.user_library_import_dir !== null ||\n                Galaxy.config.allow_library_path_paste !== false ||\n                Galaxy.config.library_import_dir !== null\n            ) {\n                template_defaults.multiple_add_dataset_options = true;\n            }\n        }\n        this.$el.html(toolbar_template(template_defaults));\n    },\n\n    /**\n     * Called from FolderListView when needed.\n     * @param  {object} options common options\n     */\n    renderPaginator: function(options) {\n        this.options = _.extend(this.options, options);\n        var paginator_template = this.templatePaginator();\n        $(\"body\")\n            .find(\".folder-paginator\")\n            .html(\n                paginator_template({\n                    id: this.options.id,\n                    show_page: parseInt(this.options.show_page),\n                    page_count: parseInt(this.options.page_count),\n                    total_items_count: this.options.total_items_count,\n                    items_shown: this.options.items_shown,\n                    folder_page_size: Galaxy.libraries.preferences.get(\"folder_page_size\")\n                })\n            );\n    },\n\n    configureElements: function(options) {\n        this.options = _.extend(this.options, options);\n\n        if (this.options.can_add_library_item === true) {\n            $(\".add-library-items\").show();\n        } else {\n            $(\".add-library-items\").hide();\n        }\n        if (this.options.contains_file_or_folder === true) {\n            if (Galaxy.user) {\n                if (!Galaxy.user.isAnonymous()) {\n                    $(\".logged-dataset-manipulation\").show();\n                    $(\".dataset-manipulation\").show();\n                } else {\n                    $(\".dataset-manipulation\").show();\n                    $(\".logged-dataset-manipulation\").hide();\n                }\n            } else {\n                $(\".logged-dataset-manipulation\").hide();\n                $(\".dataset-manipulation\").hide();\n            }\n        } else {\n            $(\".logged-dataset-manipulation\").hide();\n            $(\".dataset-manipulation\").hide();\n        }\n        this.$el.find('[data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    createFolderFromModal: function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        var template = this.templateNewFolderInModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Create New Folder\"),\n            body: template(),\n            buttons: {\n                Create: () => {\n                    this.createNewFolderEvent();\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    },\n\n    createNewFolderEvent: function() {\n        var folderDetails = this.serializeNewFolder();\n        if (this.validateNewFolder(folderDetails)) {\n            var folder = new mod_library_model.FolderAsModel();\n            var url_items = Backbone.history.fragment.split(\"/\");\n            var current_folder_id;\n            if (url_items.indexOf(\"page\") > -1) {\n                current_folder_id = url_items[url_items.length - 3];\n            } else {\n                current_folder_id = url_items[url_items.length - 1];\n            }\n            folder.url = folder.urlRoot + current_folder_id;\n\n            folder.save(folderDetails, {\n                success: function(folder) {\n                    Galaxy.modal.hide();\n                    mod_toastr.success(\"Folder created.\");\n                    folder.set({ type: \"folder\" });\n                    Galaxy.libraries.folderListView.collection.add(folder);\n                },\n                error: function(model, response) {\n                    Galaxy.modal.hide();\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occurred.\");\n                    }\n                }\n            });\n        } else {\n            mod_toastr.error(\"Folder's name is missing.\");\n        }\n        return false;\n    },\n\n    serializeNewFolder: function() {\n        return {\n            name: $(\"input[name='Name']\").val(),\n            description: $(\"input[name='Description']\").val()\n        };\n    },\n\n    validateNewFolder: function(folderDetails) {\n        return folderDetails.name !== \"\";\n    },\n\n    importToHistoryModal: function(e) {\n        e.preventDefault();\n        var $checkedValues = this.findCheckedRows();\n        var template = this.templateImportIntoHistoryModal();\n        if ($checkedValues.length === 0) {\n            mod_toastr.info(\"You must select some datasets first.\");\n        } else {\n            var promise = this.fetchUserHistories();\n            promise\n                .done(() => {\n                    this.modal = Galaxy.modal;\n                    this.modal.show({\n                        closing_events: true,\n                        title: _l(\"Import into History\"),\n                        body: template({\n                            histories: this.histories.models\n                        }),\n                        buttons: {\n                            Import: () => {\n                                this.importAllIntoHistory();\n                            },\n                            Close: () => {\n                                Galaxy.modal.hide();\n                            }\n                        }\n                    });\n                })\n                .fail((model, response) => {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occurred.\");\n                    }\n                });\n        }\n    },\n\n    fetchUserHistories: function() {\n        this.histories = new mod_library_model.GalaxyHistories();\n        var promise = this.histories.fetch();\n        return promise;\n    },\n\n    importAllIntoHistory: function() {\n        this.modal.disableButton(\"Import\");\n        var new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        if (new_history_name !== \"\") {\n            this.createNewHistory(new_history_name)\n                .done(new_history => {\n                    this.processImportToHistory(new_history.id, new_history.name);\n                })\n                .fail((xhr, status, error) => {\n                    mod_toastr.error(\"An error occurred.\");\n                })\n                .always(() => {\n                    this.modal.enableButton(\"Import\");\n                });\n        } else {\n            var history_id = $(\"select[name=import_to_history] option:selected\").val();\n            var history_name = $(\"select[name=import_to_history] option:selected\").text();\n            this.processImportToHistory(history_id, history_name);\n            this.modal.enableButton(\"Import\");\n        }\n    },\n\n    createNewHistory: function(new_history_name) {\n        var promise = $.post(`${Galaxy.root}api/histories`, { name: new_history_name });\n        return promise;\n    },\n\n    processImportToHistory: function(history_id, history_name) {\n        var checked_items = this.findCheckedItems();\n        var items_to_import = [];\n        // prepare the dataset objects to be imported\n        for (let i = checked_items.dataset_ids.length - 1; i >= 0; i--) {\n            var library_dataset_id = checked_items.dataset_ids[i];\n            var historyItem = new mod_library_model.HistoryItem();\n            historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n            historyItem.content = library_dataset_id;\n            historyItem.source = \"library\";\n            items_to_import.push(historyItem);\n        }\n        // prepare the folder objects to be imported\n        for (let i = checked_items.folder_ids.length - 1; i >= 0; i--) {\n            var library_folder_id = checked_items.folder_ids[i];\n            var historyItem = new mod_library_model.HistoryItem();\n            historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n            historyItem.content = library_folder_id;\n            historyItem.source = \"library_folder\";\n            items_to_import.push(historyItem);\n        }\n        this.initChainCallControl({\n            length: items_to_import.length,\n            action: \"to_history\",\n            history_name: history_name\n        });\n        // set the used history as current so user will see the last one\n        // that he imported into in the history panel on the 'analysis' page\n        jQuery.getJSON(`${Galaxy.root}history/set_as_current?id=${history_id}`);\n        this.chainCallImportingIntoHistory(items_to_import, history_name);\n    },\n\n    /**\n     * Update progress bar in modal.\n     */\n    updateProgress: function() {\n        this.progress += this.progressStep;\n        $(\".progress-bar-import\").width(`${Math.round(this.progress)}%`);\n        var txt_representation = `${Math.round(this.progress)}% Complete`;\n        $(\".completion_span\").text(txt_representation);\n    },\n\n    /**\n     * Download selected datasets. Called from the router.\n     * @param  {str} format    requested archive format\n     */\n    download: function(format) {\n        var checked_items = this.findCheckedItems();\n        var url = `${Galaxy.root}api/libraries/datasets/download/${format}`;\n        var data = { ld_ids: checked_items.dataset_ids, folder_ids: checked_items.folder_ids };\n        this.processDownload(url, data, \"get\");\n    },\n\n    /**\n     * Create hidden form and submit it through POST\n     * to initialize the download.\n     * @param  {str} url    url to call\n     * @param  {obj} data   data to include in the request\n     * @param  {str} method method of the request\n     */\n    processDownload: function(url, data, method) {\n        if (url && data) {\n            // data can be string of parameters or array/object\n            data = typeof data === \"string\" ? data : $.param(data);\n            // split params into form inputs\n            var inputs = \"\";\n            $.each(data.split(\"&\"), function() {\n                var pair = this.split(\"=\");\n                inputs += `<input type=\"hidden\" name=\"${pair[0]}\" value=\"${pair[1]}\" />`;\n            });\n            // send request\n            $(`<form action=\"${url}\" method=\"${method || \"post\"}\">${inputs}</form>`)\n                .appendTo(\"body\")\n                .submit()\n                .remove();\n            mod_toastr.info(\"Your download will begin soon.\");\n        } else {\n            mod_toastr.error(\"An error occurred.\");\n        }\n    },\n\n    addFilesFromHistoryModal: function() {\n        this.histories = new mod_library_model.GalaxyHistories();\n        this.histories\n            .fetch()\n            .done(() => {\n                this.modal = Galaxy.modal;\n                var template_modal = this.templateAddFilesFromHistory();\n                this.modal.show({\n                    closing_events: true,\n                    title: _l(\"Adding datasets from your history\"),\n                    body: template_modal({\n                        histories: this.histories.models\n                    }),\n                    buttons: {\n                        Add: () => {\n                            this.addAllDatasetsFromHistory();\n                        },\n                        Close: () => {\n                            Galaxy.modal.hide();\n                        }\n                    },\n                    closing_callback: () => {\n                        Galaxy.libraries.library_router.navigate(`folders/${this.id}`, { trigger: true });\n                    }\n                });\n                this.fetchAndDisplayHistoryContents(this.histories.models[0].id);\n                $(\"#dataset_add_bulk\").change(event => {\n                    this.fetchAndDisplayHistoryContents(event.target.value);\n                });\n            })\n            .fail((model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\"An error occurred.\");\n                }\n            });\n    },\n\n    /**\n     * Create modal for importing from Galaxy path.\n     */\n    importFilesFromPathModal: function() {\n        this.modal = Galaxy.modal;\n        var template_modal = this.templateImportPathModal();\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Please enter paths to import\"),\n            body: template_modal({}),\n            buttons: {\n                Import: () => {\n                    this.importFromPathsClicked(this);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            },\n            closing_callback: () => {\n                //  TODO: should not trigger routes outside of the router\n                Galaxy.libraries.library_router.navigate(`folders/${this.id}`, {\n                    trigger: true\n                });\n            }\n        });\n        this.renderSelectBoxes();\n    },\n\n    /**\n     * Request all extensions and genomes from Galaxy\n     * and save them in sorted arrays.\n     */\n    fetchExtAndGenomes: function() {\n        mod_utils.get({\n            url: `${Galaxy.root}api/datatypes?extension_only=False`,\n            success: datatypes => {\n                this.list_extensions = [];\n                for (let key in datatypes) {\n                    this.list_extensions.push({\n                        id: datatypes[key].extension,\n                        text: datatypes[key].extension,\n                        description: datatypes[key].description,\n                        description_url: datatypes[key].description_url\n                    });\n                }\n                this.list_extensions.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n                this.list_extensions.unshift(this.auto);\n            },\n            cache: true\n        });\n        mod_utils.get({\n            url: `${Galaxy.root}api/genomes`,\n            success: genomes => {\n                this.list_genomes = [];\n                for (let key in genomes) {\n                    this.list_genomes.push({\n                        id: genomes[key][1],\n                        text: genomes[key][0]\n                    });\n                }\n                this.list_genomes.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n            },\n            cache: true\n        });\n    },\n\n    renderSelectBoxes: function() {\n        // This won't work properly unlesss we already have the data fetched.\n        // See this.fetchExtAndGenomes()\n        this.select_genome = new mod_select.View({\n            css: \"library-genome-select\",\n            data: this.list_genomes,\n            container: Galaxy.modal.$el.find(\"#library_genome_select\"),\n            value: \"?\"\n        });\n        this.select_extension = new mod_select.View({\n            css: \"library-extension-select\",\n            data: this.list_extensions,\n            container: Galaxy.modal.$el.find(\"#library_extension_select\"),\n            value: \"auto\"\n        });\n    },\n\n    /**\n     * Create modal for importing from given directory\n     * on Galaxy. Bind jQuery events.\n     */\n    importFilesFromGalaxyFolderModal: function(options) {\n        var template_modal = this.templateBrowserModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Please select folders or files\"),\n            body: template_modal({}),\n            buttons: {\n                Import: () => {\n                    this.importFromJstreePath(this, options);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            },\n            closing_callback: () => {\n                //  TODO: should not trigger routes outside of the router\n                Galaxy.libraries.library_router.navigate(`folders/${this.id}`, {\n                    trigger: true\n                });\n            }\n        });\n\n        $(\".libimport-select-all\").bind(\"click\", () => {\n            $(\"#jstree_browser\").jstree(\"check_all\");\n        });\n        $(\".libimport-select-none\").bind(\"click\", () => {\n            $(\"#jstree_browser\").jstree(\"uncheck_all\");\n        });\n\n        this.renderSelectBoxes();\n        options.disabled_jstree_element = \"folders\";\n        this.renderJstree(options);\n\n        $(\"input[type=radio]\").change(event => {\n            if (event.target.value === \"jstree-disable-folders\") {\n                options.disabled_jstree_element = \"folders\";\n                this.renderJstree(options);\n                $(\".jstree-folders-message\").hide();\n                $(\".jstree-preserve-structure\").hide();\n                $(\".jstree-files-message\").show();\n            } else if (event.target.value === \"jstree-disable-files\") {\n                $(\".jstree-files-message\").hide();\n                $(\".jstree-folders-message\").show();\n                $(\".jstree-preserve-structure\").show();\n                options.disabled_jstree_element = \"files\";\n                this.renderJstree(options);\n            }\n        });\n    },\n\n    /**\n     * Fetch the contents of user directory on Galaxy\n     * and render jstree component based on received\n     * data.\n     * @param  {[type]} options [description]\n     */\n    renderJstree: function(options) {\n        this.options = _.extend(this.options, options);\n        var target = options.source || \"userdir\";\n        var disabled_jstree_element = this.options.disabled_jstree_element;\n        this.jstree = new mod_library_model.Jstree();\n        this.jstree.url = `${this.jstree.urlRoot}?target=${target}&format=jstree&disable=${disabled_jstree_element}`;\n        this.jstree.fetch({\n            success: (model, response) => {\n                $(\"#jstree_browser\").jstree(\"destroy\");\n                $(\"#jstree_browser\").jstree({\n                    core: {\n                        data: model\n                    },\n                    plugins: [\"types\", \"checkbox\"],\n                    types: {\n                        folder: {\n                            icon: \"jstree-folder\"\n                        },\n                        file: {\n                            icon: \"jstree-file\"\n                        }\n                    },\n                    checkbox: {\n                        three_state: false\n                    }\n                });\n            },\n            error: (model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    if (response.responseJSON.err_code === 404001) {\n                        mod_toastr.warning(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    }\n                } else {\n                    mod_toastr.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    /**\n     * Take the paths from the textarea, split it, create\n     * a request queue and call a function that starts sending\n     * one by one to be imported on the server.\n     */\n    importFromPathsClicked: function() {\n        var preserve_dirs = this.modal.$el.find(\".preserve-checkbox\").is(\":checked\");\n        var link_data = this.modal.$el.find(\".link-checkbox\").is(\":checked\");\n        var space_to_tab = this.modal.$el.find(\".spacetab-checkbox\").is(\":checked\");\n        var to_posix_lines = this.modal.$el.find(\".posix-checkbox\").is(\":checked\");\n        var tag_using_filenames = this.modal.$el.find(\".tag-files\").is(\":checked\");\n        var file_type = this.select_extension.value();\n        var dbkey = this.select_genome.value();\n        var paths = $(\"textarea#import_paths\").val();\n        var valid_paths = [];\n        if (!paths) {\n            mod_toastr.info(\"Please enter a path relative to Galaxy root.\");\n        } else {\n            this.modal.disableButton(\"Import\");\n            paths = paths.split(\"\\n\");\n            for (let i = paths.length - 1; i >= 0; i--) {\n                var trimmed = paths[i].trim();\n                if (trimmed.length !== 0) {\n                    valid_paths.push(trimmed);\n                }\n            }\n            this.initChainCallControl({\n                length: valid_paths.length,\n                action: \"adding_datasets\"\n            });\n            this.chainCallImportingFolders({\n                paths: valid_paths,\n                preserve_dirs: preserve_dirs,\n                link_data: link_data,\n                space_to_tab: space_to_tab,\n                to_posix_lines: to_posix_lines,\n                source: \"admin_path\",\n                file_type: file_type,\n                tag_using_filenames: tag_using_filenames,\n                dbkey: dbkey\n            });\n        }\n    },\n\n    /**\n     * Initialize the control of chaining requests\n     * in the current modal.\n     * @param {int} length The number of items in the chain call.\n     */\n    initChainCallControl: function(options) {\n        var template;\n        switch (options.action) {\n            case \"adding_datasets\":\n                template = this.templateAddingDatasetsProgressBar();\n                this.modal.$el.find(\".modal-body\").html(\n                    template({\n                        folder_name: this.options.folder_name\n                    })\n                );\n                break;\n            case \"deleting_datasets\":\n                template = this.templateDeletingItemsProgressBar();\n                this.modal.$el.find(\".modal-body\").html(template());\n                break;\n            case \"to_history\":\n                template = this.templateImportIntoHistoryProgressBar();\n                this.modal.$el.find(\".modal-body\").html(template({ history_name: options.history_name }));\n                break;\n            default:\n                Galaxy.emit.error(\"Wrong action specified.\", \"datalibs\");\n                break;\n        }\n\n        // var progress_bar_tmpl = this.templateAddingDatasetsProgressBar();\n        // this.modal.$el.find( '.modal-body' ).html( progress_bar_tmpl( { folder_name : this.options.folder_name } ) );\n        this.progress = 0;\n        this.progressStep = 100 / options.length;\n        this.options.chain_call_control.total_number = options.length;\n        this.options.chain_call_control.failed_number = 0;\n    },\n\n    /**\n     * Take the selected items from the jstree, create a request queue\n     * and send them one by one to the server for importing into\n     * the current folder.\n     *\n     * jstree.js has to be loaded before\n     * @see renderJstree\n     */\n    importFromJstreePath: function(that, options) {\n        var all_nodes = $(\"#jstree_browser\")\n            .jstree()\n            .get_selected(true);\n        // remove the disabled elements that could have been trigerred with the 'select all'\n        var selected_nodes = _.filter(all_nodes, node => node.state.disabled == false);\n        var preserve_dirs = this.modal.$el.find(\".preserve-checkbox\").is(\":checked\");\n        var link_data = this.modal.$el.find(\".link-checkbox\").is(\":checked\");\n        var space_to_tab = this.modal.$el.find(\".spacetab-checkbox\").is(\":checked\");\n        var to_posix_lines = this.modal.$el.find(\".posix-checkbox\").is(\":checked\");\n        var file_type = this.select_extension.value();\n        var dbkey = this.select_genome.value();\n        var tag_using_filenames = this.modal.$el.find(\".tag-files\").is(\":checked\");\n        var selection_type = selected_nodes[0].type;\n        var paths = [];\n        if (selected_nodes.length < 1) {\n            mod_toastr.info(\"Please select some items first.\");\n        } else {\n            this.modal.disableButton(\"Import\");\n            for (let i = selected_nodes.length - 1; i >= 0; i--) {\n                if (selected_nodes[i].li_attr.full_path !== undefined) {\n                    paths.push(selected_nodes[i].li_attr.full_path);\n                }\n            }\n            this.initChainCallControl({\n                length: paths.length,\n                action: \"adding_datasets\"\n            });\n            if (selection_type === \"folder\") {\n                var full_source = `${options.source}_folder`;\n                this.chainCallImportingFolders({\n                    paths: paths,\n                    preserve_dirs: preserve_dirs,\n                    link_data: link_data,\n                    space_to_tab: space_to_tab,\n                    to_posix_lines: to_posix_lines,\n                    source: full_source,\n                    file_type: file_type,\n                    dbkey: dbkey,\n                    tag_using_filenames: tag_using_filenames\n                });\n            } else if (selection_type === \"file\") {\n                var full_source = `${options.source}_file`;\n                this.chainCallImportingUserdirFiles({\n                    paths: paths,\n                    file_type: file_type,\n                    dbkey: dbkey,\n                    link_data: link_data,\n                    space_to_tab: space_to_tab,\n                    to_posix_lines: to_posix_lines,\n                    source: full_source,\n                    tag_using_filenames: tag_using_filenames\n                });\n            }\n        }\n    },\n\n    fetchAndDisplayHistoryContents: function(history_id) {\n        var history_contents = new mod_library_model.HistoryContents({\n            id: history_id\n        });\n        history_contents.fetch({\n            success: history_contents => {\n                var history_contents_template = this.templateHistoryContents();\n                this.histories.get(history_id).set({ contents: history_contents });\n                this.modal.$el.find(\".library_selected_history_content\").html(\n                    history_contents_template({\n                        history_contents: history_contents.models.reverse()\n                    })\n                );\n                this.modal.$el.find(\".history-import-select-all\").bind(\"click\", () => {\n                    $(\".library_selected_history_content [type=checkbox]\").prop(\"checked\", true);\n                });\n                this.modal.$el.find(\".history-import-unselect-all\").bind(\"click\", () => {\n                    $(\".library_selected_history_content [type=checkbox]\").prop(\"checked\", false);\n                });\n            },\n            error: (model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    /**\n     * Import all selected datasets from history into the current folder.\n     */\n    addAllDatasetsFromHistory: function() {\n        var checked_hdas = this.modal.$el.find(\".library_selected_history_content\").find(\":checked\");\n        var history_item_ids = []; // can be hda or hdca\n        var history_item_types = [];\n        var items_to_add = [];\n        if (checked_hdas.length < 1) {\n            mod_toastr.info(\"You must select some datasets first.\");\n        } else {\n            this.modal.disableButton(\"Add\");\n            checked_hdas.each(function() {\n                var hid = $(this)\n                    .closest(\"li\")\n                    .data(\"id\");\n                if (hid) {\n                    var item_type = $(this)\n                        .closest(\"li\")\n                        .data(\"name\");\n                    history_item_ids.push(hid);\n                    history_item_types.push(item_type);\n                }\n            });\n            for (let i = history_item_ids.length - 1; i >= 0; i--) {\n                var history_item_id = history_item_ids[i];\n                var folder_item = new mod_library_model.Item();\n                folder_item.url = `${Galaxy.root}api/folders/${this.options.id}/contents`;\n                if (history_item_types[i] === \"collection\") {\n                    folder_item.set({ from_hdca_id: history_item_id });\n                } else {\n                    folder_item.set({ from_hda_id: history_item_id });\n                }\n                items_to_add.push(folder_item);\n            }\n            this.initChainCallControl({\n                length: items_to_add.length,\n                action: \"adding_datasets\"\n            });\n            this.chainCallAddingHdas(items_to_add);\n        }\n    },\n\n    /**\n     * Take array of empty history items and make request for each of them\n     * to create it on server. Update progress in between calls.\n     * @param  {array} history_item_set array of empty history items\n     * @param  {str} history_name     name of the history to import to\n     */\n    chainCallImportingIntoHistory: function(history_item_set, history_name) {\n        var popped_item = history_item_set.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected datasets imported into history. Click this to start analyzing it.\", \"\", {\n                    onclick: () => {\n                        window.location = Galaxy.root;\n                    }\n                });\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                mod_toastr.error(\"There was an error and no datasets were imported into history.\");\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                mod_toastr.warning(\n                    \"Some of the datasets could not be imported into history. Click this to see what was imported.\",\n                    \"\",\n                    {\n                        onclick: () => {\n                            window.location = Galaxy.root;\n                        }\n                    }\n                );\n            }\n            Galaxy.modal.hide();\n            return true;\n        }\n        var promise = $.when(\n            popped_item.save({\n                content: popped_item.content,\n                source: popped_item.source\n            })\n        );\n\n        promise\n            .done(() => {\n                this.updateProgress();\n                this.chainCallImportingIntoHistory(history_item_set, history_name);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingIntoHistory(history_item_set, history_name);\n            });\n    },\n\n    /**\n     * Take the array of paths and create a request for each of them\n     * calling them in chain. Update the progress bar in between each.\n     * @param  {array} paths                    paths relative to user folder on Galaxy\n     * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n     */\n    chainCallImportingUserdirFiles: function(options) {\n        var popped_item = options.paths.pop();\n        if (typeof popped_item === \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected files imported into the current folder\");\n                Galaxy.modal.hide();\n            } else {\n                mod_toastr.error(\"An error occured.\");\n            }\n            return true;\n        }\n        var promise = $.when(\n            $.post(\n                `${Galaxy.root}api/libraries/datasets?encoded_folder_id=${this.id}&source=${\n                    options.source\n                }&path=${popped_item}&file_type=${options.file_type}&link_data=${options.link_data}&space_to_tab=${\n                    options.space_to_tab\n                }&to_posix_lines=${options.to_posix_lines}&dbkey=${options.dbkey}&tag_using_filenames=${\n                    options.tag_using_filenames\n                }`\n            )\n        );\n        promise\n            .done(response => {\n                this.updateProgress();\n                this.chainCallImportingUserdirFiles(options);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingUserdirFiles(options);\n            });\n    },\n\n    /**\n     * Take the array of paths and create a request for each of them\n     * calling them in series. Update the progress bar in between each.\n     * @param  {array} paths                    paths relative to Galaxy root folder\n     * @param  {boolean} preserve_dirs          indicates whether to preserve folder structure\n     * @param  {boolean} link_data              copy files to Galaxy or link instead\n     * @param  {boolean} to_posix_lines         convert line endings to POSIX standard\n     * @param  {boolean} space_to_tab           convert spaces to tabs\n     * @param  {str} source                     string representing what type of folder\n     *                                          is the source of import\n     * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n     */\n    chainCallImportingFolders: function(options) {\n        // TODO need to check which paths to call\n        var popped_item = options.paths.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected folders and their contents imported into the current folder.\");\n                Galaxy.modal.hide();\n            } else {\n                // TODO better error report\n                mod_toastr.error(\"An error occured.\");\n            }\n            return true;\n        }\n        var promise = $.when(\n            $.post(\n                `${Galaxy.root}api/libraries/datasets?encoded_folder_id=${this.id}&source=${\n                    options.source\n                }&path=${popped_item}&preserve_dirs=${options.preserve_dirs}&link_data=${\n                    options.link_data\n                }&to_posix_lines=${options.to_posix_lines}&space_to_tab=${options.space_to_tab}&file_type=${\n                    options.file_type\n                }&dbkey=${options.dbkey}&tag_using_filenames=${options.tag_using_filenames}`\n            )\n        );\n        promise\n            .done(response => {\n                this.updateProgress();\n                this.chainCallImportingFolders(options);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingFolders(options);\n            });\n    },\n\n    /**\n     * Take the array of hdas and create a request for each.\n     * Call them in chain and update progress bar in between each.\n     * @param  {array} hdas_set array of empty hda objects\n     */\n    chainCallAddingHdas: function(hdas_set) {\n        this.added_hdas = new mod_library_model.Folder();\n        var popped_item = hdas_set.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected datasets from history added to the folder\");\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                mod_toastr.error(\"There was an error and no datasets were added to the folder.\");\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                mod_toastr.warning(\"Some of the datasets could not be added to the folder\");\n            }\n            Galaxy.modal.hide();\n            return this.added_hdas;\n        }\n        var promise = $.when(\n            popped_item.save({\n                from_hda_id: popped_item.get(\"from_hda_id\")\n            })\n        );\n\n        promise\n            .done(model => {\n                Galaxy.libraries.folderListView.collection.add(model);\n                this.updateProgress();\n                this.chainCallAddingHdas(hdas_set);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallAddingHdas(hdas_set);\n            });\n    },\n\n    /**\n     * Take the array of lddas, create request for each and\n     * call them in chain. Update progress bar in between each.\n     * @param  {array} lddas_set array of lddas to delete\n     */\n    chainCallDeletingItems: function(items_to_delete) {\n        this.deleted_items = new mod_library_model.Folder();\n        var item_to_delete = items_to_delete.pop();\n        if (typeof item_to_delete === \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected items were deleted.\");\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                mod_toastr.error(\n                    \"There was an error and no items were deleted. Please make sure you have sufficient permissions.\"\n                );\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                mod_toastr.warning(\n                    \"Some of the items could not be deleted. Please make sure you have sufficient permissions.\"\n                );\n            }\n            Galaxy.modal.hide();\n            return this.deleted_items;\n        }\n        item_to_delete\n            .destroy()\n            .done(item => {\n                Galaxy.libraries.folderListView.collection.remove(item_to_delete.id);\n                this.updateProgress();\n                // add the deleted item to collection, triggers rendering\n                if (Galaxy.libraries.folderListView.options.include_deleted) {\n                    var updated_item = null;\n                    if (item.type === \"folder\" || item.model_class === \"LibraryFolder\") {\n                        updated_item = new mod_library_model.FolderAsModel(item);\n                    } else if (item.type === \"file\" || item.model_class === \"LibraryDataset\") {\n                        updated_item = new mod_library_model.Item(item);\n                    } else {\n                        Galaxy.emit.error(\"Unknown library item type found.\", \"datalibs\");\n                        Galaxy.emit.error(item.type || item.model_class, \"datalibs\");\n                    }\n                    Galaxy.libraries.folderListView.collection.add(updated_item);\n                }\n                this.chainCallDeletingItems(items_to_delete);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallDeletingItems(items_to_delete);\n            });\n    },\n\n    /**\n     * Handles the click on 'show deleted' checkbox\n     */\n    checkIncludeDeleted: function(event) {\n        if (event.target.checked) {\n            Galaxy.libraries.folderListView.fetchFolder({\n                include_deleted: true\n            });\n        } else {\n            Galaxy.libraries.folderListView.fetchFolder({\n                include_deleted: false\n            });\n        }\n    },\n\n    /**\n     * Delete the selected items. Atomic. One by one.\n     */\n    deleteSelectedItems: function() {\n        var dataset_ids = [];\n        var folder_ids = [];\n        var $checkedValues = this.findCheckedRows();\n        if ($checkedValues.length === 0) {\n            mod_toastr.info(\"You must select at least one item for deletion.\");\n        } else {\n            var template = this.templateDeletingItemsProgressBar();\n            this.modal = Galaxy.modal;\n            this.modal.show({\n                closing_events: true,\n                title: _l(\"Deleting selected items\"),\n                body: template({}),\n                buttons: {\n                    Close: () => {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n            // init the control counters\n            this.options.chain_call_control.total_number = 0;\n            this.options.chain_call_control.failed_number = 0;\n            $checkedValues.each(function() {\n                var row_id = $(this)\n                    .closest(\"tr\")\n                    .data(\"id\")\n                    .toString();\n                if (row_id !== undefined) {\n                    if (row_id.substring(0, 1) == \"F\") {\n                        folder_ids.push(row_id);\n                    } else {\n                        dataset_ids.push(row_id);\n                    }\n                }\n            });\n            // init the progress bar\n            var items_total = dataset_ids.length + folder_ids.length;\n            this.progressStep = 100 / items_total;\n            this.progress = 0;\n\n            // prepare the dataset items to be added\n            var items_to_delete = [];\n            for (let i = dataset_ids.length - 1; i >= 0; i--) {\n                var dataset = new mod_library_model.Item({\n                    id: dataset_ids[i]\n                });\n                items_to_delete.push(dataset);\n            }\n            for (let i = folder_ids.length - 1; i >= 0; i--) {\n                var folder = new mod_library_model.FolderAsModel({\n                    id: folder_ids[i]\n                });\n                items_to_delete.push(folder);\n            }\n\n            this.options.chain_call_control.total_number = items_total;\n            // call the recursive function to call ajax one after each other (request FIFO queue)\n            this.chainCallDeletingItems(items_to_delete);\n        }\n    },\n\n    showLocInfo: function() {\n        var library = null;\n        if (Galaxy.libraries.libraryListView !== null) {\n            library = Galaxy.libraries.libraryListView.collection.get(this.options.parent_library_id);\n            this.showLocInfoModal(library);\n        } else {\n            library = new mod_library_model.Library({\n                id: this.options.parent_library_id\n            });\n            library.fetch({\n                success: () => {\n                    this.showLocInfoModal(library);\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occurred.\");\n                    }\n                }\n            });\n        }\n    },\n\n    showLocInfoModal: function(library) {\n        var template = this.templateLocInfoInModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Location Details\"),\n            body: template({ library: library, options: this.options }),\n            buttons: {\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    },\n\n    showImportModal: function(options) {\n        switch (options.source) {\n            case \"history\":\n                this.addFilesFromHistoryModal();\n                break;\n            case \"importdir\":\n                this.importFilesFromGalaxyFolderModal({\n                    source: \"importdir\"\n                });\n                break;\n            case \"path\":\n                this.importFilesFromPathModal();\n                break;\n            case \"userdir\":\n                this.importFilesFromGalaxyFolderModal({\n                    source: \"userdir\"\n                });\n                break;\n            default:\n                Galaxy.libraries.library_router.back();\n                mod_toastr.error(\"Invalid import source.\");\n                break;\n        }\n    },\n\n    /**\n     * Show user the prompt to change the number of items shown on page.\n     */\n    showPageSizePrompt: function(e) {\n        e.preventDefault();\n        var folder_page_size = prompt(\n            \"How many items per page do you want to see?\",\n            Galaxy.libraries.preferences.get(\"folder_page_size\")\n        );\n        if (folder_page_size != null && folder_page_size == parseInt(folder_page_size)) {\n            Galaxy.libraries.preferences.set({\n                folder_page_size: parseInt(folder_page_size)\n            });\n            Galaxy.libraries.folderListView.render({\n                id: this.options.id,\n                show_page: 1\n            });\n        }\n    },\n\n    findCheckedRows: function() {\n        return $(\"#folder_list_body\").find(\":checked\");\n    },\n\n    findCheckedItems: function() {\n        var folder_ids = [];\n        var dataset_ids = [];\n        this.findCheckedRows().each(function() {\n            var row_id = $(this)\n                .closest(\"tr\")\n                .data(\"id\")\n                .toString();\n            if (row_id.substring(0, 1) == \"F\") {\n                folder_ids.push(row_id);\n            } else {\n                dataset_ids.push(row_id);\n            }\n        });\n        return { folder_ids: folder_ids, dataset_ids: dataset_ids };\n    },\n\n    showCollectionSelect: function(e) {\n        e.preventDefault();\n        var checked_items = this.findCheckedItems();\n        var template = this.templateCollectionSelectModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: \"Create History Collection from Datasets\",\n            body: template({ selected_datasets: checked_items.dataset_ids.length }),\n            buttons: {\n                Continue: () => {\n                    this.showColectionBuilder(checked_items.dataset_ids);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n        this.prepareCollectionTypeSelect();\n        this.prepareHistoryTypeSelect();\n    },\n\n    prepareCollectionTypeSelect: function() {\n        this.collectionType = \"list\";\n        this.select_collection_type = new mod_select.View({\n            css: \"library-collection-type-select\",\n            container: this.modal.$el.find(\".library-collection-type-select\"),\n            data: [\n                { id: \"list\", text: \"List\" },\n                { id: \"paired\", text: \"Paired\" },\n                { id: \"list:paired\", text: \"List of Pairs\" },\n                { id: \"rules\", text: \"From Rules\" }\n            ],\n            value: \"list\",\n            onchange: collectionType => {\n                this.updateCollectionType(collectionType);\n            }\n        });\n    },\n\n    prepareHistoryTypeSelect: function() {\n        var promise = this.fetchUserHistories();\n        promise.done(() => {\n            var history_options = [];\n            for (let i = this.histories.length - 1; i >= 0; i--) {\n                history_options.unshift({\n                    id: this.histories.models[i].id,\n                    text: this.histories.models[i].get(\"name\")\n                });\n            }\n            this.select_collection_history = new mod_select.View({\n                css: \"library-collection-history-select\",\n                container: this.modal.$el.find(\".library-collection-history-select\"),\n                data: history_options,\n                value: history_options[0].id\n            });\n        });\n    },\n\n    /** Update collection type */\n    updateCollectionType: function(collectionType) {\n        this.collectionType = collectionType;\n    },\n\n    showColectionBuilder: function(checked_items) {\n        let collection_elements = [];\n        let elements_source = this.modal.$('input[type=\"radio\"]:checked').val();\n        if (elements_source === \"selection\") {\n            for (let i = checked_items.length - 1; i >= 0; i--) {\n                let collection_item = {};\n                let dataset = Galaxy.libraries.folderListView.folder_container.get(\"folder\").get(checked_items[i]);\n                collection_item.id = checked_items[i];\n                collection_item.name = dataset.get(\"name\");\n                collection_item.deleted = dataset.get(\"deleted\");\n                collection_item.state = dataset.get(\"state\");\n                collection_elements.push(collection_item);\n            }\n        } else if (elements_source === \"folder\") {\n            collection_elements = new Backbone.Collection(\n                Galaxy.libraries.folderListView.folder_container.get(\"folder\").where({ type: \"file\" })\n            ).toJSON();\n        }\n        let new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        if (new_history_name !== \"\") {\n            this.createNewHistory(new_history_name)\n                .done(new_history => {\n                    mod_toastr.success(\"History created\");\n                    this.collectionImport(collection_elements, new_history.id, new_history.name);\n                })\n                .fail((xhr, status, error) => {\n                    mod_toastr.error(\"An error occurred.\");\n                });\n        } else {\n            let selected_history_id = this.select_collection_history.value();\n            let selected_history_name = this.select_collection_history.text();\n            this.collectionImport(collection_elements, selected_history_id, selected_history_name);\n        }\n    },\n\n    collectionImport: function(collection_elements, history_id, history_name) {\n        let modal_title = `Creating Collection in ${history_name}`;\n        let creator_class;\n        let creationFn;\n        if (this.collectionType === \"list\") {\n            creator_class = LIST_CREATOR.ListCollectionCreator;\n            creationFn = (elements, name, hideSourceItems) => {\n                elements = elements.map(element => ({\n                    id: element.id,\n                    name: element.name,\n                    src: \"ldda\"\n                }));\n                return this.createHDCA(elements, this.collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.collectionCreatorModal(\n                collection_elements,\n                { creationFn: creationFn, title: modal_title, defaultHideSourceItems: true },\n                creator_class\n            );\n        } else if (this.collectionType === \"paired\") {\n            creator_class = PAIR_CREATOR.PairCollectionCreator;\n            creationFn = (elements, name, hideSourceItems) => {\n                elements = [\n                    { name: \"forward\", src: \"ldda\", id: elements[0].id },\n                    { name: \"reverse\", src: \"ldda\", id: elements[1].id }\n                ];\n                return this.createHDCA(elements, this.collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.collectionCreatorModal(\n                collection_elements,\n                { creationFn: creationFn, title: modal_title, defaultHideSourceItems: true },\n                creator_class\n            );\n        } else if (this.collectionType === \"list:paired\") {\n            let elements = collection_elements.map(element => ({\n                id: element.id,\n                name: element.name,\n                src: \"ldda\"\n            }));\n            PAIRED_CREATOR.pairedCollectionCreatorModal(elements, {\n                historyId: history_id,\n                title: modal_title,\n                defaultHideSourceItems: true\n            });\n        } else if (this.collectionType === \"rules\") {\n            const creationFn = (elements, collectionType, name, hideSourceItems) => {\n                return this.createHDCA(elements, collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.ruleBasedCollectionCreatorModal(collection_elements, \"library_datasets\", \"collections\", {\n                creationFn: creationFn,\n                defaultHideSourceItems: true\n            });\n        }\n    },\n\n    createHDCA: function(elementIdentifiers, collectionType, name, hideSourceItems, history_id, options) {\n        let hdca = new HDCA_MODEL.HistoryDatasetCollection({\n            history_content_type: \"dataset_collection\",\n            collection_type: collectionType,\n            history_id: history_id,\n            name: name,\n            hide_source_items: hideSourceItems || false,\n            element_identifiers: elementIdentifiers\n        });\n        return hdca.save(options);\n    },\n\n    templateToolBar: function() {\n        return _.template(\n            [\n                '<div class=\"library_style_container\">', // container start\n                '<div class=\"d-flex align-items-center mb-2\">',\n                '<span class=\"mr-1\">DATA LIBRARIES</span>',\n                \"<div>\", // toolbar start\n                '<form class=\"form-inline\">',\n                '<div class=\"form-check logged-dataset-manipulation mr-1\" style=\"display:none;\">', // include deleted checkbox\n                '<input class=\"form-check-input include-deleted-datasets-chk\" id=\"include_deleted_datasets_chk\" type=\"checkbox\">',\n                '<label class=\"form-check-label\" for=\"include_deleted_datasets_chk\">include deleted</label>',\n                \"</div>\",\n                '<button style=\"display:none;\" title=\"Create new folder\" class=\"btn btn-secondary toolbtn-create-folder add-library-items add-library-items-folder mr-1\" type=\"button\">',\n                '<span class=\"fa fa-plus\"></span> <span class=\"fa fa-folder\"></span> Create Folder ',\n                \"</button>\",\n                \"<% if(multiple_add_dataset_options) { %>\", // add datasets button\n                '<div data-toggle=\"tooltip\" data-placement=\"right\" title=\"Add datasets to current folder\" class=\"dropdown add-library-items add-library-items-datasets mr-1\" style=\"display:none;\">',\n                '<button type=\"button\" class=\"btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">',\n                '<span class=\"fa fa-plus\"></span> <span class=\"fa fa-file\"></span> Add Datasets <span class=\"caret\"></span>',\n                \"</button>\",\n                '<div class=\"dropdown-menu\">',\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/history\"> from History</a>',\n                \"<% if(Galaxy.config.user_library_import_dir !== null) { %>\",\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/userdir\"> from User Directory</a>',\n                \"<% } %>\",\n                \"<% if(Galaxy.config.library_import_dir !== null || Galaxy.config.allow_library_path_paste) { %>\",\n                '<h5 class=\"dropdown-header\">Admins only</h5>',\n                \"<% if(Galaxy.config.library_import_dir !== null) { %>\",\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/importdir\">from Import Directory</a>',\n                \"<% } %>\",\n                \"<% if(Galaxy.config.allow_library_path_paste) { %>\",\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/path\">from Path</a>',\n                \"<% } %>\",\n                \"<% } %>\",\n                \"</div>\",\n                \"</div>\",\n\n                \"<% } else { %>\",\n                '<a data-placement=\"top\" title=\"Add Datasets to Current Folder\" style=\"display:none;\" class=\"btn btn-secondary add-library-items add-library-items-datasets\" href=\"#folders/<%= id %>/import/history\" role=\"button\">',\n                '<span class=\"fa fa-plus\"></span><span class=\"fa fa-file\"></span>',\n                \"</a>\",\n                \"<% } %>\",\n                // import to history button\n                '<div data-toggle=\"tooltip\" data-placement=\"right\" title=\"Import to history\" class=\"dropdown mr-1\">',\n                '<button type=\"button\" class=\"primary-button dropdown-toggle add-to-history\" data-toggle=\"dropdown\">',\n                '<span class=\"fa fa-book\"></span> To History <span class=\"caret\"></span>',\n                \"</button>\",\n                '<div class=\"dropdown-menu\" role=\"menu\">',\n                '<a href=\"\" class=\"toolbtn-bulk-import add-to-history-datasets dropdown-item\">as Datasets</a>',\n                '<a href=\"\" class=\"toolbtn-collection-import add-to-history-collection dropdown-item\">as a Collection</a>',\n                \"</div>\",\n                \"</div>\",\n                // download button\n                '<div data-toggle=\"tooltip\" data-placement=\"right\" title=\"Download items as archive\" class=\"dropdown dataset-manipulation mr-1\" style=\"display:none; \">',\n                '<button type=\"button\" class=\"primary-button dropdown-toggle\" data-toggle=\"dropdown\">',\n                '<span class=\"fa fa-save\"></span> Download <span class=\"caret\"></span>',\n                \"</button>\",\n                '<div class=\"dropdown-menu\" role=\"menu\">',\n                '<a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/tgz\">.tar.gz</a>',\n                '<a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/tbz\">.tar.bz</a>',\n                '<a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/zip\">.zip</a>',\n                \"</div>\",\n                \"</div>\",\n                // delete button\n                '<button data-toggle=\"tooltip\" data-placement=\"right\" title=\"Mark items deleted\" class=\"primary-button toolbtn-bulk-delete logged-dataset-manipulation mr-1\" style=\"display:none;\" type=\"button\">',\n                '<span class=\"fa fa-trash\"></span> Delete',\n                \"</button>\",\n                '<span class=\"mr-1\" data-toggle=\"tooltip\" data-placement=\"right\" title=\"Show location details\">', // location button\n                '<button data-id=\"<%- id %>\" class=\"primary-button toolbtn-show-locinfo\" type=\"button\">',\n                '<span class=\"fa fa-info-circle\"></span>',\n                \"&nbsp;Details\",\n                \"</button>\",\n                \"</span>\",\n                '<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"See this screen annotated\">', // help button\n                '<a class=\"library-help-button\" href=\"https://galaxyproject.org/data-libraries/screen/folder-contents/\" target=\"_blank\">',\n                '<button class=\"primary-button\" type=\"button\">',\n                '<span class=\"fa fa-question-circle\"></span>',\n                \"&nbsp;Help\",\n                \"</button>\",\n                \"</a>\",\n                \"</span>\",\n                \"</form>\",\n                \"</div>\", // toolbar end\n                \"</div>\", // end flex\n                '<div id=\"folder_items_element\" />', // folder contents will append here\n                '<div class=\"d-flex justify-content-center align-items-center folder-paginator mt-2 mb-2\" />', // paginator will append here\n                \"</div>\" // container end\n            ].join(\"\")\n        );\n    },\n\n    templateLocInfoInModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th style=\"width: 25%;\">library</th>',\n                \"<th></th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                \"<tr>\",\n                \"<td>name</td>\",\n                '<td><%- library.get(\"name\") %></td>',\n                \"</tr>\",\n                '<% if(library.get(\"description\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>description</td>\",\n                '<td><%- library.get(\"description\") %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if(library.get(\"synopsis\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>synopsis</td>\",\n                '<td><%- library.get(\"synopsis\") %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if(library.get(\"create_time_pretty\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>created</td>\",\n                '<td><span title=\"<%- library.get(\"create_time\") %>\"><%- library.get(\"create_time_pretty\") %></span></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"<tr>\",\n                \"<td>id</td>\",\n                '<td><%- library.get(\"id\") %></td>',\n                \"</tr>\",\n                \"</tbody>\",\n                \"</table>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th style=\"width: 25%;\">folder</th>',\n                \"<th></th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                \"<tr>\",\n                \"<td>name</td>\",\n                \"<td><%- options.folder_name %></td>\",\n                \"</tr>\",\n                '<% if(options.folder_description !== \"\") { %>',\n                \"<tr>\",\n                \"<td>description</td>\",\n                \"<td><%- options.folder_description %></td>\",\n                \"</tr>\",\n                \"<% } %>\",\n                \"<tr>\",\n                \"<td>id</td>\",\n                \"<td><%- options.id %></td>\",\n                \"</tr>\",\n                \"</tbody>\",\n                \"</table>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateNewFolderInModal: function() {\n        return _.template(\n            [\n                '<div id=\"new_folder_modal\">',\n                \"<form>\",\n                '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                \"</form>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportIntoHistoryModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<div class=\"library-modal-item\">',\n                \"Select history: \",\n                '<select name=\"import_to_history\" style=\"width:50%; margin-bottom: 1em; \" autofocus>',\n                \"<% _.each(histories, function(history) { %>\",\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                '<div class=\"library-modal-item\">',\n                \"or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" style=\"width:50%;\" />',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportIntoHistoryProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"Importing selected items to history <b><%= _.escape(history_name) %></b>\",\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateAddingDatasetsProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>\",\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateDeletingItemsProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateBrowserModal: function() {\n        return _.template(\n            [\n                '<div id=\"file_browser_modal\">',\n                '<div style=\"margin-bottom:1em;\">',\n                '<label title=\"Switch to selecting files\" class=\"radio-inline import-type-switch\">',\n                '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-folders\" checked=\"checked\"> Choose Files',\n                \"</label>\",\n                '<label title=\"Switch to selecting folders\" class=\"radio-inline import-type-switch\">',\n                '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-files\"> Choose Folders',\n                \"</label>\",\n                \"</div>\",\n                '<div class=\"alert alert-info jstree-files-message\">All files you select will be imported into the current folder ignoring their folder structure.</div>',\n                '<div class=\"alert alert-info jstree-folders-message\" style=\"display:none;\">All files within the selected folders and their subfolders will be imported into the current folder.</div>',\n                '<div style=\"margin-bottom:1em;\">',\n                '<label class=\"checkbox-inline jstree-preserve-structure\" style=\"display:none;\">',\n                '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n                \"Preserve directory structure\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n                \"Link files instead of copying\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"posix-checkbox\" type=\"checkbox\" value=\"to_posix_lines\" checked=\"checked\">',\n                \"Convert line endings to POSIX\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"spacetab-checkbox\" type=\"checkbox\" value=\"space_to_tab\">',\n                \"Convert spaces to tabs\",\n                \"</label>\",\n                \"</div>\",\n                '<button title=\"Select all files\" type=\"button\" class=\"button primary-button libimport-select-all\">',\n                \"Select all\",\n                \"</button>\",\n                '<button title=\"Select no files\" type=\"button\" class=\"button primary-button libimport-select-none\">',\n                \"Unselect all\",\n                \"</button>\",\n                \"<hr />\",\n                // append jstree object here\n                '<div id=\"jstree_browser\">',\n                \"</div>\",\n                \"<hr />\",\n                \"<p>You can set extension type and genome for all imported datasets at once:</p>\",\n                \"<div>\",\n                'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n                'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n                \"</div>\",\n                \"<br>\",\n                \"<div>\",\n                '<label class=\"checkbox-inline tag-files\">',\n                \"Tag datasets based on file names\",\n                '<input class=\"tag-files\" type=\"checkbox\" value=\"tag_using_filenames\">',\n                \"</label>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportPathModal: function() {\n        return _.template(\n            [\n                '<div id=\"file_browser_modal\">',\n                '<div class=\"alert alert-info jstree-folders-message\">All files within the given folders and their subfolders will be imported into the current folder.</div>',\n                '<div style=\"margin-bottom: 0.5em;\">',\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n                \"Preserve directory structure\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n                \"Link files instead of copying\",\n                \"</label>\",\n                \"<br>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"posix-checkbox\" type=\"checkbox\" value=\"to_posix_lines\" checked=\"checked\">',\n                \"Convert line endings to POSIX\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"spacetab-checkbox\" type=\"checkbox\" value=\"space_to_tab\">',\n                \"Convert spaces to tabs\",\n                \"</label>\",\n                \"</div>\",\n                '<textarea id=\"import_paths\" class=\"form-control\" rows=\"5\" placeholder=\"Absolute paths (or paths relative to Galaxy root) separated by newline\" autofocus></textarea>',\n                \"<hr />\",\n                \"<p>You can set extension type and genome for all imported datasets at once:</p>\",\n                \"<div>\",\n                'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n                'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n                \"</div>\",\n                \"<div>\",\n                '<label class=\"checkbox-inline tag-files\">',\n                \"Tag datasets based on file names\",\n                '<input class=\"tag-files\" type=\"checkbox\" value=\"tag_using_filenames\">',\n                \"</label>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateAddFilesFromHistory: function() {\n        return _.template(\n            [\n                '<div id=\"add_files_modal\">',\n                \"<div>\",\n                \"1.&nbsp;Select history:&nbsp;\",\n                '<select id=\"dataset_add_bulk\" name=\"dataset_add_bulk\" style=\"width:66%; \"> ',\n                \"<% _.each(histories, function(history) { %>\", //history select box\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                \"<br/>\",\n                '<div class=\"library_selected_history_content\">',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateHistoryContents: function() {\n        return _.template(\n            [\n                \"<p>2.&nbsp;Choose the datasets to import:</p>\",\n                \"<div>\",\n                '<button title=\"Select all datasets\" type=\"button\" class=\"button primary-button history-import-select-all\">',\n                \"Select all\",\n                \"</button>\",\n                '<button title=\"Select all datasets\" type=\"button\" class=\"button primary-button history-import-unselect-all\">',\n                \"Unselect all\",\n                \"</button>\",\n                \"</div>\",\n                \"<br>\",\n                \"<ul>\",\n                \"<% _.each(history_contents, function(history_item) { %>\",\n                '<% if (history_item.get(\"deleted\") != true ) { %>',\n                '<% var item_name = history_item.get(\"name\") %>',\n                '<% if (history_item.get(\"type\") === \"collection\") { %>',\n                '<% var collection_type = history_item.get(\"collection_type\") %>',\n                '<% if (collection_type === \"list\") { %>',\n                '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                \"<label>\",\n                '<label title=\"<%= _.escape(item_name) %>\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection)',\n                \"</label>\",\n                \"</li>\",\n                \"<% } else { %>\",\n                '<li><input style=\"margin: 0;\" type=\"checkbox\" onclick=\"return false;\" disabled=\"disabled\">',\n                '<span title=\"You can convert this collection into a collection of type list using the Collection Tools\">',\n                '<%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',\n                \"</span>\",\n                \"</li>\",\n                \"<% } %>\",\n                '<% } else if (history_item.get(\"visible\") === true && history_item.get(\"state\") === \"ok\") { %>',\n                '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                '<label title=\"<%= _.escape(item_name) %>\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %>',\n                \"</label>\",\n                \"</li>\",\n                \"<% } %>\",\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ul>\"\n            ].join(\"\")\n        );\n    },\n\n    templatePaginator: function() {\n        return _.template(\n            [\n                '<ul class=\"pagination mr-1\">',\n                \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                \"<% } else { %>\", // we are on the first page\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                '<li class=\"page-item active\">',\n                '<a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                \"</li>\",\n                \"<% if ( ( show_page ) < page_count ) { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } %>\",\n                \"</ul>\",\n                '<span class=\"mr-1\">',\n                ' <%- items_shown %> items shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- folder_page_size %> per page\" class=\"page-size-prompt\">(change)</a>',\n                \"</span>\",\n                '<span class=\"mr-1\">',\n                \" <%- total_items_count %> total\",\n                \"</span>\"\n            ].join(\"\")\n        );\n    },\n\n    templateCollectionSelectModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                // elements selection\n                '<div class=\"library-modal-item\">',\n                \"<h4>Which datasets?</h4>\",\n                '<form class=\"form-inline\">',\n                '<label class=\"radio-inline\">',\n                '<input type=\"radio\" name=\"radio_elements\" id=\"selection_radio\" value=\"selection\" <% if (!selected_datasets) { %> disabled <% } else { %> checked <% } %> > current selection',\n                \"<% if (selected_datasets) { %>\",\n                \" (<%- selected_datasets %>)\",\n                \"<% } %>\",\n                \"</label>\",\n                '<label class=\"radio-inline\">',\n                '<input type=\"radio\" name=\"radio_elements\" id=\"folder_radio\" value=\"folder\" <% if (!selected_datasets) { %> checked <% } %> > all datasets in current folder',\n                \"</label>\",\n                \"</form>\",\n                \"</div>\",\n                // type selection\n                '<div class=\"library-modal-item\">',\n                \"<h4>Collection type</h4>\",\n                '<span class=\"library-collection-type-select\"/>',\n                \"<h5>Which type to choose?</h5>\",\n                \"<ul>\",\n                \"<li>\",\n                \"List: Generic collection which groups any number of datasets into a set; similar to file system folder.\",\n                \"</li>\",\n                \"<li>\",\n                \"Paired: Simple collection containing exactly two sequence datasets; one reverse and the other forward.\",\n                \"</li>\",\n                \"<li>\",\n                \"List of Pairs: Advanced collection containing any number of Pairs; imagine as Pair-type collections inside of a List-type collection.\",\n                \"</li>\",\n                \"<li>\",\n                \"From Rules: Use Galaxy's rule builder to describe collections. This is more of an advanced feature that allows building any number of collections or any type.\",\n                \"</li>\",\n                \"</ul>\",\n                \"</div>\",\n                // history selection/creation\n                '<div class=\"library-modal-item\">',\n                \"<h4>Select history</h4>\",\n                '<span class=\"library-collection-history-select\"/>',\n                \" or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" />',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    FolderToolbarView: FolderToolbarView\n};\n"]}