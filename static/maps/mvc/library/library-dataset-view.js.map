{"version":3,"sources":["mvc/library/library-dataset-view.js"],"names":["LibraryDatasetView","Backbone","View","extend","el","model","options","defaults","edit_mode","events","select_genome","select_extension","list_extensions","auto","id","text","description","list_genomes","initialize","_","fetchExtAndGenomes","fetchDataset","Item","self","fetch","success","show_permissions","showPermissions","show_version","fetchVersion","render","error","response","responseJSON","err_msg","onclick","Galaxy","libraries","library_router","back","$","remove","template","templateDataset","$el","html","item","get","tooltip","trigger","ldda_id","ldda","Ldda","url","urlRoot","renderVersion","templateVersion","enableModification","templateModifyDataset","renderSelectBoxes","genome_build","file_ext","downloadDataset","root","data","ld_ids","processDownload","method","param","inputs","each","split","pair","appendTo","submit","info","importIntoHistory","refreshUserHistoriesList","templateBulkImportInModal","modal","show","closing_events","title","body","histories","models","buttons","Import","importCurrentIntoHistory","Close","hide","callback","GalaxyHistories","length","warning","window","location","disableButton","new_history_name","val","post","name","done","processImportToHistory","new_history","fail","xhr","status","always","enableButton","history_id","find","historyItem","HistoryItem","jQuery","getJSON","save","content","source","templateDatasetPermissions","fetched_permissions","undefined","access_dataset_roles","set","is_unrestricted","is_admin","config","is_admin_user","prepareSelectBoxes","css","_serializeRoles","role_list","selected_roles","i","push","replace","accessSelectObject","_generate_select_options","selector","initialData","modifySelectObject","modify_item_roles","manageSelectObject","manage_dataset_roles","select_options","minimumInputLength","multiple","placeholder","formatResult","roleFormatResult","role","type","formatSelection","roleFormatSelection","initSelection","element","dropdownCssClass","container","join","ajax","dataType","quietMillis","term","page","q","page_limit","results","more","total","roles","saveModifications","is_changed","ld","new_name","new_info","new_message","new_genome_build","select2","new_ext","dataset_view","patch","copyToClipboard","e","preventDefault","href","history","lastIndexOf","substr","prompt","makeDatasetPrivate","removeDatasetRestrictions","_extractIds","roles_list","ids_list","savePermissions","event","access_ids","manage_ids","modify_ids","datatypes","key","extension","description_url","sort","a","b","unshift","genomes","current_genome","current_ext","value"],"mappings":"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","file":"../../../scripts/mvc/library/library-dataset-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport mod_toastr from \"libs/toastr\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_utils from \"utils/utils\";\nimport mod_select from \"mvc/ui/ui-select\";\nvar LibraryDatasetView = Backbone.View.extend({\n    el: \"#center\",\n\n    model: null,\n\n    options: {},\n\n    defaults: {\n        edit_mode: false\n    },\n\n    events: {\n        \"click .toolbtn_modify_dataset\": \"enableModification\",\n        \"click .toolbtn_cancel_modifications\": \"render\",\n        \"click .toolbtn-download-dataset\": \"downloadDataset\",\n        \"click .toolbtn-import-dataset\": \"importIntoHistory\",\n        \"click .copy-link-to-clipboard\": \"copyToClipboard\",\n        \"click .make-private\": \"makeDatasetPrivate\",\n        \"click .remove-restrictions\": \"removeDatasetRestrictions\",\n        \"click .toolbtn_save_permissions\": \"savePermissions\",\n        \"click .toolbtn_save_modifications\": \"saveModifications\"\n    },\n\n    // genome select\n    select_genome: null,\n\n    // extension select\n    select_extension: null,\n\n    // extension types\n    list_extensions: [],\n\n    // datatype placeholder for extension auto-detection\n    auto: {\n        id: \"auto\",\n        text: \"Auto-detect\",\n        description:\n            \"This system will try to detect the file type automatically.\" +\n            \" If your file is not detected properly as one of the known formats,\" +\n            \" it most likely means that it has some format problems (e.g., different\" +\n            \" number of columns on different rows). You can still coerce the system\" +\n            \" to set your data to the format you think it should be.\" +\n            \" You can also upload compressed files, which will automatically be decompressed.\"\n    },\n\n    // genomes\n    list_genomes: [],\n\n    initialize: function(options) {\n        this.options = _.extend(this.options, options);\n        this.fetchExtAndGenomes();\n        if (this.options.id) {\n            this.fetchDataset();\n        }\n    },\n\n    fetchDataset: function(options) {\n        this.options = _.extend(this.options, options);\n        this.model = new mod_library_model.Item({\n            id: this.options.id\n        });\n        var self = this;\n        this.model.fetch({\n            success: function() {\n                if (self.options.show_permissions) {\n                    self.showPermissions();\n                } else if (self.options.show_version) {\n                    self.fetchVersion();\n                } else {\n                    self.render();\n                }\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(`${response.responseJSON.err_msg} Click this to go back.`, \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                } else {\n                    mod_toastr.error(\"An error occurred. Click this to go back.\", \"\", {\n                        onclick: function() {\n                            Galaxy.libraries.library_router.back();\n                        }\n                    });\n                }\n            }\n        });\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        $(\".tooltip\").remove();\n        var template = this.templateDataset();\n        this.$el.html(template({ item: this.model }));\n        $(\".peek\").html(this.model.get(\"peek\"));\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    fetchVersion: function(options) {\n        this.options = _.extend(this.options, options);\n        var self = this;\n        if (!this.options.ldda_id) {\n            this.render();\n            mod_toastr.error(\"Library dataset version requested but no id provided.\");\n        } else {\n            this.ldda = new mod_library_model.Ldda({\n                id: this.options.ldda_id\n            });\n            this.ldda.url = `${this.ldda.urlRoot + this.model.id}/versions/${this.ldda.id}`;\n            this.ldda.fetch({\n                success: function() {\n                    self.renderVersion();\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occurred.\");\n                    }\n                }\n            });\n        }\n    },\n\n    renderVersion: function() {\n        $(\".tooltip\").remove();\n        var template = this.templateVersion();\n        this.$el.html(template({ item: this.model, ldda: this.ldda }));\n        $(\".peek\").html(this.ldda.get(\"peek\"));\n    },\n\n    enableModification: function() {\n        $(\".tooltip\").remove();\n        var template = this.templateModifyDataset();\n        this.$el.html(template({ item: this.model }));\n        this.renderSelectBoxes({\n            genome_build: this.model.get(\"genome_build\"),\n            file_ext: this.model.get(\"file_ext\")\n        });\n        $(\".peek\").html(this.model.get(\"peek\"));\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    downloadDataset: function() {\n        var url = `${Galaxy.root}api/libraries/datasets/download/uncompressed`;\n        var data = { ld_ids: this.id };\n        this.processDownload(url, data);\n    },\n\n    processDownload: function(url, data, method) {\n        //url and data options required\n        if (url && data) {\n            //data can be string of parameters or array/object\n            data = typeof data == \"string\" ? data : $.param(data);\n            //split params into form inputs\n            var inputs = \"\";\n            $.each(data.split(\"&\"), function() {\n                var pair = this.split(\"=\");\n                inputs += `<input type=\"hidden\" name=\"${pair[0]}\" value=\"${pair[1]}\" />`;\n            });\n            //send request\n            $(`<form action=\"${url}\" method=\"${method || \"post\"}\">${inputs}</form>`)\n                .appendTo(\"body\")\n                .submit()\n                .remove();\n\n            mod_toastr.info(\"Your download will begin soon.\");\n        }\n    },\n\n    importIntoHistory: function() {\n        this.refreshUserHistoriesList(self => {\n            var template = self.templateBulkImportInModal();\n            self.modal = Galaxy.modal;\n            self.modal.show({\n                closing_events: true,\n                title: _l(\"Import into History\"),\n                body: template({ histories: self.histories.models }),\n                buttons: {\n                    Import: function() {\n                        self.importCurrentIntoHistory();\n                    },\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    },\n\n    refreshUserHistoriesList: function(callback) {\n        var self = this;\n        this.histories = new mod_library_model.GalaxyHistories();\n        this.histories.fetch({\n            success: function(histories) {\n                if (histories.length === 0) {\n                    mod_toastr.warning(\"You have to create history first. Click this to do so.\", \"\", {\n                        onclick: function() {\n                            window.location = Galaxy.root;\n                        }\n                    });\n                } else {\n                    callback(self);\n                }\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    importCurrentIntoHistory: function() {\n        this.modal.disableButton(\"Import\");\n        var new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        var self = this;\n        if (new_history_name !== \"\") {\n            $.post(`${Galaxy.root}api/histories`, {\n                name: new_history_name\n            })\n                .done(new_history => {\n                    self.processImportToHistory(new_history.id);\n                })\n                .fail((xhr, status, error) => {\n                    mod_toastr.error(\"An error occurred.\");\n                })\n                .always(() => {\n                    self.modal.enableButton(\"Import\");\n                });\n        } else {\n            var history_id = $(this.modal.$el)\n                .find(\"select[name=dataset_import_single] option:selected\")\n                .val();\n            this.processImportToHistory(history_id);\n            this.modal.enableButton(\"Import\");\n        }\n    },\n\n    processImportToHistory: function(history_id) {\n        var historyItem = new mod_library_model.HistoryItem();\n        historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n        // set the used history as current so user will see the last one\n        // that he imported into in the history panel on the 'analysis' page\n        jQuery.getJSON(`${Galaxy.root}history/set_as_current?id=${history_id}`);\n        // save the dataset into selected history\n        historyItem.save(\n            { content: this.id, source: \"library\" },\n            {\n                success: function() {\n                    Galaxy.modal.hide();\n                    mod_toastr.success(\"Dataset imported. Click this to start analyzing it.\", \"\", {\n                        onclick: function() {\n                            window.location = Galaxy.root;\n                        }\n                    });\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(`Dataset not imported. ${response.responseJSON.err_msg}`);\n                    } else {\n                        mod_toastr.error(\"An error occured. Dataset not imported. Please try again.\");\n                    }\n                }\n            }\n        );\n    },\n\n    showPermissions: function(options) {\n        var template = this.templateDatasetPermissions();\n        var self = this;\n        this.options = _.extend(this.options, options);\n        $(\".tooltip\").remove();\n        if (this.options.fetched_permissions !== undefined) {\n            if (this.options.fetched_permissions.access_dataset_roles.length === 0) {\n                this.model.set({ is_unrestricted: true });\n            } else {\n                this.model.set({ is_unrestricted: false });\n            }\n        }\n        this.$el.html(\n            template({\n                item: this.model,\n                is_admin: Galaxy.config.is_admin_user\n            })\n        );\n        $.get(`${Galaxy.root}api/libraries/datasets/${self.id}/permissions?scope=current`)\n            .done(fetched_permissions => {\n                self.prepareSelectBoxes({\n                    fetched_permissions: fetched_permissions,\n                    is_admin: Galaxy.config.is_admin_user\n                });\n            })\n            .fail(() => {\n                mod_toastr.error(\"An error occurred while attempting to fetch dataset permissions.\");\n            });\n        $('#center [data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n        $(\"#center\").css(\"overflow\", \"auto\");\n    },\n\n    _serializeRoles: function(role_list) {\n        var selected_roles = [];\n        for (var i = 0; i < role_list.length; i++) {\n            // Replace the : and , in role's name since these are select2 separators for initialData\n            selected_roles.push(`${role_list[i][1]}:${role_list[i][0].replace(\":\", \" \").replace(\",\", \" &\")}`);\n        }\n        return selected_roles;\n    },\n\n    prepareSelectBoxes: function(options) {\n        this.options = _.extend(this.options, options);\n        this.accessSelectObject = new mod_select.View(\n            this._generate_select_options({\n                selector: \"access_perm\",\n                initialData: this._serializeRoles(this.options.fetched_permissions.access_dataset_roles)\n            })\n        );\n        this.modifySelectObject = new mod_select.View(\n            this._generate_select_options({\n                selector: \"modify_perm\",\n                initialData: this._serializeRoles(this.options.fetched_permissions.modify_item_roles)\n            })\n        );\n        this.manageSelectObject = new mod_select.View(\n            this._generate_select_options({\n                selector: \"manage_perm\",\n                initialData: this._serializeRoles(this.options.fetched_permissions.manage_dataset_roles)\n            })\n        );\n    },\n\n    _generate_select_options: function(options) {\n        var select_options = {\n            minimumInputLength: 0,\n            multiple: true,\n            placeholder: \"Click to select a role\",\n            formatResult: function roleFormatResult(role) {\n                return `${role.name} type: ${role.type}`;\n            },\n            formatSelection: function roleFormatSelection(role) {\n                return role.name;\n            },\n            initSelection: function(element, callback) {\n                // the input tag has a value attribute preloaded that points to a preselected role's id\n                // this function resolves that id attribute to an object that select2 can render\n                // using its formatResult renderer - that way the role name is shown preselected\n                var data = [];\n                $(element.val().split(\",\")).each(function() {\n                    var item = this.split(\":\");\n                    data.push({\n                        id: item[0],\n                        name: item[1]\n                    });\n                });\n                callback(data);\n            },\n            dropdownCssClass: \"bigdrop\" // apply css that makes the dropdown taller\n        };\n        select_options.container = this.$el.find(`#${options.selector}`);\n        select_options.css = options.selector;\n        select_options.initialData = options.initialData.join(\",\");\n        select_options.ajax = {\n            url: `${Galaxy.root}api/libraries/datasets/${this.id}/permissions?scope=available`,\n            dataType: \"json\",\n            quietMillis: 100,\n            data: function(term, page) {\n                // page is the one-based page number tracked by Select2\n                return {\n                    q: term, //search term\n                    page_limit: 10, // page size, should be same as used in 'more' variable below\n                    page: page // page number\n                };\n            },\n            results: function(data, page) {\n                var more = page * 10 < data.total; // whether or not there are more results available\n                // notice we return the value of more so Select2 knows if more results can be loaded\n                return { results: data.roles, more: more };\n            }\n        };\n        return select_options;\n    },\n\n    /**\n     * Save the changes made to the library dataset.\n     */\n    saveModifications: function(options) {\n        var is_changed = false;\n        var ld = this.model;\n        var new_name = this.$el.find(\".input_dataset_name\").val();\n        if (typeof new_name !== \"undefined\" && new_name !== ld.get(\"name\")) {\n            if (new_name.length > 0) {\n                ld.set(\"name\", new_name);\n                is_changed = true;\n            } else {\n                mod_toastr.warning(\"Library dataset name has to be at least 1 character long.\");\n                return;\n            }\n        }\n        var new_info = this.$el.find(\".input_dataset_misc_info\").val();\n        if (typeof new_info !== \"undefined\" && new_info !== ld.get(\"misc_info\")) {\n            ld.set(\"misc_info\", new_info);\n            is_changed = true;\n        }\n        var new_message = this.$el.find(\".input_dataset_message\").val();\n        if (typeof new_message !== \"undefined\" && new_message !== ld.get(\"message\")) {\n            ld.set(\"message\", new_message);\n            is_changed = true;\n        }\n        var new_genome_build = this.select_genome.$el.select2(\"data\").id;\n        if (typeof new_genome_build !== \"undefined\" && new_genome_build !== ld.get(\"genome_build\")) {\n            ld.set(\"genome_build\", new_genome_build);\n            is_changed = true;\n        }\n        var new_ext = this.select_extension.$el.select2(\"data\").id;\n        if (typeof new_ext !== \"undefined\" && new_ext !== ld.get(\"file_ext\")) {\n            ld.set(\"file_ext\", new_ext);\n            is_changed = true;\n        }\n        var dataset_view = this;\n        if (is_changed) {\n            ld.save(null, {\n                patch: true,\n                success: function(ld) {\n                    dataset_view.render();\n                    mod_toastr.success(\"Changes to library dataset saved.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occured while attempting to update the library dataset.\");\n                    }\n                }\n            });\n        } else {\n            dataset_view.render();\n            mod_toastr.info(\"Nothing has changed.\");\n        }\n    },\n\n    copyToClipboard: function(e) {\n        e.preventDefault();\n        var href = Backbone.history.location.href;\n        if (href.lastIndexOf(\"/permissions\") !== -1) {\n            href = href.substr(0, href.lastIndexOf(\"/permissions\"));\n        }\n        window.prompt(\"Copy to clipboard: Ctrl+C, Enter\", href);\n    },\n\n    makeDatasetPrivate: function() {\n        var self = this;\n        $.post(`${Galaxy.root}api/libraries/datasets/${self.id}/permissions?action=make_private`)\n            .done(fetched_permissions => {\n                self.model.set({ is_unrestricted: false });\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                mod_toastr.success(\"The dataset is now private to you.\");\n            })\n            .fail(() => {\n                mod_toastr.error(\"An error occurred while attempting to make dataset private.\");\n            });\n    },\n\n    removeDatasetRestrictions: function() {\n        var self = this;\n        $.post(`${Galaxy.root}api/libraries/datasets/${self.id}/permissions?action=remove_restrictions`)\n            .done(fetched_permissions => {\n                self.model.set({ is_unrestricted: true });\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                mod_toastr.success(\"Access to this dataset is now unrestricted.\");\n            })\n            .fail(() => {\n                mod_toastr.error(\"An error occurred while attempting to make dataset unrestricted.\");\n            });\n    },\n\n    /**\n     * Extract the role ids from Select2 elements's 'data'\n     */\n    _extractIds: function(roles_list) {\n        var ids_list = [];\n        for (var i = roles_list.length - 1; i >= 0; i--) {\n            ids_list.push(roles_list[i].id);\n        }\n        return ids_list;\n    },\n\n    /**\n     * Save the permissions for roles entered in the select boxes.\n     */\n    savePermissions: function(event) {\n        var self = this;\n        var access_ids = this._extractIds(this.accessSelectObject.$el.select2(\"data\"));\n        var manage_ids = this._extractIds(this.manageSelectObject.$el.select2(\"data\"));\n        var modify_ids = this._extractIds(this.modifySelectObject.$el.select2(\"data\"));\n        $.post(`${Galaxy.root}api/libraries/datasets/${self.id}/permissions?action=set_permissions`, {\n            \"access_ids[]\": access_ids,\n            \"manage_ids[]\": manage_ids,\n            \"modify_ids[]\": modify_ids\n        })\n            .done(fetched_permissions => {\n                self.showPermissions({\n                    fetched_permissions: fetched_permissions\n                });\n                mod_toastr.success(\"Permissions saved.\");\n            })\n            .fail(() => {\n                mod_toastr.error(\"An error occurred while attempting to set dataset permissions.\");\n            });\n    },\n\n    /**\n     * If needed request all extensions and/or genomes from Galaxy\n     * and save them in sorted arrays.\n     */\n    fetchExtAndGenomes: function() {\n        var self = this;\n        if (this.list_genomes.length == 0) {\n            mod_utils.get({\n                url: `${Galaxy.root}api/datatypes?extension_only=False`,\n                success: function(datatypes) {\n                    for (var key in datatypes) {\n                        self.list_extensions.push({\n                            id: datatypes[key].extension,\n                            text: datatypes[key].extension,\n                            description: datatypes[key].description,\n                            description_url: datatypes[key].description_url\n                        });\n                    }\n                    self.list_extensions.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n                    self.list_extensions.unshift(self.auto);\n                }\n            });\n        }\n        if (this.list_extensions.length == 0) {\n            mod_utils.get({\n                url: `${Galaxy.root}api/genomes`,\n                success: function(genomes) {\n                    for (var key in genomes) {\n                        self.list_genomes.push({\n                            id: genomes[key][1],\n                            text: genomes[key][0]\n                        });\n                    }\n                    self.list_genomes.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n                }\n            });\n        }\n    },\n\n    renderSelectBoxes: function(options) {\n        // This won't work properly unlesss we already have the data fetched.\n        // See this.fetchExtAndGenomes()\n        // TODO switch to common resources:\n        // https://trello.com/c/dIUE9YPl/1933-ui-common-resources-and-data-into-galaxy-object\n        var self = this;\n        var current_genome = \"?\";\n        var current_ext = \"auto\";\n        if (typeof options !== \"undefined\") {\n            if (typeof options.genome_build !== \"undefined\") {\n                current_genome = options.genome_build;\n            }\n            if (typeof options.file_ext !== \"undefined\") {\n                current_ext = options.file_ext;\n            }\n        }\n        this.select_genome = new mod_select.View({\n            css: \"dataset-genome-select\",\n            data: self.list_genomes,\n            container: self.$el.find(\"#dataset_genome_select\"),\n            value: current_genome\n        });\n        this.select_extension = new mod_select.View({\n            css: \"dataset-extension-select\",\n            data: self.list_extensions,\n            container: self.$el.find(\"#dataset_extension_select\"),\n            value: current_ext\n        });\n    },\n\n    templateDataset: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n                '<div class=\"d-flex mb-2\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Download dataset\" class=\"btn btn-secondary toolbtn-download-dataset toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-download\"></span>',\n                \"&nbsp;Download\",\n                \"</button>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Import dataset into history\" class=\"btn btn-secondary toolbtn-import-dataset toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-book\"></span>',\n                \"&nbsp;to History\",\n                \"</button>\",\n                '<% if (item.get(\"can_user_modify\")) { %>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Modify library item\" class=\"btn btn-secondary toolbtn_modify_dataset toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-pencil\"></span>',\n                \"&nbsp;Modify\",\n                \"</button>\",\n                \"<% } %>\",\n                '<% if (item.get(\"can_user_manage\")) { %>',\n                '<a href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>/permissions\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Manage permissions\" class=\"btn btn-secondary toolbtn_change_permissions toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-group\"></span>',\n                \"&nbsp;Permissions\",\n                \"</button>\",\n                \"</a>\",\n                \"<% } %>\",\n                \"</div>\",\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<% if (item.get(\"is_unrestricted\")) { %>',\n                \"<div>\",\n                'This dataset is unrestricted so everybody with the link can access it. Just share <span class=\"copy-link-to-clipboard\"><a href=\"\"a>this page</a></span>.',\n                \"</div>\",\n                \"<% } %>\",\n\n                // TABLE START\n                '<div class=\"dataset_table\">',\n                '<table class=\"grid table table-striped table-sm\">',\n                \"<tr>\",\n                '<th class=\"dataset-first-column\" scope=\"row\" id=\"id_row\" data-id=\"<%= _.escape(item.get(\"ldda_id\")) %>\">Name</th>',\n                '<td><%= _.escape(item.get(\"name\")) %></td>',\n                \"</tr>\",\n                '<% if (item.get(\"file_ext\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data type</th>',\n                '<td><%= _.escape(item.get(\"file_ext\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"genome_build\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Genome build</th>',\n                '<td><%= _.escape(item.get(\"genome_build\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"file_size\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Size</th>',\n                '<td><%= _.escape(item.get(\"file_size\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"date_uploaded\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Date uploaded (UTC)</th>',\n                '<td><%= _.escape(item.get(\"date_uploaded\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"uploaded_by\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Uploaded by</th>',\n                '<td><%= _.escape(item.get(\"uploaded_by\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_data_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data Lines</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_data_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_comment_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Comment Lines</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_comment_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_columns\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Number of Columns</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_columns\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"metadata_column_types\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Column Types</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_column_types\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"message\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Message</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"message\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"misc_blurb\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Misc. blurb</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"misc_blurb\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"misc_info\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Misc. info</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"misc_info\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"tags\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Tags</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"tags\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if ( item.get(\"uuid\") !== \"ok\" ) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">UUID</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"uuid\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if ( item.get(\"state\") !== \"ok\" ) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">State</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"state\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"</table>\",\n\n                '<% if (item.get(\"job_stderr\")) { %>',\n                \"<h4>Job Standard Error</h4>\",\n                '<pre class=\"code\">',\n                '<%= _.escape(item.get(\"job_stderr\")) %>',\n                \"</pre>\",\n                \"<% } %>\",\n\n                '<% if (item.get(\"job_stdout\")) { %>',\n                \"<h4>Job Standard Output</h4>\",\n                '<pre class=\"code\">',\n                '<%= _.escape(item.get(\"job_stdout\")) %>',\n                \"</pre>\",\n                \"<% } %>\",\n\n                \"<div>\",\n                '<pre class=\"peek\">',\n                \"</pre>\",\n                \"</div>\",\n\n                '<% if (item.get(\"has_versions\")) { %>',\n                \"<div>\",\n                \"<h3>Expired versions:</h3>\",\n                \"<ul>\",\n                '<% _.each(item.get(\"expired_versions\"), function(version) { %>',\n                '<li><a title=\"See details of this version\" href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>/versions/<%- version[0] %>\"><%- version[1] %></a></li>',\n                \"<% }) %>\",\n                \"<ul>\",\n                \"</div>\",\n                \"<% } %>\",\n                // TABLE END\n                \"</div>\",\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateVersion: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n                '<div class=\"d-flex mb-2\">',\n                '<a href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Go to latest dataset\" class=\"btn btn-secondary toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-caret-left fa-lg\"></span>',\n                \"&nbsp;Latest dataset\",\n                \"</button>\",\n                \"<a>\",\n                \"</div>\",\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<div class=\"alert alert-warning\">This is an expired version of the library dataset: <%= _.escape(item.get(\"name\")) %></div>',\n                // DATASET START\n                '<div class=\"dataset_table\">',\n                '<table class=\"grid table table-striped table-sm\">',\n                \"<tr>\",\n                '<th scope=\"row\" id=\"id_row\" data-id=\"<%= _.escape(ldda.id) %>\">Name</th>',\n                '<td><%= _.escape(ldda.get(\"name\")) %></td>',\n                \"</tr>\",\n                '<% if (ldda.get(\"file_ext\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data type</th>',\n                '<td><%= _.escape(ldda.get(\"file_ext\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"genome_build\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Genome build</th>',\n                '<td><%= _.escape(ldda.get(\"genome_build\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"file_size\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Size</th>',\n                '<td><%= _.escape(ldda.get(\"file_size\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"date_uploaded\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Date uploaded (UTC)</th>',\n                '<td><%= _.escape(ldda.get(\"date_uploaded\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"uploaded_by\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Uploaded by</th>',\n                '<td><%= _.escape(ldda.get(\"uploaded_by\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_data_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Data Lines</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_data_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_comment_lines\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Comment Lines</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_comment_lines\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_columns\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Number of Columns</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_columns\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"metadata_column_types\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Column Types</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"metadata_column_types\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"message\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Message</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"message\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"misc_blurb\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Miscellaneous blurb</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"misc_blurb\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (ldda.get(\"misc_info\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Miscellaneous information</th>',\n                '<td scope=\"row\"><%= _.escape(ldda.get(\"misc_info\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if (item.get(\"tags\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Tags</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"tags\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"</table>\",\n                \"<div>\",\n                '<pre class=\"peek\">',\n                \"</pre>\",\n                \"</div>\",\n                // DATASET END\n                \"</div>\",\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateModifyDataset: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<div class=\"dataset_table\">',\n                '<table class=\"grid table table-striped table-sm\">',\n                \"<tr>\",\n                '<th class=\"dataset-first-column\" scope=\"row\" id=\"id_row\" data-id=\"<%= _.escape(item.get(\"ldda_id\")) %>\">Name</th>',\n                '<td><input class=\"input_dataset_name form-control\" type=\"text\" placeholder=\"name\" value=\"<%= _.escape(item.get(\"name\")) %>\"></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Data type</th>',\n                \"<td>\",\n                '<span id=\"dataset_extension_select\" class=\"dataset-extension-select\" />',\n                \"</td>\",\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Genome build</th>',\n                \"<td>\",\n                '<span id=\"dataset_genome_select\" class=\"dataset-genome-select\" />',\n                \"</td>\",\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Size</th>',\n                '<td><%= _.escape(item.get(\"file_size\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Date uploaded (UTC)</th>',\n                '<td><%= _.escape(item.get(\"date_uploaded\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Uploaded by</th>',\n                '<td><%= _.escape(item.get(\"uploaded_by\")) %></td>',\n                \"</tr>\",\n                '<tr scope=\"row\">',\n                '<th scope=\"row\">Data Lines</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_data_lines\")) %></td>',\n                \"</tr>\",\n                '<th scope=\"row\">Comment Lines</th>',\n                '<% if (item.get(\"metadata_comment_lines\") === \"\") { %>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_comment_lines\")) %></td>',\n                \"<% } else { %>\",\n                '<td scope=\"row\">unknown</td>',\n                \"<% } %>\",\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Number of Columns</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_columns\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Column Types</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"metadata_column_types\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Message</th>',\n                '<td scope=\"row\"><input class=\"input_dataset_message form-control\" type=\"text\" placeholder=\"message\" value=\"<%= _.escape(item.get(\"message\")) %>\"></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Misc. blurb</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"misc_blurb\")) %></td>',\n                \"</tr>\",\n                \"<tr>\",\n                '<th scope=\"row\">Misc. information</th>',\n                '<td><input class=\"input_dataset_misc_info form-control\" type=\"text\" placeholder=\"info\" value=\"<%= _.escape(item.get(\"misc_info\")) %>\"></td>',\n                \"</tr>\",\n                //TODO: add functionality to modify tags here\n                '<% if (item.get(\"tags\")) { %>',\n                \"<tr>\",\n                '<th scope=\"row\">Tags</th>',\n                '<td scope=\"row\"><%= _.escape(item.get(\"tags\")) %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"</table>\",\n                \"<div>\",\n                '<pre class=\"peek\">',\n                \"</pre>\",\n                \"</div>\",\n                \"</div>\",\n\n                '<div class=\"d-flex\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Cancel modifications\" class=\"btn btn-secondary toolbtn_cancel_modifications toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-times\"></span>',\n                \"&nbsp;Cancel\",\n                \"</button>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save modifications\" class=\"btn btn-secondary toolbtn_save_modifications toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-floppy-o\"></span>',\n                \"&nbsp;Save\",\n                \"</button>\",\n                \"</div>\",\n\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateDatasetPermissions: function() {\n        return _.template(\n            [\n                // CONTAINER START\n                '<div class=\"library_style_container\">',\n                '<div class=\"d-flex mb-2\">',\n                '<a href=\"#folders/<%- item.get(\"folder_id\") %>/datasets/<%- item.id %>\">',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Go back to dataset\" class=\"btn btn-secondary toolbar-item mr-1\" type=\"button\">',\n                '<span class=\"fa fa-file-o\"></span>',\n                \"&nbsp;Dataset Details\",\n                \"</button>\",\n                \"<a>\",\n                \"</div>\",\n\n                // BREADCRUMBS\n                '<ol class=\"breadcrumb\">',\n                '<li class=\"breadcrumb-item\"><a title=\"Return to the list of libraries\" href=\"#\">Libraries</a></li>',\n                '<% _.each(item.get(\"full_path\"), function(path_item) { %>',\n                \"<% if (path_item[0] != item.id) { %>\",\n                '<li class=\"breadcrumb-item\"><a title=\"Return to this folder\" href=\"#/folders/<%- path_item[0] %>\"><%- path_item[1] %></a> </li> ',\n                \"<% } else { %>\",\n                '<li class=\"breadcrumb-item active\"><span title=\"You are here\"><%- path_item[1] %></span></li>',\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ol>\",\n\n                '<h1>Dataset: <%= _.escape(item.get(\"name\")) %></h1>',\n                '<div class=\"alert alert-warning\">',\n                \"<% if (is_admin) { %>\",\n                \"You are logged in as an <strong>administrator</strong> therefore you can manage any dataset on this Galaxy instance. Please make sure you understand the consequences.\",\n                \"<% } else { %>\",\n                \"You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.\",\n                \"<% } %>\",\n                \"</div>\",\n                '<div class=\"dataset_table\">',\n                \"<h2>Library-related permissions</h2>\",\n                \"<h4>Roles that can modify the library item</h4>\",\n                '<div id=\"modify_perm\" class=\"modify_perm roles-selection\"></div>',\n                '<div class=\"alert alert-info roles-selection\">User with <strong>any</strong> of these roles can modify name, metadata, and other information about this library item.</div>',\n                \"<hr/>\",\n                \"<h2>Dataset-related permissions</h2>\",\n                '<div class=\"alert alert-warning\">Changes made below will affect <strong>every</strong> library item that was created from this dataset and also every history this dataset is part of.</div>',\n                '<% if (!item.get(\"is_unrestricted\")) { %>',\n                '<p>You can <span class=\"remove-restrictions\"><a href=\"\">remove all access restrictions</a></span> on this dataset.</p>',\n                \"<% } else { %>\",\n                '<p>You can <span class=\"make-private\"><a href=\"\">make this dataset private</a></span> to you.</p>',\n                \"<% } %>\",\n                \"<h4>Roles that can access the dataset</h4>\",\n                '<div id=\"access_perm\" class=\"access_perm roles-selection\"></div>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User has to have <strong>all these roles</strong> in order to access this dataset.\",\n                \" Users without access permission <strong>cannot</strong> have other permissions on this dataset.\",\n                \" If there are no access roles set on the dataset it is considered <strong>unrestricted</strong>.\",\n                \"</div>\",\n                \"<h4>Roles that can manage permissions on the dataset</h4>\",\n                '<div id=\"manage_perm\" class=\"manage_perm roles-selection\"></div>',\n                '<div class=\"alert alert-info roles-selection\">',\n                \"User with <strong>any</strong> of these roles can manage permissions of this dataset. If you remove yourself you will lose the ability manage this dataset unless you are an admin.\",\n                \"</div>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save modifications made on this page\" class=\"btn btn-secondary toolbtn_save_permissions  type=\"button\">',\n                '<span class=\"fa fa-floppy-o\"></span>',\n                \"&nbsp;Save\",\n                \"</button>\",\n                \"</div>\",\n                // CONTAINER END\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateBulkImportInModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<div class=\"library-modal-item\">',\n                \"Select history: \",\n                '<select id=\"dataset_import_single\" name=\"dataset_import_single\" style=\"width:50%; margin-bottom: 1em; \" autofocus>',\n                \"<% _.each(histories, function(history) { %>\",\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                '<div class=\"library-modal-item\">',\n                \"or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" style=\"width:50%;\">',\n                \"</input>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryDatasetView: LibraryDatasetView\n};\n"]}