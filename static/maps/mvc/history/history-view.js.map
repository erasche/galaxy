{"version":3,"sources":["mvc/history/history-view.js"],"names":["historyEntry","_","_super","ModelListPanel","HistoryView","extend","_logNamespace","HDAViewClass","HDAListItemView","HDCAViewClass","HDCAListItemView","collectionClass","HistoryContents","modelCollectionKey","tagName","className","prototype","emptyMsg","noneFoundMsg","searchPlaceholder","initialize","attributes","call","linkTarget","_createDefaultCollection","history","model","freeModel","stopPolling","_setUpListeners","on","error","xhr","options","msg","details","errorHandler","view","_renderSelectButton","scrollTo","loadHistory","historyId","contentsOptions","silent","info","setModel","History","id","trigger","fetchWithContents","always","render","refreshContents","refresh","$","when","_setUpCollectionListeners","listenTo","collection","_toggleContentsLoadingIndicator","$emptyMessage","hide","_showLoadingIndicator","speed","callback","$indicator","$el","html","text","slideDown","isUndefined","fxSpeed","_hideLoadingIndicator","slideUp","remove","_buildNewRender","$newRender","$where","multiselectActions","length","views","hideSelectors","find","$existing","title","classes","faIcon","tooltipConfig","placement","prependTo","_renderEmptyMessage","$whereTo","$emptyMsg","empty","get","active","append","show","searchFor","contents","haveSearchDetails","$scrollContainer","$list","renderItems","models","_filterCollection","_renderPagination","_renderSomeItems","toggle","$paginationControls","shouldPaginate","templates","pagination","current","currentPage","last","getLastPage","tooltip","map","_createItemView","m","push","_renderItemView$el","_filterItem","includeHidden","hidden","includeDeleted","isDeletedOrPurged","_getItemViewClass","contentType","TypeError","_getItemViewOptions","expanded","storage","isExpanded","hasUser","ownedByCurrUser","_setUpItemViewListeners","panel","v","addExpanded","collapsed","removeExpanded","collapseAll","clearExpanded","getSelectedModels","events","clone","_clickPrevPage","ev","fetchPrevPage","_clickNextPage","fetchNextPage","_changePageSelect","page","currentTarget","val","fetchPage","toggleShowDeleted","undefined","setIncludeDeleted","fetchCurrentPage","renderAll","toggleShowHidden","store","setIncludeHidden","_firstSearch","inputSelector","log","searchItems","searchInput","progressivelyFetchDetails","progress","response","limit","offset","done","clearSearch","status","readyState","isString","message","errorModal","badGatewayErrorModal","ajaxErrorModal","clearMessages","$target","$messages","children","fadeOut","scrollToHid","hid","scrollToItem","first","viewsWhereModel","ordinalIndicator","number","numStr","charAt","toString","mainTemplate","controlsTemplate","wrapTemplate","paginationTemplate","el","controls","modeButton","initialMode","initialModeDeleted","modes","mode","initialModeHidden","click","hview","Galaxy","currHistoryPanel","window","top","switchToHistory","location","hasMasthead","addClass","viewClass","userIsOwner","HistoryViewEdit","historyModel","historyJSON","useImport","allDatasets","parent","root","loadCurrentHistory","historyView","show_deleted","showDeletedJson","show_hidden","showHiddenJson","purgeAllowed","allow_user_dataset_purge","fetchContents","fail","alert"],"mappings":"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","file":"../../../scripts/mvc/history/history-view.js","sourcesContent":["import * as _ from \"underscore\";\nimport _l from \"utils/localization\";\nimport LIST_VIEW from \"mvc/list/list-view\";\nimport HISTORY_MODEL from \"mvc/history/history-model\";\nimport HISTORY_CONTENTS from \"mvc/history/history-contents\";\nimport History from \"mvc/history/history-model\";\nimport HDA_LI from \"mvc/history/hda-li\";\nimport HDCA_LI from \"mvc/history/hdca-li\";\nimport ERROR_MODAL from \"mvc/ui/error-modal\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport HistoryViewEdit from \"mvc/history/history-view-edit\";\nimport HistoryCopyDialog from \"mvc/history/copy-dialog\";\nimport \"ui/search-input\";\nimport \"ui/mode-button\";\n\n/* global $ */\n/* global Galaxy */\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class  non-editable, read-only View/Controller for a history model.\n *  Allows:\n *      changing the loaded history\n *      displaying data, info, and download\n *      tracking history attrs: size, tags, annotations, name, etc.\n *  Does not allow:\n *      changing the name\n */\nvar _super = LIST_VIEW.ModelListPanel;\nvar HistoryView = _super.extend(\n    /** @lends HistoryView.prototype */ {\n        _logNamespace: \"history\",\n\n        /** class to use for constructing the HDA views */\n        HDAViewClass: HDA_LI.HDAListItemView,\n        /** class to use for constructing the HDCA views */\n        HDCAViewClass: HDCA_LI.HDCAListItemView,\n        /** class to used for constructing collection of sub-view models */\n        collectionClass: HISTORY_CONTENTS.HistoryContents,\n        /** key of attribute in model to assign to this.collection */\n        modelCollectionKey: \"contents\",\n\n        tagName: \"div\",\n        className: `${_super.prototype.className} history-panel`,\n\n        /** string to display when the collection is empty */\n        emptyMsg: _l(\"This history is empty\"),\n        /** displayed when no items match the search terms */\n        noneFoundMsg: _l(\"No matching datasets found\"),\n        /** string used for search placeholder */\n        searchPlaceholder: _l(\"search datasets\"),\n\n        // ......................................................................... SET UP\n        /** Set up the view, bind listeners.\n         *  @param {Object} attributes optional settings for the panel\n         */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n            // ---- instance vars\n            // control contents/behavior based on where (and in what context) the panel is being used\n            /** where should pages from links be displayed? (default to new tab/window) */\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n        },\n\n        /** create and return a collection for when none is initially passed */\n        _createDefaultCollection: function() {\n            // override\n            return new this.collectionClass([], {\n                history: this.model\n            });\n        },\n\n        /** In this override, clear the update timer on the model */\n        freeModel: function() {\n            _super.prototype.freeModel.call(this);\n            if (this.model) {\n                this.model.stopPolling();\n            }\n            return this;\n        },\n\n        /** create any event listeners for the panel\n         *  @fires: rendered:initial    on the first render\n         *  @fires: empty-history       when switching to a history with no contents or creating a new history\n         */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            this.on({\n                error: function(model, xhr, options, msg, details) {\n                    this.errorHandler(model, xhr, options, msg, details);\n                },\n                \"views:ready view:attached view:removed\": function(view) {\n                    this._renderSelectButton();\n                },\n                \"view:attached\": function(view) {\n                    this.scrollTo(0);\n                }\n            });\n            // this.on( 'all', function(){ console.debug( arguments ); });\n        },\n\n        // ------------------------------------------------------------------------ loading history/hda models\n        /** load the history with the given id then it's contents, sending ajax options to both */\n        loadHistory: function(historyId, options, contentsOptions) {\n            contentsOptions = _.extend(contentsOptions || { silent: true });\n            this.info(\"loadHistory:\", historyId, options, contentsOptions);\n            this.setModel(new HISTORY_MODEL.History({ id: historyId }));\n\n            contentsOptions.silent = true;\n            this.trigger(\"loading\");\n            return this.model.fetchWithContents(options, contentsOptions).always(() => {\n                this.render();\n                this.trigger(\"loading-done\");\n            });\n        },\n\n        /** convenience alias to the model. Updates the item list only (not the history) */\n        refreshContents: function(options) {\n            if (this.model) {\n                return this.model.refresh(options);\n            }\n            // may have callbacks - so return an empty promise\n            return $.when();\n        },\n\n        /** Override to reset web storage when the id changes (since it needs the id) */\n        _setUpCollectionListeners: function() {\n            _super.prototype._setUpCollectionListeners.call(this);\n            return this.listenTo(this.collection, {\n                // 'all' : function(){ console.log( this.collection + ':', arguments ); },\n                \"fetching-more\": function() {\n                    this._toggleContentsLoadingIndicator(true);\n                    this.$emptyMessage().hide();\n                },\n                \"fetching-more-done\": function() {\n                    this._toggleContentsLoadingIndicator(false);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n        _showLoadingIndicator: function(msg, speed, callback) {\n            var $indicator = $('<div class=\"loading-indicator\"/>');\n            this.$el.html($indicator.text(msg).slideDown(!_.isUndefined(speed) ? speed : this.fxSpeed));\n        },\n\n        /** hide the loading indicator */\n        _hideLoadingIndicator: function(speed) {\n            // make speed a bit slower to compensate for slow rendering of up to 500 contents\n            this.$(\".loading-indicator\").slideUp(!_.isUndefined(speed) ? speed : this.fxSpeed + 200, function() {\n                $(this).remove();\n            });\n        },\n\n        /** In this override, add a btn to toggle the selectors */\n        _buildNewRender: function() {\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            this._renderSelectButton($newRender);\n            return $newRender;\n        },\n\n        /** button for starting select mode */\n        _renderSelectButton: function($where) {\n            $where = $where || this.$el;\n            // do not render selector option if no actions\n            if (!this.multiselectActions().length) {\n                return null;\n            }\n            // do not render (and remove even) if nothing to select\n            if (!this.views.length) {\n                this.hideSelectors();\n                $where.find(\".controls .actions .show-selectors-btn\").remove();\n                return null;\n            }\n            // don't bother rendering if there's one already\n            var $existing = $where.find(\".controls .actions .show-selectors-btn\");\n            if ($existing.length) {\n                return $existing;\n            }\n\n            return faIconButton({\n                title: _l(\"Operations on multiple datasets\"),\n                classes: \"show-selectors-btn\",\n                faIcon: \"fa-check-square-o\",\n                tooltipConfig: { placement: \"top\" }\n            }).prependTo($where.find(\".controls .actions\"));\n        },\n\n        /** override to avoid showing intial empty message using contents_active */\n        _renderEmptyMessage: function($whereTo) {\n            var $emptyMsg = this.$emptyMessage($whereTo);\n            var empty = this.model.get(\"contents_active\").active <= 0;\n            if (empty) {\n                return $emptyMsg\n                    .empty()\n                    .append(this.emptyMsg)\n                    .show();\n            } else if (this.searchFor && this.model.contents.haveSearchDetails() && !this.views.length) {\n                return $emptyMsg\n                    .empty()\n                    .append(this.noneFoundMsg)\n                    .show();\n            }\n            $emptyMsg.hide();\n            return $();\n        },\n\n        /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n        $scrollContainer: function($where) {\n            // override or set via attributes.$scrollContainer\n            return this.$list($where);\n        },\n\n        // ------------------------------------------------------------------------ subviews\n        _toggleContentsLoadingIndicator: function(show) {\n            if (!show) {\n                this.$list()\n                    .find(\".contents-loading-indicator\")\n                    .remove();\n            } else {\n                this.$list().html(\n                    '<div class=\"contents-loading-indicator\">' + '<span class=\"fa fa-2x fa-spinner fa-spin\"/></div>'\n                );\n            }\n        },\n\n        /** override to render pagination also */\n        renderItems: function($whereTo) {\n            // console.log( this + '.renderItems-----------------', new Date() );\n            $whereTo = $whereTo || this.$el;\n            var $list = this.$list($whereTo);\n\n            // TODO: bootstrap hack to remove orphaned tooltips\n            $(\".tooltip\").remove();\n\n            $list.empty();\n            this.views = [];\n\n            var models = this._filterCollection();\n            if (models.length) {\n                this._renderPagination($whereTo);\n                this.views = this._renderSomeItems(models, $list);\n            } else {\n                // TODO: consolidate with _renderPagination above by (???) passing in models/length?\n                $whereTo.find(\"> .controls .list-pagination\").empty();\n            }\n            this._renderEmptyMessage($whereTo).toggle(!models.length);\n\n            this.trigger(\"views:ready\", this.views);\n            return this.views;\n        },\n\n        /** render pagination controls if not searching and contents says we're paginating */\n        _renderPagination: function($whereTo) {\n            var $paginationControls = $whereTo.find(\"> .controls .list-pagination\");\n            if (this.searchFor || !this.model.contents.shouldPaginate()) return $paginationControls.empty();\n\n            $paginationControls.html(\n                this.templates.pagination(\n                    {\n                        // pagination is 1-based for the user\n                        current: this.model.contents.currentPage + 1,\n                        last: this.model.contents.getLastPage() + 1\n                    },\n                    this\n                )\n            );\n            $paginationControls.find(\"select.pages\").tooltip();\n            return $paginationControls;\n        },\n\n        /** render a subset of the entire collection (client-side pagination) */\n        _renderSomeItems: function(models, $list) {\n            var views = [];\n            $list.append(\n                models.map(m => {\n                    var view = this._createItemView(m);\n                    views.push(view);\n                    return this._renderItemView$el(view);\n                })\n            );\n            return views;\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** in this override, check if the contents would also display based on includeDeleted/hidden */\n        _filterItem: function(model) {\n            var contents = this.model.contents;\n            return (\n                (contents.includeHidden || !model.hidden()) &&\n                (contents.includeDeleted || !model.isDeletedOrPurged()) &&\n                _super.prototype._filterItem.call(this, model)\n            );\n        },\n\n        /** In this override, since history contents are mixed,\n         *      get the appropo view class based on history_content_type\n         */\n        _getItemViewClass: function(model) {\n            var contentType = model.get(\"history_content_type\");\n            switch (contentType) {\n                case \"dataset\":\n                    return this.HDAViewClass;\n                case \"dataset_collection\":\n                    return this.HDCAViewClass;\n            }\n            throw new TypeError(`Unknown history_content_type: ${contentType}`);\n        },\n\n        /** in this override, add a linktarget, and expand if id is in web storage */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(this, model);\n            return _.extend(options, {\n                linkTarget: this.linkTarget,\n                expanded: this.model.contents.storage.isExpanded(model.id),\n                hasUser: this.model.ownedByCurrUser()\n            });\n        },\n\n        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            _super.prototype._setUpItemViewListeners.call(panel, view);\n            //TODO: send from content view: this.model.collection.storage.addExpanded\n            // maintain a list of items whose bodies are expanded\n            return panel.listenTo(view, {\n                expanded: function(v) {\n                    panel.model.contents.storage.addExpanded(v.model);\n                },\n                collapsed: function(v) {\n                    panel.model.contents.storage.removeExpanded(v.model);\n                }\n            });\n        },\n\n        /** override to remove expandedIds from webstorage */\n        collapseAll: function() {\n            this.model.contents.storage.clearExpanded();\n            _super.prototype.collapseAll.call(this);\n        },\n\n        // ------------------------------------------------------------------------ selection\n        /** Override to correctly set the historyId of the new collection */\n        getSelectedModels: function() {\n            var collection = _super.prototype.getSelectedModels.call(this);\n            collection.historyId = this.collection.historyId;\n            return collection;\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .show-selectors-btn\": \"toggleSelectors\",\n            \"click > .controls .prev\": \"_clickPrevPage\",\n            \"click > .controls .next\": \"_clickNextPage\",\n            \"change > .controls .pages\": \"_changePageSelect\",\n            // allow (error) messages to be clicked away\n            \"click .messages [class$=message]\": \"clearMessages\"\n        }),\n\n        _clickPrevPage: function(ev) {\n            this.model.stopPolling();\n            this.model.contents.fetchPrevPage();\n        },\n\n        _clickNextPage: function(ev) {\n            this.model.stopPolling();\n            this.model.contents.fetchNextPage();\n        },\n\n        _changePageSelect: function(ev) {\n            this.model.stopPolling();\n            var page = $(ev.currentTarget).val();\n            this.model.contents.fetchPage(page);\n        },\n\n        /** Toggle and store the deleted visibility and re-render items\n         * @returns {Boolean} new setting\n         */\n        toggleShowDeleted: function(show, options) {\n            show = show !== undefined ? show : !this.model.contents.includeDeleted;\n            var contents = this.model.contents;\n            contents.setIncludeDeleted(show, options);\n            this.trigger(\"show-deleted\", show);\n\n            contents.fetchCurrentPage({ renderAll: true });\n            return show;\n        },\n\n        /** Toggle and store whether to render explicity hidden contents\n         * @returns {Boolean} new setting\n         */\n        toggleShowHidden: function(show, store, options) {\n            // console.log( 'toggleShowHidden', show, store );\n            show = show !== undefined ? show : !this.model.contents.includeHidden;\n            var contents = this.model.contents;\n            contents.setIncludeHidden(show, options);\n            this.trigger(\"show-hidden\", show);\n\n            contents.fetchCurrentPage({ renderAll: true });\n            return show;\n        },\n\n        /** On the first search, if there are no details - load them, then search */\n        _firstSearch: function(searchFor) {\n            var inputSelector = \"> .controls .search-input\";\n            this.log(\"onFirstSearch\", searchFor);\n\n            // if the contents already have enough details to search, search and return now\n            if (this.model.contents.haveSearchDetails()) {\n                this.searchItems(searchFor);\n                return;\n            }\n\n            // otherwise, load the details progressively here\n            this.$(inputSelector).searchInput(\"toggle-loading\");\n            // set this now so that only results will show during progress\n            this.searchFor = searchFor;\n            this.model.contents\n                .progressivelyFetchDetails({ silent: true })\n                .progress((response, limit, offset) => {\n                    this.renderItems();\n                    this.trigger(\"search:loading-progress\", limit, offset);\n                })\n                .always(() => {\n                    this.$el.find(inputSelector).searchInput(\"toggle-loading\");\n                })\n                .done(() => {\n                    this.searchItems(searchFor, \"force\");\n                });\n        },\n\n        /** clear the search filters and show all views that are normally shown */\n        clearSearch: function(searchFor) {\n            if (!this.searchFor) return this;\n            //this.log( 'onSearchClear', this );\n            this.searchFor = \"\";\n            this.trigger(\"search:clear\", this);\n            this.$(\"> .controls .search-query\").val(\"\");\n            // NOTE: silent + render prevents collection update event with merge only\n            // - which causes an empty page due to event handler above\n            this.model.contents.fetchCurrentPage({ silent: true }).done(() => {\n                this.renderItems();\n            });\n            return this;\n        },\n\n        // ........................................................................ error handling\n        /** Event handler for errors (from the panel, the history, or the history's contents)\n         *  Alternately use two strings for model and xhr to use custom message and title (respectively)\n         *  @param {Model or View} model    the (Backbone) source of the error\n         *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n         *  @param {Object} options         the options map commonly used with bbone ajax\n         */\n        errorHandler: function(model, xhr, options) {\n            //TODO: to mixin or base model\n            // interrupted ajax or no connection\n            if (xhr && xhr.status === 0 && xhr.readyState === 0) {\n                // return ERROR_MODAL.offlineErrorModal();\n                // fail silently\n                return;\n            }\n            // otherwise, leave something to report in the console\n            this.error(model, xhr, options);\n            // and feedback to a modal\n            // if sent two strings (and possibly details as 'options'), use those as message and title\n            if (_.isString(model) && _.isString(xhr)) {\n                var message = model;\n                var title = xhr;\n                return ERROR_MODAL.errorModal(message, title, options);\n            }\n            // bad gateway\n            // TODO: possibly to global handler\n            if (xhr && xhr.status === 502) {\n                return ERROR_MODAL.badGatewayErrorModal();\n            }\n            return ERROR_MODAL.ajaxErrorModal(model, xhr, options);\n        },\n\n        /** Remove all messages from the panel. */\n        clearMessages: function(ev) {\n            var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n            $target.fadeOut(this.fxSpeed, function() {\n                $(this).remove();\n            });\n            return this;\n        },\n\n        // ........................................................................ scrolling\n        /** Scrolls the panel to show the content sub-view with the given hid.\n         *  @param {Integer} hid    the hid of item to scroll into view\n         *  @returns {HistoryView} the panel\n         */\n        scrollToHid: function(hid) {\n            return this.scrollToItem(_.first(this.viewsWhereModel({ hid: hid })));\n        },\n\n        // ........................................................................ misc\n        /** utility for adding -st, -nd, -rd, -th to numbers */\n        ordinalIndicator: function(number) {\n            var numStr = `${number}`;\n            switch (numStr.charAt(numStr.length - 1)) {\n                case \"1\":\n                    return `${numStr}st`;\n                case \"2\":\n                    return `${numStr}nd`;\n                case \"3\":\n                    return `${numStr}rd`;\n                default:\n                    return `${numStr}th`;\n            }\n        },\n\n        /** Return a string rep of the history */\n        toString: function() {\n            return `HistoryView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryView.prototype.templates = (() => {\n    var mainTemplate = () =>\n        `<div>\n            <div class=\"controls\"></div>\n            <ul class=\"list-items\"></ul>\n            <div class=\"empty-message infomessagesmall\"></div>',\n        </div>`;\n\n    var controlsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"controls\">',\n            '<div class=\"title\">',\n            '<div class=\"name\"><%- history.name %></div>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            '<div class=\"history-size\"><%- history.nice_size %></div>',\n\n            '<div class=\"actions\"></div>',\n\n            '<div class=\"messages\">',\n            \"<% if( history.deleted && history.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been purged and deleted\"),\n            \"</div>\",\n            \"<% } else if( history.deleted ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been deleted\"),\n            \"</div>\",\n            \"<% } else if( history.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been purged\"),\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( history.message ){ %>\",\n            // should already be localized\n            '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">',\n            \"<%= history.message.text %>\",\n            \"</div>\",\n            \"<% } %>\",\n            \"</div>\",\n\n            // add tags and annotations\n            '<div class=\"tags-display\"></div>',\n            '<div class=\"annotation-display\"></div>',\n\n            '<div class=\"search\">',\n            '<div class=\"search-input\"></div>',\n            \"</div>\",\n\n            '<div class=\"list-actions\">',\n            '<div class=\"btn-group\">',\n            '<button class=\"select-all btn btn-secondary\"',\n            'data-mode=\"select\">',\n            _l(\"All\"),\n            \"</button>\",\n            '<button class=\"deselect-all btn btn-secondary\"',\n            'data-mode=\"select\">',\n            _l(\"None\"),\n            \"</button>\",\n            \"</div>\",\n            '<div class=\"list-action-menu btn-group\">',\n            \"</div>\",\n            \"</div>\",\n            '<div class=\"list-pagination form-inline\"></div>',\n            \"</div>\"\n        ],\n        \"history\"\n    );\n\n    var paginationTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<button class=\"prev\" <%- pages.current === 1 ? \"disabled\" : \"\" %>>previous</button>',\n            '<select class=\"pages form-control\" ',\n            'title=\"',\n            _l(\"Click to open and select a page. Begin typing a page number to select it\"),\n            '\">',\n            \"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>\",\n            '<option value=\"<%- i - 1 %>\" <%- i === pages.current ? \"selected\" : \"\" %>>',\n            \"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages\",\n            \"</option>\",\n            \"<% }); %>\",\n            \"</select>\",\n            '<button class=\"next\" <%- pages.current === pages.last ? \"disabled\" : \"\" %>>next</button>'\n        ],\n        \"pages\"\n    );\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        el: mainTemplate,\n        controls: controlsTemplate,\n        pagination: paginationTemplate\n    });\n})();\n\nexport function historyEntry(options) {\n    $(\"#toggle-deleted\").modeButton({\n        initialMode: options.initialModeDeleted,\n        modes: [\n            { mode: \"showing_deleted\", html: _l(\"Exclude deleted\") },\n            { mode: \"not_showing_deleted\", html: _l(\"Include deleted\") }\n        ]\n    });\n    $(\"#toggle-hidden\").modeButton({\n        initialMode: options.initialModeHidden,\n        modes: [\n            { mode: \"showing_hidden\", html: _l(\"Exclude hidden\") },\n            { mode: \"not_showing_hidden\", html: _l(\"Include hidden\") }\n        ]\n    });\n    $(\"#switch\").click(function() {\n        //##HACK:ity hack hack\n        //##TODO: remove when out of iframe\n        var hview =\n            Galaxy.currHistoryPanel || (window.top.Galaxy && window.top.Galaxy.currHistoryPanel)\n                ? window.top.Galaxy.currHistoryPanel\n                : null;\n        if (hview) {\n            hview.switchToHistory(\"${ history[ 'id' ] }\");\n        } else {\n            window.location = \"${ switch_to_url }\";\n        }\n    });\n    // use_panels effects where the the center_panel() is rendered:\n    //  w/o it renders to the body, w/ it renders to #center - we need to adjust a few things for scrolling to work\n    if (options.hasMasthead) {\n        $(\"#center\").addClass(\"flex-vertical-container\");\n    }\n\n    let viewClass = options.userIsOwner ? HistoryViewEdit.HistoryViewEdit : HistoryView.HistoryView;\n    let historyModel = new History.History(options.historyJSON);\n\n    // attach the copy dialog to the import button now that we have a history\n    $(\"#import\").click(function() {\n        HistoryCopyDialog(historyModel, {\n            useImport: true,\n            // use default datasets option to match the toggle-deleted button\n            allDatasets: $(\"#toggle-deleted\").modeButton(\"getMode\").mode === \"showing_deleted\"\n        }).done(function() {\n            if (window === window.parent) {\n                window.location = Galaxy.root;\n            } else if (Galaxy.currHistoryPanel) {\n                Galaxy.currHistoryPanel.loadCurrentHistory();\n            }\n        });\n    });\n\n    let historyView = new viewClass({\n        el: $(\"#history-\" + options.historyJSON.id),\n        className: viewClass.prototype.className + \" wide\",\n        $scrollContainer: options.hasMasthead\n            ? function() {\n                  return this.$el.parent();\n              }\n            : undefined,\n        model: historyModel,\n        show_deleted: options.showDeletedJson,\n        show_hidden: options.showHiddenJson,\n        purgeAllowed: options.allow_user_dataset_purge\n    });\n    historyView.trigger(\"loading\");\n    historyModel\n        .fetchContents({ silent: true })\n        .fail(function() {\n            alert(\"Galaxy history failed to load\");\n        })\n        .done(function() {\n            historyView.trigger(\"loading-done\");\n            historyView.render();\n        });\n    $(\"#toggle-deleted\").on(\"click\", function() {\n        historyView.toggleShowDeleted();\n    });\n    $(\"#toggle-hidden\").on(\"click\", function() {\n        historyView.toggleShowHidden();\n    });\n}\n\n//==============================================================================\nexport default {\n    HistoryView: HistoryView,\n    historyEntry: historyEntry\n};\n"]}