{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["View","Backbone","extend","initialize","options","model","Model","url","get","redirect","active_tab","setElement","render","self","$","ajax","Galaxy","root","type","done","attributes","response","form","title","title_id","message","status","icon","initial_errors","errors","inputs","buttons","submit","Button","tooltip","submit_tooltip","submit_title","submit_icon","cls","onclick","_submit","$el","empty","append","fail","Message","persistent","data","JSON","stringify","create","contentType","params","id","window","location","param","matchModel","input","input_id","field_list","value","_showMessage","success_message","responseJSON","err_msg","$panel","parents","filter","indexOf","css","first","animate","scrollTop","update"],"mappings":";;;;;;;;;;;;;;;;;AAAA;AAGA,QAAIA,OAAOC,SAASD,IAAT,CAAcE,MAAd,CAAqB;AAC5BC,oBAAY,oBAASC,OAAT,EAAkB;AAC1B,iBAAKC,KAAL,GAAa,IAAIJ,SAASK,KAAb,CAAmBF,OAAnB,CAAb;AACA,iBAAKG,GAAL,GAAW,KAAKF,KAAL,CAAWG,GAAX,CAAe,KAAf,CAAX;AACA,iBAAKC,QAAL,GAAgB,KAAKJ,KAAL,CAAWG,GAAX,CAAe,UAAf,CAAhB;AACA,gBAAIJ,WAAWA,QAAQM,UAAvB,EAAmC;AAC/B,qBAAKA,UAAL,GAAkBN,QAAQM,UAA1B;AACH;AACD,iBAAKC,UAAL,CAAgB,QAAhB;AACA,iBAAKC,MAAL;AACH,SAV2B;;AAY5BA,gBAAQ,kBAAW;AACf,gBAAIC,OAAO,IAAX;AACAC,cAAEC,IAAF,CAAO;AACHR,qBAAKS,OAAOC,IAAP,GAAc,KAAKV,GADrB;AAEHW,sBAAM;AAFH,aAAP,EAIKC,IAJL,CAIU,oBAAY;AACd,oBAAIf,UAAUU,EAAEZ,MAAF,CAAS,EAAT,EAAaW,KAAKR,KAAL,CAAWe,UAAxB,EAAoCC,QAApC,CAAd;AACA,oBAAIC,OAAO,uBAAS;AAChBC,2BAAOnB,QAAQmB,KADC;AAEhBC,8BAAUpB,QAAQoB,QAFF;AAGhBC,6BAASrB,QAAQqB,OAHD;AAIhBC,4BAAQtB,QAAQsB,MAAR,IAAkB,SAJV;AAKhBC,0BAAMvB,QAAQuB,IALE;AAMhBC,oCAAgB,IANA;AAOhBC,4BAAQzB,QAAQyB,MAPA;AAQhBC,4BAAQ1B,QAAQ0B,MARA;AAShBC,6BAAS;AACLC,gCAAQ,IAAI,iBAAGC,MAAP,CAAc;AAClBC,qCAAS9B,QAAQ+B,cADC;AAElBZ,mCAAOnB,QAAQgC,YAAR,IAAwB,MAFb;AAGlBT,kCAAMvB,QAAQiC,WAAR,IAAuB,SAHX;AAIlBC,iCAAK,gCAJa;AAKlBC,qCAAS,mBAAW;AAChB1B,qCAAK2B,OAAL,CAAalB,IAAb;AACH;AAPiB,yBAAd;AADH;AATO,iBAAT,CAAX;AAqBAT,qBAAK4B,GAAL,CAASC,KAAT,GAAiBC,MAAjB,CAAwBrB,KAAKmB,GAA7B;AACH,aA5BL,EA6BKG,IA7BL,CA6BU,oBAAY;AACd/B,qBAAK4B,GAAL,CAASC,KAAT,GAAiBC,MAAjB,CACI,IAAI,iBAAGE,OAAP,CAAe;AACXpB,0DAAoCZ,KAAKN,GAAzC,MADW;AAEXmB,4BAAQ,QAFG;AAGXoB,gCAAY;AAHD,iBAAf,EAIGL,GALP;AAOH,aArCL;AAsCH,SApD2B;;AAsD5BD,iBAAS,iBAASlB,IAAT,EAAe;AACpB,gBAAIT,OAAO,IAAX;AACAC,cAAEC,IAAF,CAAO;AACHR,qBAAKS,OAAOC,IAAP,GAAcJ,KAAKN,GADrB;AAEHwC,sBAAMC,KAAKC,SAAL,CAAe3B,KAAKyB,IAAL,CAAUG,MAAV,EAAf,CAFH;AAGHhC,sBAAM,KAHH;AAIHiC,6BAAa;AAJV,aAAP,EAMKhC,IANL,CAMU,oBAAY;AACd,oBAAIiC,SAAS,EAAb;AACA,oBAAI/B,SAASgC,EAAb,EAAiB;AACbD,2BAAOC,EAAP,GAAYhC,SAASgC,EAArB;AACH,iBAFD,MAEO;AACHD,6BAAS;AACL3B,iCAASJ,SAASI,OADb;AAELC,gCAAQ,SAFH;AAGLoB,oCAAY;AAHP,qBAAT;AAKH;AACD,oBAAIjC,KAAKJ,QAAT,EAAmB;AACf6C,2BAAOC,QAAP,GAAqBvC,OAAOC,IAAP,GAAcJ,KAAKJ,QAAxC,SAAoDK,EAAE0C,KAAF,CAAQJ,MAAR,CAApD;AACH,iBAFD,MAEO;AACH9B,yBAAKyB,IAAL,CAAUU,UAAV,CAAqBpC,QAArB,EAA+B,UAACqC,KAAD,EAAQC,QAAR,EAAqB;AAChDrC,6BAAKsC,UAAL,CAAgBD,QAAhB,EAA0BE,KAA1B,CAAgCH,MAAMG,KAAtC;AACH,qBAFD;AAGAhD,yBAAKiD,YAAL,CAAkBxC,IAAlB,EAAwByC,eAAxB;AACH;AACJ,aAzBL,EA0BKnB,IA1BL,CA0BU,oBAAY;AACd/B,qBAAKiD,YAAL,CAAkBxC,IAAlB,EAAwB;AACpBG,6BAASJ,SAAS2C,YAAT,CAAsBC,OADX;AAEpBvC,4BAAQ,QAFY;AAGpBoB,gCAAY;AAHQ,iBAAxB;AAKH,aAhCL;AAiCH,SAzF2B;;AA2F5BgB,sBAAc,sBAASxC,IAAT,EAAelB,OAAf,EAAwB;AAClC,gBAAI8D,SAAS5C,KAAKmB,GAAL,CACR0B,OADQ,GAERC,MAFQ,CAED,YAAW;AACf,uBAAO,CAAC,MAAD,EAAS,QAAT,EAAmBC,OAAnB,CAA2BvD,EAAE,IAAF,EAAQwD,GAAR,CAAY,UAAZ,CAA3B,KAAuD,CAAC,CAA/D;AACH,aAJQ,EAKRC,KALQ,EAAb;AAMAL,mBAAOM,OAAP,CAAe,EAAEC,WAAW,CAAb,EAAf,EAAiC,GAAjC;AACAnD,iBAAKG,OAAL,CAAaiD,MAAb,CAAoBtE,OAApB;AACH;AApG2B,KAArB,CAAX;;sBAuGe;AACXJ,cAAMA;AADK,K","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model(options);\n        this.url = this.model.get(\"url\");\n        this.redirect = this.model.get(\"redirect\");\n        if (options && options.active_tab) {\n            this.active_tab = options.active_tab;\n        }\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + this.url,\n            type: \"GET\"\n        })\n            .done(response => {\n                var options = $.extend({}, self.model.attributes, response);\n                var form = new Form({\n                    title: options.title,\n                    title_id: options.title_id,\n                    message: options.message,\n                    status: options.status || \"warning\",\n                    icon: options.icon,\n                    initial_errors: true,\n                    errors: options.errors,\n                    inputs: options.inputs,\n                    buttons: {\n                        submit: new Ui.Button({\n                            tooltip: options.submit_tooltip,\n                            title: options.submit_title || \"Save\",\n                            icon: options.submit_icon || \"fa-save\",\n                            cls: \"btn btn-primary ui-clear-float\",\n                            onclick: function() {\n                                self._submit(form);\n                            }\n                        })\n                    }\n                });\n                self.$el.empty().append(form.$el);\n            })\n            .fail(response => {\n                self.$el.empty().append(\n                    new Ui.Message({\n                        message: `Failed to load resource ${self.url}.`,\n                        status: \"danger\",\n                        persistent: true\n                    }).$el\n                );\n            });\n    },\n\n    _submit: function(form) {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + self.url,\n            data: JSON.stringify(form.data.create()),\n            type: \"PUT\",\n            contentType: \"application/json\"\n        })\n            .done(response => {\n                var params = {};\n                if (response.id) {\n                    params.id = response.id;\n                } else {\n                    params = {\n                        message: response.message,\n                        status: \"success\",\n                        persistent: false\n                    };\n                }\n                if (self.redirect) {\n                    window.location = `${Galaxy.root + self.redirect}?${$.param(params)}`;\n                } else {\n                    form.data.matchModel(response, (input, input_id) => {\n                        form.field_list[input_id].value(input.value);\n                    });\n                    self._showMessage(form, success_message);\n                }\n            })\n            .fail(response => {\n                self._showMessage(form, {\n                    message: response.responseJSON.err_msg,\n                    status: \"danger\",\n                    persistent: false\n                });\n            });\n    },\n\n    _showMessage: function(form, options) {\n        var $panel = form.$el\n            .parents()\n            .filter(function() {\n                return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n            })\n            .first();\n        $panel.animate({ scrollTop: 0 }, 500);\n        form.message.update(options);\n    }\n});\n\nexport default {\n    View: View\n};\n"]}