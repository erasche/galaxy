{"version":3,"sources":["mvc/workflow/workflow-node.js"],"names":["Node","Backbone","Model","extend","initialize","app","attr","element","input_terminals","output_terminals","errors","workflow_outputs","getWorkflowOutput","outputName","_","findWhere","output_name","isWorkflowOutput","undefined","removeWorkflowOutput","target","splice","indexOf","addWorkflowOutput","label","output","push","labelWorkflowOutput","changed","oldLabel","workflowOutput","workflow","updateOutputLabel","markChanged","nodeView","redrawWorkflowOutputs","connectedOutputTerminals","_connectedTerminals","terminals","connectedTerminals","$","each","t","connectors","length","hasConnectedOutputTerminals","outputTerminals","connectedMappedInputTerminals","_connectedMappedTerminals","hasConnectedMappedInputTerminals","inputTerminals","inputName","inputTerminal","isMappedOver","mapped_outputs","mapOver","isCollection","mappedInputTerminals","_mappedTerminals","mappedTerminals","hasMappedOverInputTerminals","found","redraw","clone","copiedData","name","annotation","post_job_actions","node","create_node","type","content_id","request","url","Galaxy","root","data","tool_id","tool_state","success","newData","Object","assign","init_field_data","update_field_data","activate_node","destroy","k","remove_node","remove","make_active","addClass","make_inactive","get","p","removeChild","appendChild","parentNode","removeClass","set_tool_version","config_form","tool_version","version","id","tooltip","uuid","el","data_inputs","i","input","addDataInput","data_outputs","addRule","addDataOutput","render","node_changed","unused_outputs","outputViews","output_view","cur_name","data_names","cur_name_in_data_outputs","data_name","unused_output","terminalElement","terminal","x","wf_output","datatypes","extensions","destroyInvalidConnections","pja_in","renderToolErrors","old_body","new_body","newInputsDiv","newTerminalViews","terminalView","difference","values","terminalViews","unusedView","updateDataOutput","replaceWith","error","text","b","find","tmp","html"],"mappings":"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","file":"../../../scripts/mvc/workflow/workflow-node.js","sourcesContent":["import Utils from \"utils/utils\";\nimport NodeView from \"mvc/workflow/workflow-view-node\";\nvar Node = Backbone.Model.extend({\n    initialize: function(app, attr) {\n        this.app = app;\n        this.element = attr.element;\n        this.input_terminals = {};\n        this.output_terminals = {};\n        this.errors = {};\n        this.workflow_outputs = [];\n    },\n    getWorkflowOutput: function(outputName) {\n        return _.findWhere(this.workflow_outputs, {\n            output_name: outputName\n        });\n    },\n    isWorkflowOutput: function(outputName) {\n        return this.getWorkflowOutput(outputName) !== undefined;\n    },\n    removeWorkflowOutput: function(outputName) {\n        while (this.isWorkflowOutput(outputName)) {\n            const target = this.getWorkflowOutput(outputName);\n            this.workflow_outputs.splice(_.indexOf(this.workflow_outputs, target), 1);\n        }\n    },\n    addWorkflowOutput: function(outputName, label) {\n        if (!this.isWorkflowOutput(outputName)) {\n            var output = { output_name: outputName };\n            if (label) {\n                output.label = label;\n            }\n            this.workflow_outputs.push(output);\n            return true;\n        }\n        return false;\n    },\n    labelWorkflowOutput: function(outputName, label) {\n        var changed = false;\n        var oldLabel = null;\n        if (this.isWorkflowOutput(outputName)) {\n            var workflowOutput = this.getWorkflowOutput(outputName);\n            oldLabel = workflowOutput.label;\n            workflowOutput.label = label;\n            changed = oldLabel != label;\n        } else {\n            changed = this.addWorkflowOutput(outputName, label);\n        }\n        if (changed) {\n            this.app.workflow.updateOutputLabel(oldLabel, label);\n            this.markChanged();\n            this.nodeView.redrawWorkflowOutputs();\n        }\n        return changed;\n    },\n    connectedOutputTerminals: function() {\n        return this._connectedTerminals(this.output_terminals);\n    },\n    _connectedTerminals: function(terminals) {\n        var connectedTerminals = [];\n        $.each(terminals, (_, t) => {\n            if (t.connectors.length > 0) {\n                connectedTerminals.push(t);\n            }\n        });\n        return connectedTerminals;\n    },\n    hasConnectedOutputTerminals: function() {\n        // return this.connectedOutputTerminals().length > 0; <- optimized this\n        var outputTerminals = this.output_terminals;\n        for (var outputName in outputTerminals) {\n            if (outputTerminals[outputName].connectors.length > 0) {\n                return true;\n            }\n        }\n        return false;\n    },\n    connectedMappedInputTerminals: function() {\n        return this._connectedMappedTerminals(this.input_terminals);\n    },\n    hasConnectedMappedInputTerminals: function() {\n        // return this.connectedMappedInputTerminals().length > 0; <- optimized this\n        var inputTerminals = this.input_terminals;\n        for (var inputName in inputTerminals) {\n            var inputTerminal = inputTerminals[inputName];\n            if (inputTerminal.connectors.length > 0 && inputTerminal.isMappedOver()) {\n                return true;\n            }\n        }\n        return false;\n    },\n    _connectedMappedTerminals: function(terminals) {\n        var mapped_outputs = [];\n        $.each(terminals, (_, t) => {\n            var mapOver = t.mapOver();\n            if (mapOver.isCollection) {\n                if (t.connectors.length > 0) {\n                    mapped_outputs.push(t);\n                }\n            }\n        });\n        return mapped_outputs;\n    },\n    mappedInputTerminals: function() {\n        return this._mappedTerminals(this.input_terminals);\n    },\n    _mappedTerminals: function(terminals) {\n        var mappedTerminals = [];\n        $.each(terminals, (_, t) => {\n            var mapOver = t.mapOver();\n            if (mapOver.isCollection) {\n                mappedTerminals.push(t);\n            }\n        });\n        return mappedTerminals;\n    },\n    hasMappedOverInputTerminals: function() {\n        var found = false;\n        _.each(this.input_terminals, t => {\n            var mapOver = t.mapOver();\n            if (mapOver.isCollection) {\n                found = true;\n            }\n        });\n        return found;\n    },\n    redraw: function() {\n        $.each(this.input_terminals, (_, t) => {\n            t.redraw();\n        });\n        $.each(this.output_terminals, (_, t) => {\n            t.redraw();\n        });\n    },\n    clone: function() {\n        var copiedData = {\n            name: this.name,\n            label: this.label,\n            annotation: this.annotation,\n            post_job_actions: this.post_job_actions\n        };\n        var node = this.app.workflow.create_node(this.type, this.name, this.content_id);\n\n        Utils.request({\n            type: \"POST\",\n            url: `${Galaxy.root}api/workflows/build_module`,\n            data: {\n                type: this.type,\n                tool_id: this.content_id,\n                tool_state: this.tool_state\n            },\n            success: data => {\n                var newData = Object.assign({}, data, copiedData);\n                node.init_field_data(newData);\n                node.update_field_data(newData);\n                this.app.workflow.activate_node(node);\n            }\n        });\n    },\n    destroy: function() {\n        $.each(this.input_terminals, (k, t) => {\n            t.destroy();\n        });\n        $.each(this.output_terminals, (k, t) => {\n            t.destroy();\n        });\n        this.app.workflow.remove_node(this);\n        $(this.element).remove();\n    },\n    make_active: function() {\n        $(this.element).addClass(\"toolForm-active\");\n    },\n    make_inactive: function() {\n        // Keep inactive nodes stacked from most to least recently active\n        // by moving element to the end of parent's node list\n        var element = this.element.get(0);\n        (p => {\n            p.removeChild(element);\n            p.appendChild(element);\n        })(element.parentNode);\n        // Remove active class\n        $(element).removeClass(\"toolForm-active\");\n    },\n    set_tool_version: function() {\n        if (this.type === \"tool\" && this.config_form) {\n            this.tool_version = this.config_form.version;\n            this.content_id = this.config_form.id;\n        }\n    },\n    init_field_data: function(data) {\n        if (data.type) {\n            this.type = data.type;\n        }\n        this.name = data.name;\n        this.config_form = data.config_form;\n        this.set_tool_version();\n        this.tool_state = data.tool_state;\n        this.errors = data.errors;\n        this.tooltip = data.tooltip ? data.tooltip : \"\";\n        this.annotation = data.annotation;\n        this.post_job_actions = data.post_job_actions ? data.post_job_actions : {};\n        this.label = data.label;\n        this.uuid = data.uuid;\n        this.workflow_outputs = data.workflow_outputs ? data.workflow_outputs : [];\n        var node = this;\n        var nodeView = new NodeView({\n            el: this.element[0],\n            node: node\n        });\n        node.nodeView = nodeView;\n        $.each(data.data_inputs, (i, input) => {\n            nodeView.addDataInput(input);\n        });\n        if (data.data_inputs.length > 0 && data.data_outputs.length > 0) {\n            nodeView.addRule();\n        }\n        $.each(data.data_outputs, (i, output) => {\n            nodeView.addDataOutput(output);\n        });\n        nodeView.render();\n        this.app.workflow.node_changed(this, true);\n    },\n    update_field_data: function(data) {\n        var node = this;\n        var nodeView = node.nodeView;\n        // remove unused output views and remove pre-existing output views from data.data_outputs,\n        // so that these are not added twice.\n        var unused_outputs = [];\n        // nodeView.outputViews contains pre-existing outputs,\n        // while data.data_output contains what should be displayed.\n        // Now we gather the unused outputs\n        $.each(nodeView.outputViews, (i, output_view) => {\n            var cur_name = output_view.output.name;\n            var data_names = data.data_outputs;\n            var cur_name_in_data_outputs = false;\n            _.each(data_names, data_name => {\n                if (data_name.name == cur_name) {\n                    cur_name_in_data_outputs = true;\n                }\n            });\n            if (cur_name_in_data_outputs === false) {\n                unused_outputs.push(cur_name);\n            }\n        });\n\n        // Remove the unused outputs\n        _.each(unused_outputs, unused_output => {\n            _.each(nodeView.outputViews[unused_output].terminalElement.terminal.connectors, x => {\n                if (x) {\n                    x.destroy(); // Removes the noodle connectors\n                }\n            });\n            nodeView.outputViews[unused_output].remove(); // removes the rendered output\n            delete nodeView.outputViews[unused_output]; // removes the reference to the output\n            delete node.output_terminals[unused_output]; // removes the output terminal\n        });\n        $.each(node.workflow_outputs, (i, wf_output) => {\n            if (wf_output && !node.output_terminals[wf_output.output_name]) {\n                node.workflow_outputs.splice(i, 1); // removes output from list of workflow outputs\n            }\n        });\n        $.each(data.data_outputs, (i, output) => {\n            if (!nodeView.outputViews[output.name]) {\n                nodeView.addDataOutput(output); // add data output if it does not yet exist\n            } else {\n                // the output already exists, but the output formats may have changed.\n                // Therefore we update the datatypes and destroy invalid connections.\n                node.output_terminals[output.name].datatypes = output.extensions;\n                node.output_terminals[output.name].destroyInvalidConnections();\n            }\n        });\n        this.tool_state = data.tool_state;\n        this.config_form = data.config_form;\n        this.set_tool_version();\n        this.errors = data.errors;\n        this.annotation = data.annotation;\n        this.label = data.label;\n        if (\"post_job_actions\" in data) {\n            // Won't be present in response for data inputs\n            var pja_in = data.post_job_actions;\n            this.post_job_actions = pja_in ? pja_in : {};\n        }\n        node.nodeView.renderToolErrors();\n        // Update input rows\n        var old_body = nodeView.$(\"div.inputs\");\n        var new_body = nodeView.newInputsDiv();\n        var newTerminalViews = {};\n        _.each(data.data_inputs, input => {\n            var terminalView = node.nodeView.addDataInput(input, new_body);\n            newTerminalViews[input.name] = terminalView;\n        });\n        // Cleanup any leftover terminals\n        _.each(_.difference(_.values(nodeView.terminalViews), _.values(newTerminalViews)), unusedView => {\n            unusedView.el.terminal.destroy();\n        });\n        nodeView.terminalViews = newTerminalViews;\n        node.nodeView.render();\n        // In general workflow editor assumes tool outputs don't change in # or\n        // type (not really valid right?) but adding special logic here for\n        // data collection input parameters that can have their collection\n        // change.\n        if (data.data_outputs.length == 1 && \"collection_type\" in data.data_outputs[0]) {\n            nodeView.updateDataOutput(data.data_outputs[0]);\n        }\n        old_body.replaceWith(new_body);\n        if (\"workflow_outputs\" in data) {\n            // Won't be present in response for data inputs\n            this.workflow_outputs = data.workflow_outputs ? data.workflow_outputs : [];\n        }\n        // If active, reactivate with new config_form\n        this.markChanged();\n        this.redraw();\n    },\n    error: function(text) {\n        var b = $(this.element).find(\".toolFormBody\");\n        b.find(\"div\").remove();\n        var tmp = `<div style='color: red; text-style: italic;'>${text}</div>`;\n        this.config_form = tmp;\n        b.html(tmp);\n        this.app.workflow.node_changed(this);\n    },\n    markChanged: function() {\n        this.app.workflow.node_changed(this);\n    }\n});\nexport default Node;\n"]}