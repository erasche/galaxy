{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["Backbone","View","extend","events","initialize","options","model","Model","collection","Collection","get","tabs","setElement","$el","addClass","render","listenTo","first","delAll","_renderRegular","_renderList","title_length","$","each","title","append","_templateThumbnailItem","id","length","substr","title_icon","image_src","tooltip","placement","children","add","uid","self","_templateRegularItem","attributes","value","new_value","undefined","before","attr","removeClass","after","change_handler","_onclick","e","target","closest","_ondblclick","_templateImage","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\nimport * as Backbone from \"backbone\";\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\n\n/* global $ */\n\nvar View = Backbone.View.extend({\n    events: {\n        \"click .ui-thumbnails-item\": \"_onclick\",\n        \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n    },\n\n    initialize: function(options) {\n        this.model = options.model || new Backbone.Model(options);\n        this.collection = new Backbone.Collection(this.model.get(\"collection\"));\n        this.tabs = new Tabs.View({});\n        this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"reset change add remove\", this.render, this);\n    },\n\n    render: function() {\n        this.first = null;\n        this.tabs.delAll();\n        this._renderRegular();\n        this._renderList();\n    },\n\n    _renderRegular: function() {\n        var title_length = 20;\n        var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n        this.collection.each(model => {\n            if (model.get(\"regular\")) {\n                var title = model.get(\"title\");\n                $el.append(\n                    $(\n                        this._templateThumbnailItem({\n                            id: model.id,\n                            title: title.length < title_length ? title : `${title.substr(0, title_length)}...`,\n                            title_icon: model.get(\"title_icon\"),\n                            image_src: model.get(\"image_src\")\n                        })\n                    ).tooltip({\n                        title: model.get(\"description\"),\n                        placement: \"bottom\"\n                    })\n                );\n            }\n        });\n        if ($el.children().length > 0) {\n            this.tabs.add({\n                id: Utils.uid(),\n                title: this.model.get(\"title_default\"),\n                $el: $el\n            });\n        }\n    },\n\n    _renderList: function() {\n        var self = this;\n        if (this.collection.length > 0) {\n            this.first = this.first || this.collection.first().id;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(model => {\n                $el.append(self._templateRegularItem(model.attributes));\n            });\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_list\"),\n                $el: $el\n            });\n        }\n    },\n\n    /** Set/Get value */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            new_value = new_value == \"__first\" ? this.first : new_value;\n            var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            this.$(\".ui-thumbnail-current\").removeClass(\"ui-thumbnail-current\");\n            this.$(`[value=\"${new_value}\"]`).addClass(\"ui-thumbnail-current\");\n            var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            var change_handler = this.model.get(\"onchange\");\n            if (after != before && change_handler) {\n                change_handler(after);\n            }\n        }\n        return this.$(\".ui-thumbnail-current\").attr(\"value\");\n    },\n\n    /** Add click handler */\n    _onclick: function(e) {\n        this.value(\n            $(e.target)\n                .closest(\".ui-thumbnails-item\")\n                .attr(\"value\")\n        );\n        if (this.model.get(\"onclick\")) {\n            this.model.get(\"onclick\")(this.value());\n        }\n    },\n\n    /** Add double click handler */\n    _ondblclick: function() {\n        if (this.model.get(\"ondblclick\")) {\n            this.model.get(\"ondblclick\")(this.value());\n        }\n    },\n\n    /** Image/Icon template */\n    _templateImage: function(options) {\n        if (options.image_src) {\n            return `<img class=\"ui-thumbnails-image\" src=\"${options.image_src}\"/>`;\n        }\n        return `<div class=\"ui-thumbnails-icon fa fa-eye\"/>`;\n    },\n\n    /* Thumbnail template with image */\n    _templateThumbnailItem: function(options) {\n        return `<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"${options.id}\">${this._templateImage(\n            options\n        )}<div class=\"ui-thumbnails-title ui-form-info\"><span class=\"fa ${options.title_icon}\"/>${\n            options.title\n        }</div><div>`;\n    },\n\n    /* Thumbnail template with image and description */\n    _templateRegularItem: function(options) {\n        return `<div class=\"ui-thumbnails-item\" value=\"${options.id}\"><table><tr><td>${this._templateImage(\n            options\n        )}</td><td><div class=\"ui-thumbnails-description-title ui-form-info\">${\n            options.title\n        }</div><div class=\"ui-thumbnails-description-text ui-form-info\">${options.description}</div></td></tr><div>`;\n    }\n});\nexport default { View: View };\n"]}