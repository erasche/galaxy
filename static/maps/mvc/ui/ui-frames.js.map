{"version":3,"sources":["mvc/ui/ui-frames.js"],"names":["Backbone","_","FrameView","View","extend","initialize","options","model","Model","setElement","$","addClass","$el","append","tooltip","title","placement","$header","$title","$content","render","listenTo","self","attributes","html","find","remove","each","menu","$option","option","icon","isFunction","disabled","attr","on","onclick","url","indexOf","content","defaultOptions","frame","cols","rows","cell","margin","scroll","top_min","frame_max","visible","top","top_max","frame_z","frame_counter","frame_uid","frame_list","frame_shadow","event","defaults","el","_frameInit","_frameResize","width","height","show","hide","_panelRefresh","window","resize","add","Galaxy","modal","body","buttons","Close","frame_id","length","_toPixelCoord","parseInt","css","_frameInsert","left","trigger","del","$frame","fadeOut","id","_panelAnimationComplete","fadeIn","type","events","mousemove","mouseup","mouseleave","mousewheel","DOMMouseScroll","_eventFrameMouseDown","e","target","hasClass","preventDefault","_frameIdentify","xy","x","originalEvent","pageX","y","pageY","_frameDragStart","_eventFrameMouseMove","event_xy_new","event_xy_delta","p","_frameScreen","min_dim","Math","max","_toGridCoord","_frameOffset","l","_eventFrameMouseUp","_frameDragStop","_eventFrameClose","_eventHide","_eventPanelScroll","frames","srcElement","parents","stopPropagation","_panelScroll","detail","wheelDelta","_eventPanelScroll_up","_eventPanelScroll_down","closest","_frameFocus","_frameGrid","grid_location","px","sign","g","_toGrid","_toPixel","_isCollision","is_collision_pair","a","b","i","_locationRank","loc","animate","promise","done","delta","top_new","min","screen_location","grid_rank","substring","new_loc","place_list","push","f","sort","_framePlace","place","j","console","log","has_focus"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-frames.js","sourcesContent":["/** Frame view */\nimport _l from \"utils/localization\";\nimport * as Backbone from \"backbone\";\nimport * as _ from \"underscore\";\n/* global $ */\n/* global Galaxy */\n\nvar FrameView = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = (options && options.model) || new Backbone.Model(options);\n        this.setElement($(\"<div/>\").addClass(\"corner frame\"));\n        this.$el\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"f-header corner\")\n                    .append($(\"<div/>\").addClass(\"f-title\"))\n                    .append(\n                        $(\"<div/>\")\n                            .addClass(\"f-icon f-close fa fa-close\")\n                            .tooltip({\n                                title: _l(\"Close\"),\n                                placement: \"bottom\"\n                            })\n                    )\n            )\n            .append($(\"<div/>\").addClass(\"f-content\"))\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"f-resize f-icon corner fa fa-expand\")\n                    .tooltip({ title: \"Resize\" })\n            )\n            .append($(\"<div/>\").addClass(\"f-cover\"));\n        this.$header = this.$(\".f-header\");\n        this.$title = this.$(\".f-title\");\n        this.$content = this.$(\".f-content\");\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$title.html(options.title || \"\");\n        this.$header.find(\".f-icon-left\").remove();\n        _.each(options.menu, option => {\n            var $option = $(\"<div/>\")\n                .addClass(\"f-icon-left\")\n                .addClass(option.icon);\n            if (_.isFunction(option.disabled) && option.disabled()) {\n                $option.attr(\"disabled\", true);\n            } else {\n                $option\n                    .on(\"click\", () => {\n                        option.onclick(self);\n                    })\n                    .tooltip({\n                        title: option.tooltip || \"\",\n                        placement: \"bottom\"\n                    });\n            }\n            self.$header.append($option);\n        });\n        if (options.url) {\n            this.$content.html(\n                $(\"<iframe/>\")\n                    .addClass(\"f-iframe\")\n                    .attr(\"scrolling\", \"auto\")\n                    .attr(\"src\", `${options.url + (options.url.indexOf(\"?\") === -1 ? \"?\" : \"&\")}widget=True`)\n            );\n        } else if (options.content) {\n            if (_.isFunction(options.content)) {\n                options.content(self.$content);\n            } else {\n                self.$content.html(options.content);\n            }\n        }\n    }\n});\n\n/** Scratchbook viewer */\nvar View = Backbone.View.extend({\n    defaultOptions: {\n        frame: {\n            // default frame size in cells\n            cols: 6,\n            rows: 3\n        },\n        rows: 1000, // maximum number of rows\n        cell: 130, // cell size in px\n        margin: 5, // margin between frames\n        scroll: 5, // scroll speed\n        top_min: 40, // top margin\n        frame_max: 9, // maximum number of frames\n        visible: true // initial visibility\n    },\n\n    cols: 0, // number of columns\n    top: 0, // scroll/element top\n    top_max: 0, // viewport scrolling state\n    frame_z: 0, // frame z-index\n    frame_counter: 0, // frame counter\n    frame_uid: 0, // unique frame id counter\n    frame_list: {}, // list of all frames\n    frame_shadow: null, // frame shown as placeholder when moving active frames\n    visible: false, // flag indicating if scratchbook viewer is visible or not\n    event: {}, // dictionary keeping track of current event\n\n    initialize: function(options) {\n        var self = this;\n        this.options = _.defaults(options || {}, this.defaultOptions);\n        this.visible = this.options.visible;\n        this.top = this.top_max = this.options.top_min;\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"galaxy-frame\")\n                .append($(\"<div/>\").addClass(\"frame-background\"))\n                .append($(\"<div/>\").addClass(\"frame-menu frame-scroll-up fa fa-chevron-up fa-2x\"))\n                .append($(\"<div/>\").addClass(\"frame-menu frame-scroll-down fa fa-chevron-down fa-2x\"))\n        );\n\n        // initialize shadow to guiding drag/resize events\n        this.frame_shadow = new Backbone.View({\n            el: $(\"<div/>\").addClass(\"corner frame-shadow\")\n        });\n        this.$el.append(this.frame_shadow.$el);\n        this._frameInit(this.frame_shadow, \"#frame-shadow\");\n        this._frameResize(this.frame_shadow, { width: 0, height: 0 });\n        this.frame_list[\"#frame-shadow\"] = this.frame_shadow;\n\n        // initialize panel\n        if (this.visible) {\n            this.show();\n        } else {\n            this.hide();\n        }\n        this._panelRefresh();\n        $(window).resize(() => {\n            if (self.visible) {\n                self._panelRefresh();\n            }\n        });\n    },\n\n    /** Render */\n    render: function() {\n        this.$(\".frame-scroll-up\")[(this.top != this.options.top_min && \"show\") || \"hide\"]();\n        this.$(\".frame-scroll-down\")[(this.top != this.top_max && \"show\") || \"hide\"]();\n    },\n\n    /**\n     * Adds and displays a new frame.\n     *\n     * options:\n     *  url     : loaded into an iframe\n     *  content : content is treated as a function or raw HTML, function is passed a single\n     *              argument that is the frame's content DOM element\n     */\n    add: function(options) {\n        if (this.frame_counter >= this.options.frame_max) {\n            Galaxy.modal.show({\n                title: _l(\"Warning\"),\n                body: `You have reached the maximum number of allowed frames (${this.options.frame_max}).`,\n                buttons: {\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        } else {\n            var frame_id = `#frame-${this.frame_uid++}`;\n            if ($(frame_id).length !== 0) {\n                Galaxy.modal.show({\n                    title: _l(\"Error\"),\n                    body: \"This frame already exists. This page might contain multiple frame managers.\",\n                    buttons: {\n                        Close: function() {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            } else {\n                // initialize new frame elements\n                this.top = this.options.top_min;\n                var frame = new FrameView(options);\n                this.$el.append(frame.$el);\n\n                // set dimensions\n                options.width = this._toPixelCoord(\"width\", this.options.frame.cols);\n                options.height = this._toPixelCoord(\"height\", this.options.frame.rows);\n\n                // set default z-index and add to ui and frame list\n                this.frame_z = parseInt(frame.$el.css(\"z-index\"));\n                this.frame_list[frame_id] = frame;\n                this.frame_counter++;\n                this._frameInit(frame, frame_id);\n                this._frameResize(frame, {\n                    width: options.width,\n                    height: options.height\n                });\n                this._frameInsert(frame, { top: 0, left: 0 }, true);\n                if (!this.visible) {\n                    this.show();\n                }\n                this.trigger(\"add\");\n            }\n        }\n    },\n\n    /** Remove a frame */\n    del: function(frame) {\n        var self = this;\n        var $frame = frame.$el;\n        $frame.fadeOut(\"fast\", () => {\n            $frame.remove();\n            delete self.frame_list[frame.id];\n            self.frame_counter--;\n            self._panelRefresh(true);\n            self._panelAnimationComplete();\n            self.trigger(\"remove\");\n        });\n    },\n\n    /** Show panel */\n    show: function() {\n        this.visible = true;\n        this.$el.fadeIn(\"fast\");\n        this.trigger(\"show\");\n    },\n\n    /** Hide panel */\n    hide: function() {\n        if (!this.event.type) {\n            this.visible = false;\n            this.$el.fadeOut(\"fast\", function() {\n                $(this).hide();\n            });\n            this.trigger(\"hide\");\n        }\n    },\n\n    /** Returns the number of frames */\n    length: function() {\n        return this.frame_counter;\n    },\n\n    /*\n        EVENT HANDLING\n    */\n    events: {\n        // global frame events\n        mousemove: \"_eventFrameMouseMove\",\n        mouseup: \"_eventFrameMouseUp\",\n        mouseleave: \"_eventFrameMouseUp\",\n        mousewheel: \"_eventPanelScroll\",\n        DOMMouseScroll: \"_eventPanelScroll\",\n\n        // events fixed to elements\n        \"mousedown .frame\": \"_eventFrameMouseDown\",\n        \"mousedown .frame-background\": \"_eventHide\",\n        \"mousedown .frame-scroll-up\": \"_eventPanelScroll_up\",\n        \"mousedown .frame-scroll-down\": \"_eventPanelScroll_down\",\n        \"mousedown .f-close\": \"_eventFrameClose\"\n    },\n\n    /** Start drag/resize event */\n    _eventFrameMouseDown: function(e) {\n        $(\".tooltip\").hide();\n        if (!this.event.type) {\n            if ($(e.target).hasClass(\"f-header\") || $(e.target).hasClass(\"f-title\")) {\n                this.event.type = \"drag\";\n            }\n            if ($(e.target).hasClass(\"f-resize\")) {\n                this.event.type = \"resize\";\n            }\n            if (this.event.type) {\n                e.preventDefault();\n                this.event.target = this._frameIdentify(e.target);\n                this.event.xy = {\n                    x: e.originalEvent.pageX,\n                    y: e.originalEvent.pageY\n                };\n                this._frameDragStart(this.event.target);\n            }\n        }\n    },\n\n    /** Processes drag/resize events */\n    _eventFrameMouseMove: function(e) {\n        if (this.event.type) {\n            // get mouse motion and delta\n            var event_xy_new = {\n                x: e.originalEvent.pageX,\n                y: e.originalEvent.pageY\n            };\n            var event_xy_delta = {\n                x: event_xy_new.x - this.event.xy.x,\n                y: event_xy_new.y - this.event.xy.y\n            };\n            this.event.xy = event_xy_new;\n\n            // get current screen position and size of frame\n            var p = this._frameScreen(this.event.target);\n\n            // drag/resize event\n            if (this.event.type == \"resize\") {\n                p.width += event_xy_delta.x;\n                p.height += event_xy_delta.y;\n                var min_dim = this.options.cell - this.options.margin - 1;\n                p.width = Math.max(p.width, min_dim);\n                p.height = Math.max(p.height, min_dim);\n                this._frameResize(this.event.target, p);\n                p.width = this._toGridCoord(\"width\", p.width) + 1;\n                p.height = this._toGridCoord(\"height\", p.height) + 1;\n                p.width = this._toPixelCoord(\"width\", p.width);\n                p.height = this._toPixelCoord(\"height\", p.height);\n                this._frameResize(this.frame_shadow, p);\n                this._frameInsert(this.frame_shadow, {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                });\n            } else if (this.event.type == \"drag\") {\n                p.left += event_xy_delta.x;\n                p.top += event_xy_delta.y;\n                this._frameOffset(this.event.target, p);\n                var l = {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                };\n                if (l.left !== 0) {\n                    l.left++;\n                }\n                this._frameInsert(this.frame_shadow, l);\n            }\n        }\n    },\n\n    /** Stop drag/resize events */\n    _eventFrameMouseUp: function(e) {\n        if (this.event.type) {\n            this._frameDragStop(this.event.target);\n            this.event.type = null;\n        }\n    },\n\n    /** Destroy a frame */\n    _eventFrameClose: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this.del(this._frameIdentify(e.target));\n        }\n    },\n\n    /** Hide all frames */\n    _eventHide: function(e) {\n        if (!this.event.type) {\n            this.hide();\n        }\n    },\n\n    /** Fired when scrolling occurs on panel */\n    _eventPanelScroll: function(e) {\n        if (!this.event.type && this.visible) {\n            // Stop propagation if scrolling is happening inside a frame.\n            // TODO: could propagate scrolling if at top/bottom of frame.\n            var frames = $(e.srcElement).parents(\".frame\");\n            if (frames.length !== 0) {\n                e.stopPropagation();\n            } else {\n                e.preventDefault();\n                this._panelScroll(e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3);\n            }\n        }\n    },\n\n    /** Handle scroll up event */\n    _eventPanelScroll_up: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(-this.options.scroll);\n        }\n    },\n\n    /** Handle scroll down */\n    _eventPanelScroll_down: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(this.options.scroll);\n        }\n    },\n\n    /*\n        FRAME EVENTS SUPPORT\n    */\n\n    /** Identify the target frame */\n    _frameIdentify: function(target) {\n        return this.frame_list[\n            `#${$(target)\n                .closest(\".frame\")\n                .attr(\"id\")}`\n        ];\n    },\n\n    /** Provides drag support */\n    _frameDragStart: function(frame) {\n        this._frameFocus(frame, true);\n        var p = this._frameScreen(frame);\n        this._frameResize(this.frame_shadow, p);\n        this._frameGrid(this.frame_shadow, frame.grid_location);\n        frame.grid_location = null;\n        this.frame_shadow.$el.show();\n        $(\".f-cover\").show();\n    },\n\n    /** Removes drag support */\n    _frameDragStop: function(frame) {\n        this._frameFocus(frame, false);\n        var p = this._frameScreen(this.frame_shadow);\n        this._frameResize(frame, p);\n        this._frameGrid(frame, this.frame_shadow.grid_location, true);\n        this.frame_shadow.grid_location = null;\n        this.frame_shadow.$el.hide();\n        $(\".f-cover\").hide();\n        this._panelAnimationComplete();\n    },\n\n    /*\n        GRID/PIXEL CONVERTER\n    */\n\n    /** Converts a pixel to a grid dimension */\n    _toGridCoord: function(type, px) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        if (type == \"top\") {\n            px -= this.top;\n        }\n        return parseInt((px + sign * this.options.margin) / this.options.cell, 10);\n    },\n\n    /** Converts a grid to a pixels dimension */\n    _toPixelCoord: function(type, g) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        var px = g * this.options.cell - sign * this.options.margin;\n        if (type == \"top\") {\n            px += this.top;\n        }\n        return px;\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toGrid: function(px) {\n        return {\n            top: this._toGridCoord(\"top\", px.top),\n            left: this._toGridCoord(\"left\", px.left),\n            width: this._toGridCoord(\"width\", px.width),\n            height: this._toGridCoord(\"height\", px.height)\n        };\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toPixel: function(g) {\n        return {\n            top: this._toPixelCoord(\"top\", g.top),\n            left: this._toPixelCoord(\"left\", g.left),\n            width: this._toPixelCoord(\"width\", g.width),\n            height: this._toPixelCoord(\"height\", g.height)\n        };\n    },\n\n    /* \n        COLLISION DETECTION\n    */\n\n    /** Check collisions for a grid coordinate set */\n    _isCollision: function(g) {\n        function is_collision_pair(a, b) {\n            return !(\n                a.left > b.left + b.width - 1 ||\n                a.left + a.width - 1 < b.left ||\n                a.top > b.top + b.height - 1 ||\n                a.top + a.height - 1 < b.top\n            );\n        }\n        for (var i in this.frame_list) {\n            var frame = this.frame_list[i];\n            if (frame.grid_location !== null && is_collision_pair(g, frame.grid_location)) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /** Return location/grid rank */\n    _locationRank: function(loc) {\n        return loc.top * this.cols + loc.left;\n    },\n\n    /*\n        PANEL/WINDOW FUNCTIONS\n    */\n\n    /** Refresh panel */\n    _panelRefresh: function(animate) {\n        this.cols = parseInt($(window).width() / this.options.cell, 10) + 1;\n        this._frameInsert(null, null, animate);\n    },\n\n    /** Complete panel animation / frames not moving */\n    _panelAnimationComplete: function() {\n        var self = this;\n        $(\".frame\")\n            .promise()\n            .done(() => {\n                self._panelScroll(0, true);\n            });\n    },\n\n    /** Scroll panel */\n    _panelScroll: function(delta, animate) {\n        var top_new = this.top - this.options.scroll * delta;\n        top_new = Math.max(top_new, this.top_max);\n        top_new = Math.min(top_new, this.options.top_min);\n        if (this.top != top_new) {\n            for (var i in this.frame_list) {\n                var frame = this.frame_list[i];\n                if (frame.grid_location !== null) {\n                    var screen_location = {\n                        top: frame.screen_location.top - (this.top - top_new),\n                        left: frame.screen_location.left\n                    };\n                    this._frameOffset(frame, screen_location, animate);\n                }\n            }\n            this.top = top_new;\n        }\n        this.render();\n    },\n\n    /*\n        FRAME FUNCTIONS\n    */\n\n    /** Initialize a new frame */\n    _frameInit: function(frame, id) {\n        frame.id = id;\n        frame.screen_location = {};\n        frame.grid_location = {};\n        frame.grid_rank = null;\n        frame.$el.attr(\"id\", id.substring(1));\n    },\n\n    /** Insert frame at given location */\n    _frameInsert: function(frame, new_loc, animate) {\n        var self = this;\n        var place_list = [];\n        if (frame) {\n            frame.grid_location = null;\n            place_list.push([frame, this._locationRank(new_loc)]);\n        }\n        _.each(this.frame_list, f => {\n            if (f.grid_location !== null) {\n                f.grid_location = null;\n                place_list.push([f, f.grid_rank]);\n            }\n        });\n        place_list.sort((a, b) => (a[1] < b[1] ? -1 : a[1] > b[1] ? 1 : 0));\n        _.each(place_list, place => {\n            self._framePlace(place[0], animate);\n        });\n        this.top_max = 0;\n        _.each(this.frame_list, f => {\n            if (f.grid_location !== null) {\n                self.top_max = Math.max(self.top_max, f.grid_location.top + f.grid_location.height);\n            }\n        });\n        this.top_max = $(window).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n        this.top_max = Math.min(this.top_max, this.options.top_min);\n        this.render();\n    },\n\n    /** Naive frame placement */\n    _framePlace: function(frame, animate) {\n        frame.grid_location = null;\n        var g = this._toGrid(this._frameScreen(frame));\n        var done = false;\n        for (var i = 0; i < this.options.rows; i++) {\n            for (var j = 0; j < Math.max(1, this.cols - g.width); j++) {\n                g.top = i;\n                g.left = j;\n                if (!this._isCollision(g)) {\n                    done = true;\n                    break;\n                }\n            }\n            if (done) {\n                break;\n            }\n        }\n        if (done) {\n            this._frameGrid(frame, g, animate);\n        } else {\n            console.log(\"Grid dimensions exceeded.\");\n        }\n    },\n\n    /** Handle frame focussing */\n    _frameFocus: function(frame, has_focus) {\n        frame.$el.css(\"z-index\", this.frame_z + (has_focus ? 1 : 0));\n    },\n\n    /** New left/top position frame */\n    _frameOffset: function(frame, p, animate) {\n        frame.screen_location.left = p.left;\n        frame.screen_location.top = p.top;\n        if (animate) {\n            this._frameFocus(frame, true);\n            var self = this;\n            frame.$el.animate({ top: p.top, left: p.left }, \"fast\", () => {\n                self._frameFocus(frame, false);\n            });\n        } else {\n            frame.$el.css({ top: p.top, left: p.left });\n        }\n    },\n\n    /** Resize frame */\n    _frameResize: function(frame, p) {\n        frame.$el.css({ width: p.width, height: p.height });\n        frame.screen_location.width = p.width;\n        frame.screen_location.height = p.height;\n    },\n\n    /** Push frame to new grid location */\n    _frameGrid: function(frame, l, animate) {\n        frame.grid_location = l;\n        this._frameOffset(frame, this._toPixel(l), animate);\n        frame.grid_rank = this._locationRank(l);\n    },\n\n    /** Get frame dimensions */\n    _frameScreen: function(frame) {\n        var p = frame.screen_location;\n        return {\n            top: p.top,\n            left: p.left,\n            width: p.width,\n            height: p.height\n        };\n    }\n});\n\nexport default {\n    View: View\n};\n"]}