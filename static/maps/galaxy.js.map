{"version":3,"sources":["galaxy.js"],"names":["_","Backbone","GalaxyApp","options","bootstrapped","self","_init","DEBUGGING_KEY","NAMESPACE_KEY","FLATTEN_LOG_MESSAGES_KEY","localDebugging","localStorage","getItem","storageErr","console","log","prototype","__init","extend","Events","logger","debug","_processOptions","root","params","session_csrf_token","_initConfig","config","_patchGalaxy","window","Galaxy","_initLogger","loggerOptions","_initLocale","localize","_initUser","user","_initUserLocale","sessionStorage","_setUpListeners","trigger","defaultOptions","patchExisting","defaults","k","hasOwnProperty","patchWith","consoleLogger","consoleLevel","MetricsLogger","ALL","consoleNamespaceWhitelist","split","consoleFlattenMessages","emit","map","i","data","arguments","Array","slice","call","LoggableMixin","_l","global_locale","default_locale","toLowerCase","extra_user_preferences","attributes","preferences","JSON","parse","user_locale","nav_locale","navigator","language","userLanguage","locale","setItem","userJSON","User","lastAjax","$","document","bind","ev","xhr","err","url","location","href","debugging","_debugging","setting","undefined","removeItem","debuggingNamespaces","_debuggingNamespaces","namespaces","csv","newSettings","toString","userEmail","get"],"mappings":";;;;;;;QAAYA,C;;QACAC,Q;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOZ;;AAEA;AACA;AACA;;;;;;;;AAQA,aAASC,SAAT,CAAmBC,OAAnB,EAA4BC,YAA5B,EAA0C;AACtC,YAAIC,OAAO,IAAX;AACA,eAAOA,KAAKC,KAAL,CAAWH,WAAW,EAAtB,EAA0BC,gBAAgB,EAA1C,CAAP;AACH;;AAED;AACA,8BAAWF,SAAX,EAAsB,WAAtB;;AAEA;AACA,QAAIK,gBAAgB,cAApB;;AAEA,QAAIC,gBAAmBD,aAAnB,gBAAJ;AACA,QAAIE,2BAA8BF,aAA9B,aAAJ;;AAEA,QAAIG,iBAAiB,KAArB;AACA,QAAI;AACAA,yBAAiBC,aAAaC,OAAb,CAAqBL,aAArB,KAAuC,MAAxD;AACH,KAFD,CAEE,OAAOM,UAAP,EAAmB;AACjBC,gBAAQC,GAAR,CAAY,4BAAS,qDAAT,CAAZ;AACH;;AAED;AACAb,cAAUc,SAAV,CAAoBV,KAApB,GAA4B,SAASW,MAAT,CAAgBd,OAAhB,EAAyBC,YAAzB,EAAuC;AAC/D,YAAIC,OAAO,IAAX;AACAL,UAAEkB,MAAF,CAASb,IAAT,EAAeJ,SAASkB,MAAxB;AACA,YAAIT,cAAJ,EAAoB;AAChBL,iBAAKe,MAAL,GAAcN,OAAd;AACAA,oBAAQO,KAAR,CAAc,mBAAd,EAAmC,UAAnC,EAA+ClB,OAA/C,EAAwD,eAAxD,EAAyEC,YAAzE;AACH;;AAEDC,aAAKiB,eAAL,CAAqBnB,OAArB;;AAEA;AACAE,aAAKkB,IAAL,GAAYpB,QAAQoB,IAAR,IAAgB,GAA5B;AACAlB,aAAKmB,MAAL,GAAcrB,QAAQqB,MAAR,IAAkB,EAAhC;AACAnB,aAAKoB,kBAAL,GAA0BtB,QAAQsB,kBAAR,IAA8B,IAAxD;;AAEApB,aAAKqB,WAAL,CAAiBvB,QAAQwB,MAAR,IAAkB,EAAnC;AACAtB,aAAKuB,YAAL,CAAkBC,OAAOC,MAAzB;;AAEAzB,aAAK0B,WAAL,CAAiB1B,KAAKF,OAAL,CAAa6B,aAAb,IAA8B,EAA/C;AACA;AACA3B,aAAKgB,KAAL,CAAW,qBAAX,EAAkChB,KAAKF,OAAvC;AACAE,aAAKgB,KAAL,CAAW,oBAAX,EAAiChB,KAAKsB,MAAtC;AACAtB,aAAKgB,KAAL,CAAW,oBAAX,EAAiChB,KAAKe,MAAtC;;AAEAf,aAAK4B,WAAL;AACA5B,aAAKgB,KAAL,CAAW,sBAAX,EAAmChB,KAAK6B,QAAxC;;AAEA7B,aAAKsB,MAAL,GAAcxB,QAAQwB,MAAR,IAAkB,EAAhC;AACAtB,aAAKgB,KAAL,CAAW,oBAAX,EAAiChB,KAAKsB,MAAtC;;AAEAtB,aAAK8B,SAAL,CAAehC,QAAQiC,IAAR,IAAgB,EAA/B;AACA/B,aAAKgB,KAAL,CAAW,kBAAX,EAA+BhB,KAAK+B,IAApC;;AAEA/B,aAAKgC,eAAL;AACAhC,aAAKgB,KAAL,CAAW,iBAAX,EAA8BiB,eAAe1B,OAAf,CAAuB,eAAvB,CAA9B;;AAEAP,aAAKkC,eAAL;AACAlC,aAAKmC,OAAL,CAAa,OAAb,EAAsBnC,IAAtB;;AAEA,eAAOA,IAAP;AACH,KAxCD;;AA0CA;AACAH,cAAUc,SAAV,CAAoByB,cAApB,GAAqC;AACjC;AACAC,uBAAe,IAFkB;AAGjC;AACAnB,cAAM,GAJ2B;AAKjCE,4BAAoB;AALa,KAArC;;AAQA;AACAvB,cAAUc,SAAV,CAAoBM,eAApB,GAAsC,SAASA,eAAT,CAAyBnB,OAAzB,EAAkC;AACpE,YAAIE,OAAO,IAAX;AACA,YAAIsC,WAAWtC,KAAKoC,cAApB;;AAEApC,aAAKF,OAAL,GAAe,EAAf;AACA,aAAK,IAAIyC,CAAT,IAAcD,QAAd,EAAwB;AACpB,gBAAIA,SAASE,cAAT,CAAwBD,CAAxB,CAAJ,EAAgC;AAC5BvC,qBAAKF,OAAL,CAAayC,CAAb,IAAkBzC,QAAQ0C,cAAR,CAAuBD,CAAvB,IAA4BzC,QAAQyC,CAAR,CAA5B,GAAyCD,SAASC,CAAT,CAA3D;AACH;AACJ;AACD,eAAOvC,IAAP;AACH,KAXD;;AAaA;AACAH,cAAUc,SAAV,CAAoBU,WAApB,GAAkC,SAASA,WAAT,CAAqBC,MAArB,EAA6B;AAC3D,YAAItB,OAAO,IAAX;AACAA,aAAKsB,MAAL,GAAcA,MAAd;;AAEA;AACAtB,aAAKsB,MAAL,CAAYN,KAAZ,GAAoBX,kBAAkBL,KAAKsB,MAAL,CAAYN,KAAlD;;AAEA,eAAOhB,IAAP;AACH,KARD;;AAUA;AACAH,cAAUc,SAAV,CAAoBY,YAApB,GAAmC,SAASA,YAAT,CAAsBkB,SAAtB,EAAiC;AAChE,YAAIzC,OAAO,IAAX;AACA;AACA,YAAIA,KAAKF,OAAL,CAAauC,aAAb,IAA8BI,SAAlC,EAA6C;AACzC;AACA;AACA;AACA,iBAAK,IAAIF,CAAT,IAAcE,SAAd,EAAyB;AACrB,oBAAIA,UAAUD,cAAV,CAAyBD,CAAzB,CAAJ,EAAiC;AAC7B;AACAvC,yBAAKuC,CAAL,IAAUE,UAAUF,CAAV,CAAV;AACH;AACJ;AACJ;AACJ,KAdD;;AAgBA;AACA1C,cAAUc,SAAV,CAAoBe,WAApB,GAAkC,SAASA,WAAT,CAAqBC,aAArB,EAAoC;AAClE,YAAI3B,OAAO,IAAX;;AAEA;AACA,YAAIA,KAAKsB,MAAL,CAAYN,KAAhB,EAAuB;AACnBW,0BAAce,aAAd,GAA8Bf,cAAce,aAAd,IAA+BjC,OAA7D;AACAkB,0BAAcgB,YAAd,GAA6BhB,cAAcgB,YAAd,IAA8B,wBAAcC,aAAd,CAA4BC,GAAvF;AACA;AACA,gBAAI;AACAlB,8BAAcmB,yBAAd,GAA0CxC,aAAaC,OAAb,CAAqBJ,aAArB,EAAoC4C,KAApC,CAA0C,GAA1C,CAA1C;AACH,aAFD,CAEE,OAAOvC,UAAP,EAAmB,CAAE;AACvB,gBAAI;AACAmB,8BAAcqB,sBAAd,GAAuC1C,aAAaC,OAAb,CAAqBH,wBAArB,KAAkD,MAAzF;AACH,aAFD,CAEE,OAAOI,UAAP,EAAmB,CAAE;AACvBC,oBAAQC,GAAR,CAAYiB,cAAcqB,sBAA1B;AACH;;AAEDhD,aAAKe,MAAL,GAAc,IAAI,wBAAc6B,aAAlB,CAAgCjB,aAAhC,CAAd;AACA3B,aAAKiD,IAAL,GAAY,EAAZ;AACA,SAAC,KAAD,EAAQ,OAAR,EAAiB,MAAjB,EAAyB,MAAzB,EAAiC,OAAjC,EAA0C,QAA1C,EAAoDC,GAApD,CAAwD,aAAK;AACzDlD,iBAAKiD,IAAL,CAAUE,CAAV,IAAe,UAASC,IAAT,EAAe;AAC1BpD,qBAAKe,MAAL,CAAYkC,IAAZ,CAAiBE,CAAjB,EAAoBE,UAAU,CAAV,CAApB,EAAkCC,MAAM3C,SAAN,CAAgB4C,KAAhB,CAAsBC,IAAtB,CAA2BH,SAA3B,EAAsC,CAAtC,CAAlC;AACH,aAFD;AAGH,SAJD;;AAMA,YAAIrD,KAAKsB,MAAL,CAAYN,KAAhB,EAAuB;AACnB;AACA,8BAASyC,aAAT,CAAuB1C,MAAvB,GAAgCf,KAAKe,MAArC;AACH;AACD,eAAOf,IAAP;AACH,KA9BD;;AAgCA;AACAH,cAAUc,SAAV,CAAoBiB,WAApB,GAAkC,SAASA,WAAT,CAAqB9B,OAArB,EAA8B;AAC5D,YAAIE,OAAO,IAAX;AACAA,aAAKgB,KAAL,CAAW,cAAX,EAA2BlB,OAA3B;AACAE,aAAK6B,QAAL;AACA;AACA;AACAL,eAAOkC,EAAP,GAAY1D,KAAK6B,QAAjB;AACA,eAAO7B,IAAP;AACH,KARD;;AAUA;AACAH,cAAUc,SAAV,CAAoBqB,eAApB,GAAsC,SAASA,eAAT,CAAyBlC,OAAzB,EAAkC;AACpE,YAAIE,OAAO,IAAX;;AAEA;AACA,YAAI2D,gBAAgB3D,KAAKsB,MAAL,CAAYsC,cAAZ,GAA6B5D,KAAKsB,MAAL,CAAYsC,cAAZ,CAA2BC,WAA3B,EAA7B,GAAwE,KAA5F;;AAEA,YAAIC,yBAAyB,EAA7B;AACA,YAAI9D,KAAK+B,IAAL,IAAa/B,KAAK+B,IAAL,CAAUgC,UAAV,CAAqBC,WAAlC,IAAiD,4BAA4BhE,KAAK+B,IAAL,CAAUgC,UAAV,CAAqBC,WAAtG,EAAmH;AAC/GF,qCAAyBG,KAAKC,KAAL,CAAWlE,KAAK+B,IAAL,CAAUgC,UAAV,CAAqBC,WAArB,CAAiCF,sBAA5C,CAAzB;AACH;;AAED,YAAIK,cACA,yBAAyBL,sBAAzB,GACMA,uBAAuB,qBAAvB,EAA8CD,WAA9C,EADN,GAEM,KAHV;;AAKA,YAAIM,eAAe,MAAnB,EAA2B;AACvBA,0BAAc,KAAd;AACH;;AAED,YAAIC,aACA,OAAOC,SAAP,KAAqB,WAArB,GACM,QADN,GAEM,CAACA,UAAUC,QAAV,IAAsBD,UAAUE,YAAhC,IAAgD,QAAjD,EAA2DV,WAA3D,EAHV;;AAKA,YAAIW,SAASL,eAAeR,aAAf,IAAgCS,UAA7C;;AAEAnC,uBAAewC,OAAf,CAAuB,eAAvB,EAAwCD,MAAxC;AACH,KA5BD;;AA8BA;AACA3E,cAAUc,SAAV,CAAoBmB,SAApB,GAAgC,SAASA,SAAT,CAAmB4C,QAAnB,EAA6B;AACzD,YAAI1E,OAAO,IAAX;AACAA,aAAKgB,KAAL,CAAW,YAAX,EAAyB0D,QAAzB;AACA1E,aAAK+B,IAAL,GAAY,IAAI,oBAAU4C,IAAd,CAAmBD,QAAnB,CAAZ;AACA1E,aAAK+B,IAAL,CAAUhB,MAAV,GAAmBf,KAAKe,MAAxB;AACA,eAAOf,IAAP;AACH,KAND;;AAQA;AACAH,cAAUc,SAAV,CAAoBuB,eAApB,GAAsC,SAASA,eAAT,GAA2B;AAC7D,YAAIlC,OAAO,IAAX;;AAEA;AACA;AACAA,aAAK4E,QAAL,GAAgB,EAAhB;AACAC,UAAEC,QAAF,EAAYC,IAAZ,CAAiB,UAAjB,EAA6B,UAACC,EAAD,EAAKC,GAAL,EAAUnF,OAAV,EAAsB;AAC/C,gBAAIsD,OAAOtD,QAAQsD,IAAnB;AACA,gBAAI;AACAA,uBAAOa,KAAKC,KAAL,CAAWd,IAAX,CAAP;AACH,aAFD,CAEE,OAAO8B,GAAP,EAAY,CAAE;;AAEhBlF,iBAAK4E,QAAL,GAAgB;AACZO,qBAAKC,SAASC,IAAT,CAAc9B,KAAd,CAAoB,CAApB,EAAuB,CAAC,CAAxB,IAA6BzD,QAAQqF,GAD9B;AAEZ/B,sBAAMA;AAFM,aAAhB;AAIA;AACH,SAXD;AAYA,eAAOpD,IAAP;AACH,KAnBD;;AAqBA;AACAH,cAAUc,SAAV,CAAoB2E,SAApB,GAAgC,SAASC,UAAT,CAAoBC,OAApB,EAA6B;AACzD,YAAIxF,OAAO,IAAX;AACA,YAAI;AACA,gBAAIwF,YAAYC,SAAhB,EAA2B;AACvB,uBAAOnF,aAAaC,OAAb,CAAqBL,aAArB,MAAwC,MAA/C;AACH;AACD,gBAAIsF,OAAJ,EAAa;AACTlF,6BAAamE,OAAb,CAAqBvE,aAArB,EAAoC,IAApC;AACA,uBAAO,IAAP;AACH;;AAEDI,yBAAaoF,UAAb,CAAwBxF,aAAxB;AACA;AACAF,iBAAK2F,mBAAL,CAAyB,IAAzB;AACH,SAZD,CAYE,OAAOnF,UAAP,EAAmB;AACjBC,oBAAQC,GAAR,CAAY,4BAAS,qDAAT,CAAZ;AACH;AACD,eAAO,KAAP;AACH,KAlBD;;AAoBA;;;;;;AAMAb,cAAUc,SAAV,CAAoBgF,mBAApB,GAA0C,SAASC,oBAAT,CAA8BC,UAA9B,EAA0C;AAChF,YAAI7F,OAAO,IAAX;AACA,YAAI;AACA,gBAAI6F,eAAeJ,SAAnB,EAA8B;AAC1B,oBAAIK,MAAMxF,aAAaC,OAAb,CAAqBJ,aAArB,CAAV;AACA,uBAAO,OAAO2F,GAAP,KAAe,QAAf,GAA0BA,IAAI/C,KAAJ,CAAU,GAAV,CAA1B,GAA2C,EAAlD;AACH,aAHD,MAGO,IAAI8C,eAAe,IAAnB,EAAyB;AAC5BvF,6BAAaoF,UAAb,CAAwBvF,aAAxB;AACH,aAFM,MAEA;AACHG,6BAAamE,OAAb,CAAqBtE,aAArB,EAAoC0F,UAApC;AACH;AACD,gBAAIE,cAAc/F,KAAK2F,mBAAL,EAAlB;AACA,gBAAI3F,KAAKe,MAAT,EAAiB;AACbf,qBAAKe,MAAL,CAAYjB,OAAZ,CAAoBgD,yBAApB,GAAgDiD,WAAhD;AACH;AACD,mBAAOA,WAAP;AACH,SAdD,CAcE,OAAOvF,UAAP,EAAmB;AACjBC,oBAAQC,GAAR,CAAY,4BAAS,0DAAT,CAAZ;AACH;AACJ,KAnBD;;AAqBA;AACAb,cAAUc,SAAV,CAAoBqF,QAApB,GAA+B,SAASA,QAAT,GAAoB;AAC/C,YAAIC,YAAY,KAAKlE,IAAL,GAAY,KAAKA,IAAL,CAAUmE,GAAV,CAAc,OAAd,KAA0B,aAAtC,GAAsD,eAAtE;AACA,8BAAoBD,SAApB;AACH,KAHD;;AAKA;AACAzE,WAAOC,MAAP,GAAgBD,OAAOC,MAAP,IAAiB,IAAI5B,SAAJ,EAAjC;;AAEA;sBACe;AACXA,mBAAWA;AADA,K","file":"../scripts/galaxy.js","sourcesContent":["import * as _ from \"libs/underscore\";\nimport * as Backbone from \"libs/backbone\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport userModel from \"mvc/user/user-model\";\nimport metricsLogger from \"utils/metrics-logger\";\nimport addLogging from \"utils/add-logging\";\nimport localize from \"utils/localization\";\n\n/* global $ */\n\n// TODO: move into a singleton pattern and have dependents import Galaxy\n// ============================================================================\n/** Base galaxy client-side application.\n *      Iniitializes:\n *          logger      : the logger/metrics-logger\n *          localize    : the string localizer\n *          config      : the current configuration (any k/v in\n *              galaxy.ini available from the configuration API)\n *          user        : the current user (as a mvc/user/user-model)\n */\nfunction GalaxyApp(options, bootstrapped) {\n    var self = this;\n    return self._init(options || {}, bootstrapped || {});\n}\n\n// add logging shortcuts for this object\naddLogging(GalaxyApp, \"GalaxyApp\");\n\n// a debug flag can be set via local storage and made available during script/page loading\nvar DEBUGGING_KEY = \"galaxy:debug\";\n\nvar NAMESPACE_KEY = `${DEBUGGING_KEY}:namespaces`;\nvar FLATTEN_LOG_MESSAGES_KEY = `${DEBUGGING_KEY}:flatten`;\n\nvar localDebugging = false;\ntry {\n    localDebugging = localStorage.getItem(DEBUGGING_KEY) == \"true\";\n} catch (storageErr) {\n    console.log(localize(\"localStorage not available for debug flag retrieval\"));\n}\n\n/** initalize options and sub-components */\nGalaxyApp.prototype._init = function __init(options, bootstrapped) {\n    var self = this;\n    _.extend(self, Backbone.Events);\n    if (localDebugging) {\n        self.logger = console;\n        console.debug(\"debugging galaxy:\", \"options:\", options, \"bootstrapped:\", bootstrapped);\n    }\n\n    self._processOptions(options);\n\n    // add root and url parameters\n    self.root = options.root || \"/\";\n    self.params = options.params || {};\n    self.session_csrf_token = options.session_csrf_token || null;\n\n    self._initConfig(options.config || {});\n    self._patchGalaxy(window.Galaxy);\n\n    self._initLogger(self.options.loggerOptions || {});\n    // at this point, either logging or not and namespaces are enabled - chat it up\n    self.debug(\"GalaxyApp.options: \", self.options);\n    self.debug(\"GalaxyApp.config: \", self.config);\n    self.debug(\"GalaxyApp.logger: \", self.logger);\n\n    self._initLocale();\n    self.debug(\"GalaxyApp.localize: \", self.localize);\n\n    self.config = options.config || {};\n    self.debug(\"GalaxyApp.config: \", self.config);\n\n    self._initUser(options.user || {});\n    self.debug(\"GalaxyApp.user: \", self.user);\n\n    self._initUserLocale();\n    self.debug(\"currentLocale: \", sessionStorage.getItem(\"currentLocale\"));\n\n    self._setUpListeners();\n    self.trigger(\"ready\", self);\n\n    return self;\n};\n\n/** default options */\nGalaxyApp.prototype.defaultOptions = {\n    /** monkey patch attributes from existing window.Galaxy object? */\n    patchExisting: true,\n    /** root url of this app */\n    root: \"/\",\n    session_csrf_token: null\n};\n\n/** filter to options present in defaultOptions (and default to them) */\nGalaxyApp.prototype._processOptions = function _processOptions(options) {\n    var self = this;\n    var defaults = self.defaultOptions;\n\n    self.options = {};\n    for (var k in defaults) {\n        if (defaults.hasOwnProperty(k)) {\n            self.options[k] = options.hasOwnProperty(k) ? options[k] : defaults[k];\n        }\n    }\n    return self;\n};\n\n/** parse the config and any extra info derived from it */\nGalaxyApp.prototype._initConfig = function _initConfig(config) {\n    var self = this;\n    self.config = config;\n\n    // give precendence to localdebugging for this setting\n    self.config.debug = localDebugging || self.config.debug;\n\n    return self;\n};\n\n/** add an option from options if the key matches an option in defaultOptions */\nGalaxyApp.prototype._patchGalaxy = function _patchGalaxy(patchWith) {\n    var self = this;\n    // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n    if (self.options.patchExisting && patchWith) {\n        // self.debug( 'found existing Galaxy object:', patchWith );\n        // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n        //TODO: move those attributes to more formal assignment in GalaxyApp\n        for (var k in patchWith) {\n            if (patchWith.hasOwnProperty(k)) {\n                // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n                self[k] = patchWith[k];\n            }\n        }\n    }\n};\n\n/** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\nGalaxyApp.prototype._initLogger = function _initLogger(loggerOptions) {\n    var self = this;\n\n    // default to console logging at the debug level if the debug flag is set\n    if (self.config.debug) {\n        loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n        loggerOptions.consoleLevel = loggerOptions.consoleLevel || metricsLogger.MetricsLogger.ALL;\n        // load any logging namespaces from localStorage if we can\n        try {\n            loggerOptions.consoleNamespaceWhitelist = localStorage.getItem(NAMESPACE_KEY).split(\",\");\n        } catch (storageErr) {}\n        try {\n            loggerOptions.consoleFlattenMessages = localStorage.getItem(FLATTEN_LOG_MESSAGES_KEY) == \"true\";\n        } catch (storageErr) {}\n        console.log(loggerOptions.consoleFlattenMessages);\n    }\n\n    self.logger = new metricsLogger.MetricsLogger(loggerOptions);\n    self.emit = {};\n    [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"metric\"].map(i => {\n        self.emit[i] = function(data) {\n            self.logger.emit(i, arguments[0], Array.prototype.slice.call(arguments, 1));\n        };\n    });\n\n    if (self.config.debug) {\n        // add this logger to mvc's loggable mixin so that all models can use the logger\n        BASE_MVC.LoggableMixin.logger = self.logger;\n    }\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initLocale = function _initLocale(options) {\n    var self = this;\n    self.debug(\"_initLocale:\", options);\n    self.localize = localize;\n    // add to window as global shortened alias\n    // TODO: temporary - remove when can require for plugins\n    window._l = self.localize;\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initUserLocale = function _initUserLocale(options) {\n    var self = this;\n\n    // Choose best locale\n    var global_locale = self.config.default_locale ? self.config.default_locale.toLowerCase() : false;\n\n    var extra_user_preferences = {};\n    if (self.user && self.user.attributes.preferences && \"extra_user_preferences\" in self.user.attributes.preferences) {\n        extra_user_preferences = JSON.parse(self.user.attributes.preferences.extra_user_preferences);\n    }\n\n    var user_locale =\n        \"localization|locale\" in extra_user_preferences\n            ? extra_user_preferences[\"localization|locale\"].toLowerCase()\n            : false;\n\n    if (user_locale == \"auto\") {\n        user_locale = false;\n    }\n\n    var nav_locale =\n        typeof navigator === \"undefined\"\n            ? \"__root\"\n            : (navigator.language || navigator.userLanguage || \"__root\").toLowerCase();\n\n    let locale = user_locale || global_locale || nav_locale;\n\n    sessionStorage.setItem(\"currentLocale\", locale);\n};\n\n/** set up the current user as a Backbone model (mvc/user/user-model) */\nGalaxyApp.prototype._initUser = function _initUser(userJSON) {\n    var self = this;\n    self.debug(\"_initUser:\", userJSON);\n    self.user = new userModel.User(userJSON);\n    self.user.logger = self.logger;\n    return self;\n};\n\n/** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\nGalaxyApp.prototype._setUpListeners = function _setUpListeners() {\n    var self = this;\n\n    // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n    /** cached info about the last ajax call made through jQuery */\n    self.lastAjax = {};\n    $(document).bind(\"ajaxSend\", (ev, xhr, options) => {\n        var data = options.data;\n        try {\n            data = JSON.parse(data);\n        } catch (err) {}\n\n        self.lastAjax = {\n            url: location.href.slice(0, -1) + options.url,\n            data: data\n        };\n        //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n    });\n    return self;\n};\n\n/** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\nGalaxyApp.prototype.debugging = function _debugging(setting) {\n    var self = this;\n    try {\n        if (setting === undefined) {\n            return localStorage.getItem(DEBUGGING_KEY) === \"true\";\n        }\n        if (setting) {\n            localStorage.setItem(DEBUGGING_KEY, true);\n            return true;\n        }\n\n        localStorage.removeItem(DEBUGGING_KEY);\n        // also remove all namespaces\n        self.debuggingNamespaces(null);\n    } catch (storageErr) {\n        console.log(localize(\"localStorage not available for debug flag retrieval\"));\n    }\n    return false;\n};\n\n/** Add, remove, or clear namespaces from the debugging filters\n *  Pass no arguments to retrieve the existing namespaces as an array.\n *  Pass in null to clear all namespaces (all logging messages will show now).\n *  Pass in an array of strings or single string of the namespaces to filter to.\n *  Returns the new/current namespaces as an array;\n */\nGalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces(namespaces) {\n    var self = this;\n    try {\n        if (namespaces === undefined) {\n            var csv = localStorage.getItem(NAMESPACE_KEY);\n            return typeof csv === \"string\" ? csv.split(\",\") : [];\n        } else if (namespaces === null) {\n            localStorage.removeItem(NAMESPACE_KEY);\n        } else {\n            localStorage.setItem(NAMESPACE_KEY, namespaces);\n        }\n        var newSettings = self.debuggingNamespaces();\n        if (self.logger) {\n            self.logger.options.consoleNamespaceWhitelist = newSettings;\n        }\n        return newSettings;\n    } catch (storageErr) {\n        console.log(localize(\"localStorage not available for debug namespace retrieval\"));\n    }\n};\n\n/** string rep */\nGalaxyApp.prototype.toString = function toString() {\n    var userEmail = this.user ? this.user.get(\"email\") || \"(anonymous)\" : \"uninitialized\";\n    return `GalaxyApp(${userEmail})`;\n};\n\n// This is not great.  Rework to be a singleton-style Galaxy app accessible/created by import\nwindow.Galaxy = window.Galaxy || new GalaxyApp();\n\n// ============================================================================\nexport default {\n    GalaxyApp: GalaxyApp\n};\n"]}