{"version":3,"sources":["ui/pagination.js"],"names":["Pagination","element","options","numPages","currPage","init","prototype","DATA_KEY","defaults","startingPage","perPage","totalDataSize","currDataSize","_init","$element","$","extend","Math","ceil","data","_render","_make$Li","contents","join","__render","_renderPages","_scrollToActivePage","_renderPrevNext","__renderPrevNext","pagination","$prev","$next","$paginationContainer","addClass","click","prevPage","nextPage","html","append","__renderPages","$scrollingContainer","page$LiClick","ev","goToPage","i","$pageLi","attr","__scrollToActivePage","$container","find","length","$activePage","midpoint","width","scrollLeft","position","left","page","trigger","create","_create","fn","$pagination","nonOptionsArgs","makeArray","arguments","slice","type","map","$firstElement","previousControl","apply","undefined"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AAOA,aAASA,UAAT,CAAoBC,OAApB,EAA6BC,OAA7B,EAAsC;AAClC;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA;AACA,aAAKC,QAAL,GAAgB,CAAhB;AACA,eAAO,KAAKC,IAAL,CAAUJ,OAAV,EAAmBC,OAAnB,CAAP;AACH;;AAED;AACAF,eAAWM,SAAX,CAAqBC,QAArB,GAAgC,YAAhC;AACA;AACAP,eAAWM,SAAX,CAAqBE,QAArB,GAAgC;AAC5B;AACAC,sBAAc,CAFc;AAG5B;AACAC,iBAAS,EAJmB;AAK5B;AACAC,uBAAe,IANa;AAO5B;AACAC,sBAAc;AARc,KAAhC;;AAWA;;;;AAIAZ,eAAWM,SAAX,CAAqBD,IAArB,GAA4B,SAASQ,KAAT,CAAeC,QAAf,EAAyBZ,OAAzB,EAAkC;AAC1DA,kBAAUA,WAAW,EAArB;AACA,aAAKY,QAAL,GAAgBA,QAAhB;AACA,aAAKZ,OAAL,GAAea,EAAEC,MAAF,CAAS,IAAT,EAAe,EAAf,EAAmB,KAAKR,QAAxB,EAAkCN,OAAlC,CAAf;;AAEA,aAAKE,QAAL,GAAgB,KAAKF,OAAL,CAAaO,YAA7B;AACA,YAAI,KAAKP,OAAL,CAAaS,aAAb,KAA+B,IAAnC,EAAyC;AACrC,iBAAKR,QAAL,GAAgBc,KAAKC,IAAL,CAAU,KAAKhB,OAAL,CAAaS,aAAb,GAA6B,KAAKT,OAAL,CAAaQ,OAApD,CAAhB;AACA;AACA,gBAAI,KAAKN,QAAL,IAAiB,KAAKD,QAA1B,EAAoC;AAChC,qBAAKC,QAAL,GAAgB,KAAKD,QAAL,GAAgB,CAAhC;AACH;AACJ;AACD;AACA;;AAEA;AACA,aAAKW,QAAL,CAAcK,IAAd,CAAmBnB,WAAWM,SAAX,CAAqBC,QAAxC,EAAkD,IAAlD;;AAEA,aAAKa,OAAL;AACA,eAAO,IAAP;AACH,KArBD;;AAuBA;AACA,aAASC,QAAT,CAAkBC,QAAlB,EAA4B;AACxB,eAAOP,EAAE,CAAC,oCAAD,EAAuCO,QAAvC,EAAiD,WAAjD,EAA8DC,IAA9D,CAAmE,EAAnE,CAAF,CAAP;AACH;;AAED;AACAvB,eAAWM,SAAX,CAAqBc,OAArB,GAA+B,SAASI,QAAT,GAAoB;AAC/C;AACA,YAAI,KAAKtB,OAAL,CAAaS,aAAb,KAA+B,CAAnC,EAAsC;AAClC,mBAAO,IAAP;AACH;AACD;AACA,YAAI,KAAKR,QAAL,KAAkB,CAAtB,EAAyB;AACrB,mBAAO,IAAP;AACH;;AAED;AACA,YAAI,KAAKA,QAAL,GAAgB,CAApB,EAAuB;AACnB,iBAAKsB,YAAL;AACA,iBAAKC,mBAAL;;AAEA;AACH,SALD,MAKO;AACH,iBAAKC,eAAL;AACH;AACD,eAAO,IAAP;AACH,KApBD;;AAsBA;AACA3B,eAAWM,SAAX,CAAqBqB,eAArB,GAAuC,SAASC,gBAAT,GAA4B;AAC/D,YAAIC,aAAa,IAAjB;AACA,YAAIC,QAAQT,SAAS,MAAT,CAAZ;AACA,YAAIU,QAAQV,SAAS,MAAT,CAAZ;;AAEA,YAAIW,uBAAuBjB,EAAE,OAAF,EAAWkB,QAAX,CAAoB,iCAApB,CAA3B;;AAEA;AACA,YAAI,KAAK7B,QAAL,KAAkB,CAAtB,EAAyB;AACrB0B,kBAAMG,QAAN,CAAe,UAAf;AACH,SAFD,MAEO;AACHH,kBAAMI,KAAN,CAAY,YAAM;AACdL,2BAAWM,QAAX;AACH,aAFD;AAGH;AACD,YACK,KAAKhC,QAAL,IAAiB,KAAKC,QAAL,KAAkB,KAAKD,QAAL,GAAgB,CAApD,IACC,KAAKD,OAAL,CAAaU,YAAb,IAA6B,KAAKV,OAAL,CAAaU,YAAb,GAA4B,KAAKV,OAAL,CAAaQ,OAF3E,EAGE;AACEqB,kBAAME,QAAN,CAAe,UAAf;AACH,SALD,MAKO;AACHF,kBAAMG,KAAN,CAAY,YAAM;AACdL,2BAAWO,QAAX;AACH,aAFD;AAGH;;AAED,aAAKtB,QAAL,CAAcuB,IAAd,CAAmBL,qBAAqBM,MAArB,CAA4B,CAACR,KAAD,EAAQC,KAAR,CAA5B,CAAnB;AACA;AACA,eAAO,KAAKjB,QAAZ;AACH,KA7BD;;AA+BA;AACAd,eAAWM,SAAX,CAAqBmB,YAArB,GAAoC,SAASc,aAAT,GAAyB;AACzD;AACA;AACA,YAAIV,aAAa,IAAjB;;AAEA,YAAIW,sBAAsBzB,EAAE,OAAF,EAAWkB,QAAX,CAAoB,6BAApB,CAA1B;;AAEA,YAAID,uBAAuBjB,EAAE,OAAF,EAAWkB,QAAX,CAAoB,iCAApB,CAA3B;;AAEA,YAAIQ,eAAe,SAAfA,YAAe,CAASC,EAAT,EAAa;AAC5Bb,uBAAWc,QAAX,CAAoB5B,EAAE,IAAF,EAAQI,IAAR,CAAa,MAAb,CAApB;AACH,SAFD;;AAIA,aAAK,IAAIyB,IAAI,CAAb,EAAgBA,IAAI,KAAKzC,QAAzB,EAAmCyC,KAAK,CAAxC,EAA2C;AACvC;AACA,gBAAIC,UAAUxB,SAASuB,IAAI,CAAb,EACTE,IADS,CACJ,WADI,EACSF,CADT,EAETV,KAFS,CAEHO,YAFG,CAAd;AAGA;AACA,gBAAIG,MAAM,KAAKxC,QAAf,EAAyB;AACrByC,wBAAQZ,QAAR,CAAiB,QAAjB;AACH;AACD;AACAD,iCAAqBM,MAArB,CAA4BO,OAA5B;AACH;AACD,eAAO,KAAK/B,QAAL,CAAcuB,IAAd,CAAmBG,oBAAoBH,IAApB,CAAyBL,oBAAzB,CAAnB,CAAP;AACH,KA1BD;;AA4BA;AACAhC,eAAWM,SAAX,CAAqBoB,mBAArB,GAA2C,SAASqB,oBAAT,GAAgC;AACvE;AACA,YAAIC,aAAa,KAAKlC,QAAL,CAAcmC,IAAd,CAAmB,8BAAnB,CAAjB;AACA;AACA,YAAI,CAACD,WAAWE,MAAhB,EAAwB;AACpB,mBAAO,IAAP;AACH;;AAED,YAAIC,cAAc,KAAKrC,QAAL,CAAcmC,IAAd,CAAmB,WAAnB,CAAlB;AACA,YAAIG,WAAWJ,WAAWK,KAAX,KAAqB,CAApC;AACA;AACAL,mBAAWM,UAAX,CAAsBN,WAAWM,UAAX,KAA0BH,YAAYI,QAAZ,GAAuBC,IAAjD,GAAwDJ,QAA9E;AACA,eAAO,IAAP;AACH,KAbD;;AAeA;AACApD,eAAWM,SAAX,CAAqBqC,QAArB,GAAgC,SAASA,QAAT,CAAkBc,IAAlB,EAAwB;AACpD,YAAIA,QAAQ,CAAZ,EAAe;AACXA,mBAAO,CAAP;AACH;AACD,YAAI,KAAKtD,QAAL,IAAiBsD,QAAQ,KAAKtD,QAAlC,EAA4C;AACxCsD,mBAAO,KAAKtD,QAAL,GAAgB,CAAvB;AACH;AACD,YAAIsD,SAAS,KAAKrD,QAAlB,EAA4B;AACxB,mBAAO,IAAP;AACH;;AAED;AACA,aAAKA,QAAL,GAAgBqD,IAAhB;AACA,aAAK3C,QAAL,CAAc4C,OAAd,CAAsB,wBAAtB,EAAgD,KAAKtD,QAArD;AACA;AACA,aAAKgB,OAAL;AACA,eAAO,IAAP;AACH,KAjBD;;AAmBA;AACApB,eAAWM,SAAX,CAAqB6B,QAArB,GAAgC,SAASA,QAAT,GAAoB;AAChD,eAAO,KAAKQ,QAAL,CAAc,KAAKvC,QAAL,GAAgB,CAA9B,CAAP;AACH,KAFD;;AAIA;AACAJ,eAAWM,SAAX,CAAqB8B,QAArB,GAAgC,SAASA,QAAT,GAAoB;AAChD,eAAO,KAAKO,QAAL,CAAc,KAAKvC,QAAL,GAAgB,CAA9B,CAAP;AACH,KAFD;;AAIA;AACAJ,eAAWM,SAAX,CAAqBmD,IAArB,GAA4B,SAASA,IAAT,GAAgB;AACxC,eAAO,KAAKrD,QAAZ;AACH,KAFD;;AAIA;AACAJ,eAAW2D,MAAX,GAAoB,SAASC,OAAT,CAAiB9C,QAAjB,EAA2BZ,OAA3B,EAAoC;AACpD,eAAO,IAAIF,UAAJ,CAAec,QAAf,EAAyBZ,OAAzB,CAAP;AACH,KAFD;;AAIA;AACAa,MAAE8C,EAAF,CAAK7C,MAAL,CAAY;AACRa,oBAAY,SAASiC,WAAT,CAAqB5D,OAArB,EAA8B;AACtC,gBAAI6D,iBAAiBhD,EAAEiD,SAAF,CAAYC,SAAZ,EAAuBC,KAAvB,CAA6B,CAA7B,CAArB;;AAEA;AACA,gBAAInD,EAAEoD,IAAF,CAAOjE,OAAP,MAAoB,QAAxB,EAAkC;AAC9B,uBAAO,KAAKkE,GAAL,CAAS,YAAW;AACvBpE,+BAAW2D,MAAX,CAAkB5C,EAAE,IAAF,CAAlB,EAA2Bb,OAA3B;AACA,2BAAO,IAAP;AACH,iBAHM,CAAP;AAIH;;AAED;AACA,gBAAImE,gBAAgBtD,EAAE,KAAK,CAAL,CAAF,CAApB;;AAEA,gBAAIuD,kBAAkBD,cAAclD,IAAd,CAAmBnB,WAAWM,SAAX,CAAqBC,QAAxC,CAAtB;AACA;AACA,gBAAI+D,eAAJ,EAAqB;AACjB;AACA,oBAAIvD,EAAEoD,IAAF,CAAOjE,OAAP,MAAoB,QAAxB,EAAkC;AAC9B,wBAAI2D,KAAKS,gBAAgBpE,OAAhB,CAAT;AACA,wBAAIa,EAAEoD,IAAF,CAAON,EAAP,MAAe,UAAnB,EAA+B;AAC3B,+BAAOA,GAAGU,KAAH,CAASD,eAAT,EAA0BP,cAA1B,CAAP;AACH;;AAED;AACH,iBAPD,MAOO;AACH,2BAAOO,eAAP;AACH;AACJ;AACD;AACA,mBAAOE,SAAP;AACH;AAhCO,KAAZ","file":"../../scripts/ui/pagination.js","sourcesContent":["//import $ from \"jquery\";\n// TODO:  This manipulates whatever jquery is available -- needs restructuring,\n// or removal (jquery plugins are a bad design choice for us at this point)\n// It is *only* used in the scatterplot viz, so this is safe.\n/* global $ */\n\n/** Builds (twitter bootstrap styled) pagination controls.\n *  If the totalDataSize is not null, a horizontal list of page buttons is displayed.\n *  If totalDataSize is null, two links ('Prev' and 'Next) are displayed.\n *  When pages are changed, a 'pagination.page-change' event is fired\n *      sending the event and the (0-based) page requested.\n */\n\nfunction Pagination(element, options) {\n    /** the total number of pages */\n    this.numPages = null;\n    /** the current, active page */\n    this.currPage = 0;\n    return this.init(element, options);\n}\n\n/** data key under which this object will be stored in the element */\nPagination.prototype.DATA_KEY = \"pagination\";\n/** default options */\nPagination.prototype.defaults = {\n    /** which page to begin at */\n    startingPage: 0,\n    /** number of data per page */\n    perPage: 20,\n    /** the total number of data (null == unknown) */\n    totalDataSize: null,\n    /** size of current data on current page */\n    currDataSize: null\n};\n\n/** init the control, calc numPages if possible, and render\n *  @param {jQuery} the element that will contain the pagination control\n *  @param {Object} options a map containing overrides to the pagination default options\n */\nPagination.prototype.init = function _init($element, options) {\n    options = options || {};\n    this.$element = $element;\n    this.options = $.extend(true, {}, this.defaults, options);\n\n    this.currPage = this.options.startingPage;\n    if (this.options.totalDataSize !== null) {\n        this.numPages = Math.ceil(this.options.totalDataSize / this.options.perPage);\n        // limit currPage by numPages\n        if (this.currPage >= this.numPages) {\n            this.currPage = this.numPages - 1;\n        }\n    }\n    //console.debug( 'Pagination.prototype.init:', this.$element, this.currPage );\n    //console.debug( JSON.stringify( this.options ) );\n\n    // bind to data of element\n    this.$element.data(Pagination.prototype.DATA_KEY, this);\n\n    this._render();\n    return this;\n};\n\n/** helper to create a simple li + a combo */\nfunction _make$Li(contents) {\n    return $(['<li><a href=\"javascript:void(0);\">', contents, \"</a></li>\"].join(\"\"));\n}\n\n/** render previous and next pagination buttons */\nPagination.prototype._render = function __render() {\n    // no data - no pagination\n    if (this.options.totalDataSize === 0) {\n        return this;\n    }\n    // only one page\n    if (this.numPages === 1) {\n        return this;\n    }\n\n    // when the number of pages are known, render each page as a link\n    if (this.numPages > 0) {\n        this._renderPages();\n        this._scrollToActivePage();\n\n        // when the number of pages is not known, render previous or next\n    } else {\n        this._renderPrevNext();\n    }\n    return this;\n};\n\n/** render previous and next pagination buttons */\nPagination.prototype._renderPrevNext = function __renderPrevNext() {\n    var pagination = this;\n    var $prev = _make$Li(\"Prev\");\n    var $next = _make$Li(\"Next\");\n\n    var $paginationContainer = $(\"<ul/>\").addClass(\"pagination pagination-prev-next\");\n\n    // disable if it either end\n    if (this.currPage === 0) {\n        $prev.addClass(\"disabled\");\n    } else {\n        $prev.click(() => {\n            pagination.prevPage();\n        });\n    }\n    if (\n        (this.numPages && this.currPage === this.numPages - 1) ||\n        (this.options.currDataSize && this.options.currDataSize < this.options.perPage)\n    ) {\n        $next.addClass(\"disabled\");\n    } else {\n        $next.click(() => {\n            pagination.nextPage();\n        });\n    }\n\n    this.$element.html($paginationContainer.append([$prev, $next]));\n    //console.debug( this.$element, this.$element.html() );\n    return this.$element;\n};\n\n/** render page links for each possible page (if we can) */\nPagination.prototype._renderPages = function __renderPages() {\n    // it's better to scroll the control and let the user see all pages\n    //  than to force her/him to change pages in order to find the one they want (as traditional << >> does)\n    var pagination = this;\n\n    var $scrollingContainer = $(\"<div>\").addClass(\"pagination-scroll-container\");\n\n    var $paginationContainer = $(\"<ul/>\").addClass(\"pagination pagination-page-list\");\n\n    var page$LiClick = function(ev) {\n        pagination.goToPage($(this).data(\"page\"));\n    };\n\n    for (var i = 0; i < this.numPages; i += 1) {\n        // add html5 data tag 'page' for later click event handler use\n        var $pageLi = _make$Li(i + 1)\n            .attr(\"data-page\", i)\n            .click(page$LiClick);\n        // highlight the current page\n        if (i === this.currPage) {\n            $pageLi.addClass(\"active\");\n        }\n        //console.debug( '\\t', $pageLi );\n        $paginationContainer.append($pageLi);\n    }\n    return this.$element.html($scrollingContainer.html($paginationContainer));\n};\n\n/** scroll scroll-container (if any) to show the active page */\nPagination.prototype._scrollToActivePage = function __scrollToActivePage() {\n    // scroll to show active page in center of scrollable area\n    var $container = this.$element.find(\".pagination-scroll-container\");\n    // no scroll container : don't scroll\n    if (!$container.length) {\n        return this;\n    }\n\n    var $activePage = this.$element.find(\"li.active\");\n    var midpoint = $container.width() / 2;\n    //console.debug( $container, $activePage, midpoint );\n    $container.scrollLeft($container.scrollLeft() + $activePage.position().left - midpoint);\n    return this;\n};\n\n/** go to a certain page */\nPagination.prototype.goToPage = function goToPage(page) {\n    if (page <= 0) {\n        page = 0;\n    }\n    if (this.numPages && page >= this.numPages) {\n        page = this.numPages - 1;\n    }\n    if (page === this.currPage) {\n        return this;\n    }\n\n    //console.debug( '\\t going to page ' + page )\n    this.currPage = page;\n    this.$element.trigger(\"pagination.page-change\", this.currPage);\n    //console.info( 'pagination:page-change', this.currPage );\n    this._render();\n    return this;\n};\n\n/** go to the previous page */\nPagination.prototype.prevPage = function prevPage() {\n    return this.goToPage(this.currPage - 1);\n};\n\n/** go to the next page */\nPagination.prototype.nextPage = function nextPage() {\n    return this.goToPage(this.currPage + 1);\n};\n\n/** return the current page */\nPagination.prototype.page = function page() {\n    return this.currPage;\n};\n\n// alternate constructor invocation\nPagination.create = function _create($element, options) {\n    return new Pagination($element, options);\n};\n\n// as jq plugin\n$.fn.extend({\n    pagination: function $pagination(options) {\n        var nonOptionsArgs = $.makeArray(arguments).slice(1);\n\n        // if passed an object - use that as an options map to create pagination for each selected\n        if ($.type(options) === \"object\") {\n            return this.map(function() {\n                Pagination.create($(this), options);\n                return this;\n            });\n        }\n\n        // (other invocations only work on the first element in selected)\n        var $firstElement = $(this[0]);\n\n        var previousControl = $firstElement.data(Pagination.prototype.DATA_KEY);\n        // if a pagination control was found for this element, either...\n        if (previousControl) {\n            // invoke a function on the pagination object if passed a string (the function name)\n            if ($.type(options) === \"string\") {\n                var fn = previousControl[options];\n                if ($.type(fn) === \"function\") {\n                    return fn.apply(previousControl, nonOptionsArgs);\n                }\n\n                // if passed nothing, return the previously set control\n            } else {\n                return previousControl;\n            }\n        }\n        // if there is no control already set, return undefined\n        return undefined;\n    }\n});\n"]}