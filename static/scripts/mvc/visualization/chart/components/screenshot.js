define("mvc/visualization/chart/components/screenshot",["exports"],function(e){"use strict";function t(e,t){var n=document.createElement("a");n.download=t,n.href=e,n.click()}function n(e,n){t(e.replace("image/png","image/octet-stream"),(n||"GalaxyImage")+".png")}function a(e,t,n,i){var r=e.prop("tagName").toLowerCase(),s=e.position(),o=t+s.left+parseInt(e.css("marginLeft"),10)+parseInt(e.css("borderLeftWidth"),10)+parseInt(e.css("paddingLeft"),10),c=n+s.top+parseInt(e.css("marginTop"),10)+parseInt(e.css("borderTopWidth"),10)+parseInt(e.css("paddingTop"),10);"div"==r||"span"==r?e.children().each(function(){a($(this),o,c)}):"canvas"==r&&i.drawImage(e[0],o,c)}function i(e){var t=e.$el.find(".charts-viewer-canvas");try{if(0!==t.width()&&0!==t.height()){var i=document.createElement("canvas");i.width=t.outerWidth(!0),i.height=t.outerHeight(!0);var r=i.getContext("2d");r.save(),r.fillStyle="rgb(255,255,255)",r.fillRect(0,0,i.width,i.height),r.restore(),r.translate(0,0),r.textAlign="left",r.textBaseline="top",t.children().each(function(){a($(this),0,0,r)});var s=i.toDataURL("image/png");s&&n(s,e.title)}}catch(t){console.debug("FAILED - screenshot::_canvas2png() - "+t),e.error&&e.error("Please reduce your visualization to a single panel and try again.")}}function r(e){var t=s(e),a=document.createElement("canvas"),i=a.getContext("2d"),r=new Image,o=$('<div style="display:none;"/>').append($(a));$("body").append(o),a.width=5*t.width,a.height=5*t.height,r.src="data:image/svg+xml;base64,"+window.btoa(t.string),r.onload=function(){i.drawImage(r,0,0,a.width,a.height),n(a.toDataURL("image/png"),e.title),o.remove()}}function s(e){var t=e.$el.find("svg");{if(0!=t.length||!e.error){var n=t.length,a=parseInt(t.first().css("height")),i=parseInt(t.first().css("width")),r=new XMLSerializer,s=$("<svg/>").attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:i*n,height:a}),c=0;return t.each(function(){var e=$(this).clone();o(e);var t=$('<g transform="translate('+c+', 0)">').attr("xmlns","http://www.w3.org/2000/svg");t.append(e.find("g").first()),s.append(t),c+=i}),{string:r.serializeToString(s[0]),height:a,width:i}}e.error("No SVG found. This visualization type does not support SVG/PDF export.")}}function o(e){for(var t in document.styleSheets){var n=document.styleSheets[t].cssRules;if(n)for(var a=0,i=n.length;a<i;a++)try{e.find(n[a].selectorText).each(function(e,t){t.style.cssText+=n[a].style.cssText})}catch(e){}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default={createPNG:function(e){e.$el.find("svg").length>0?r(e):i(e)},createSVG:function(e){t("data:none/none;base64,"+window.btoa(s(e).string),(e.title||"GalaxyImage")+".svg")},createPDF:function(e){var t=s(e),n={filename:"visualization",type:"application/pdf",height:t.height,width:t.width,scale:2,svg:t.string},a=$("body"),i=a.find("#viewer-form");0===i.length&&(i=$("<form>",{id:"viewer-form",method:"post",action:"http://export.highcharts.com/",display:"none"}),a.append(i)),i.empty();for(var r in n){var o=$("<input/>",{type:"hidden",name:r,value:n[r]});i.append(o)}try{i.submit()}catch(e){console.log(e)}}}});