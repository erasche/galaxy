define("mvc/workflow/workflow-connector",["exports","libs/toastr"],function(t,e){"use strict";function n(t,e){this.canvas=null,this.dragging=!1,this.inner_color="#FFFFFF",this.outer_color="#D8B365",t&&e&&this.connect(t,e)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(e);$.extend(n.prototype,{connect:function(t,e){this.handle1=t,this.handle1&&this.handle1.connect(this),this.handle2=e,this.handle2&&this.handle2.connect(this)},destroy:function(){this.handle1&&this.handle1.disconnect(this),this.handle2&&this.handle2.disconnect(this),$(this.canvas).remove()},destroyIfInvalid:function(t){this.handle1&&this.handle2&&!this.handle2.attachable(this.handle1)&&(t&&a.warning("Destroying a connection because collection type has changed."),this.destroy())},redraw:function(){var t=this.handle1,e=this.handle2,n=t&&t.isMappedOver(),a=e&&e.isMappedOver(),i=(n?"start-ribbon":"")+" "+(a?"end-ribbon":""),s=$("#canvas-container"),o=window.workflow_globals.canvas_manager.canvasZoom;this.canvas||(this.canvas=document.createElement("canvas"),s.append($(this.canvas)),this.dragging&&(this.canvas.style.zIndex="300")),this.canvas.setAttribute("handle1-id",t&&t.element.getAttribute?t.element.getAttribute("id"):""),this.canvas.setAttribute("handle2-id",e&&e.element.getAttribute?e.element.getAttribute("id"):"");var h=function(t){return($(t).offset().left-s.offset().left)/o},r=function(t){return($(t).offset().top-s.offset().top)/o};if(t&&e){var l=h(t.element)+5,c=r(t.element)+5,d=h(e.element)+5,u=r(e.element)+5,v=Math.min(l,d),f=Math.max(l,d),b=Math.min(c,u),g=Math.max(c,u),m=Math.min(Math.max(Math.abs(g-b)/2,100),300),p=v-100,w=b-100,y=f-v+200,_=g-b+200;this.canvas.style.left=p+"px",this.canvas.style.top=w+"px",this.canvas.setAttribute("width",y),this.canvas.setAttribute("height",_),this.canvas.setAttribute("class",i),l-=p,c-=w,d-=p,u-=w;this.canvas.getContext("2d");var M=null,x=null,A=1;if(n){M=[-6,-3,0,3,6];A=5}else M=[0];if(a){x=[-6,-3,0,3,6];A=5}else x=[0];for(var k=this,F=0;F<A;F++){var C=5,O=7;(M.length>1||x.length>1)&&(C=1,O=3),k.draw_outlined_curve(l,c,d,u,m,C,O,M[F%M.length],x[F%x.length])}}},draw_outlined_curve:function(t,e,n,a,i,s,o,h,r){var h=h||0,r=r||0,l=this.canvas.getContext("2d");l.lineCap="round",l.strokeStyle=this.outer_color,l.lineWidth=o,l.beginPath(),l.moveTo(t,e+h),l.bezierCurveTo(t+i,e+h,n-i,a+r,n,a+r),l.stroke(),l.strokeStyle=this.inner_color,l.lineWidth=s,l.beginPath(),l.moveTo(t,e+h),l.bezierCurveTo(t+i,e+h,n-i,a+r,n,a+r),l.stroke()}}),t.default=n});