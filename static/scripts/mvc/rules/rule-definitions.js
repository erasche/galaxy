define("mvc/rules/rule-definitions",["exports","utils/localization","pyre-to-regexp"],function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(t),u=n(a),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t){if(0==e.length)return"no columns";if(1==e.length)return"column "+t[e[0]];var a=e.map(function(e){return t[e]});return"columns "+[a.slice(0,-1).join(", "),a.slice(-1)[0]].join(" and ")},i=function(e,t){var a=[];for(var n in e)-1===t.indexOf(n)&&a.push(e[n]);return a},d=function(e,t,a,n,r){var o=void 0;try{o=(0,u.default)(String(e))}catch(e){return{error:"Invalid regular expression specified."}}var l=0;return a=a.map(function(e){var a=e[t],u=o.exec(a);return u?n?e.concat([o.pyreReplace(u[0],n)]):(r=r&&parseInt(r))?u.length!=r+1?(l++,null):e.concat(u.splice(1,u.length)):e.concat([u[0]]):(l++,null)}),l>0?{error:l+" row(s) failed to match specified regular expression."}:{data:a}},s=function(e,t){return t.reduce(function(t,a){return t.concat(e(a))},[])},c={add_column_basename:{title:(0,r.default)("Basename of Path of URL"),display:function(e,t){return"Add column using basename of column "+t[e.target_column]},init:function(e,t){e.addColumnBasenameTarget=t?t.target_column:0},save:function(e,t){t.target_column=e.addColumnBasenameTarget},apply:function(e,t,a,n){var r=e.target_column,u=d("[^/]*$",r,t);return n.push("new"),u.columns=n,u}},add_column_rownum:{title:(0,r.default)("Row Number"),display:function(e,t){return"Add column for the current row number."},init:function(e,t){e.addColumnRownumStart=t?t.start:1},save:function(e,t){t.start=parseInt(e.addColumnRownumStart)},apply:function(e,t,a,n){var r=e.start;return t=t.map(function(e){var t=e.slice();return t.push(String(r)),r+=1,t}),n.push("new"),{data:t,columns:n}}},add_column_value:{title:(0,r.default)("Fixed Value"),display:function(e,t){return"Add column for the constant value of "+e.value+"."},init:function(e,t){e.addColumnValue=t?t.value:""},save:function(e,t){t.value=e.addColumnValue},apply:function(e,t,a,n){var r=e.value;return t=t.map(function(e){var t=e.slice();return t.push(r),t}),n.push("new"),{data:t,columns:n}}},add_column_metadata:{title:(0,r.default)("Add Column from Metadata"),display:function(e,t){return"Add column for "+e.value+"."},init:function(e,t){e.addColumnMetadataValue=t?t.value:null},save:function(e,t){t.value=e.addColumnMetadataValue},apply:function(e,t,a,n){var r=e.value,u=void 0;if(0==r.indexOf("identifier")){var o=parseInt(r.substring("identifier".length));u=function(e,t){var n=e.slice();return n.push(a[t].identifiers[o]),n}}else if("tags"==r)u=function(e,t){var n=e.slice(),r=a[t].tags;return r.sort(),n.push(r.join(",")),n};else{if("hid"!=r&&"name"!=r&&"path"!=r)return{error:"Unknown metadata type ["+r+"}]"};u=function(e,t){var n=e.slice();return n.push(a[t][r]),n}}return t=t.map(u),n.push("new"),{data:t,columns:n}}},add_column_group_tag_value:{title:(0,r.default)("Add Column from Group Tag Value"),display:function(e,t){return"Add column for value of group tag "+e.value+"."},init:function(e,t){t?(e.addColumnGroupTagValueValue=t.value,e.addColumnGroupTagValueDefault=t.default_value):(e.addColumnGroupTagValueValue=null,e.addColumnGroupTagValueDefault="")},save:function(e,t){t.value=e.addColumnGroupTagValueValue,t.default_value=e.addColumnGroupTagValueDefault},apply:function(e,t,a,n){var r="group:"+e.value+":";return t=t.map(function(t,n){var u=t.slice(),o=a[n].tags;o.sort();var l=e.default_value;for(var i in o){var d=o[i];if(0==d.indexOf(r)){l=d.substr(r.length);break}}return u.push(l),u}),n.push("new"),{data:t,columns:n}}},add_column_regex:{title:(0,r.default)("Using a Regular Expression"),display:function(e,t){return"Add new column using "+e.expression+" applied to column "+t[e.target_column]},init:function(e,t){t?(e.addColumnRegexTarget=t.target_column,e.addColumnRegexExpression=t.expression,e.addColumnRegexReplacement=t.replacement,e.addColumnRegexGroupCount=t.group_count):(e.addColumnRegexTarget=0,e.addColumnRegexExpression="",e.addColumnRegexReplacement=null,e.addColumnRegexGroupCount=null);var a="global";e.addColumnRegexGroupCount?a="groups":e.addColumnRegexReplacement&&(a="replacement"),e.addColumnRegexType=a},save:function(e,t){t.target_column=e.addColumnRegexTarget,t.expression=e.addColumnRegexExpression,e.addColumnRegexReplacement&&(t.replacement=e.addColumnRegexReplacement),e.addColumnRegexGroupCount&&(t.group_count=e.addColumnRegexGroupCount)},apply:function(e,t,a,n){var r=e.target_column,u=d(e.expression,r,t,e.replacement,e.group_count);return n.push("new"),u.columns=n,u}},add_column_concatenate:{title:(0,r.default)("Concatenate Columns"),display:function(e,t){return"Concatenate column "+t[e.target_column_0]+" and column "+t[e.target_column_1]},init:function(e,t){t?(e.addColumnConcatenateTarget0=t.target_column_0,e.addColumnConcatenateTarget1=t.target_column_1):(e.addColumnConcatenateTarget0=0,e.addColumnConcatenateTarget1=0)},save:function(e,t){t.target_column_0=e.addColumnConcatenateTarget0,t.target_column_1=e.addColumnConcatenateTarget1},apply:function(e,t,a,n){var r=e.target_column_0,u=e.target_column_1;return t=t.map(function(e){var t=e.slice();return t.push(e[r]+e[u]),t}),n.push("new"),{data:t,columns:n}}},add_column_substr:{title:(0,r.default)("Keep or Trim Prefix or Suffix"),display:function(e,t){var a=e.substr_type,n=void 0;return n="keep_prefix"==a?"Keep only "+e.length+" characters from the start of column "+t[e.target_column]:"drop_prefix"==a?"Remove "+e.length+" characters from the start of column "+t[e.target_column]:"keep_suffix"==a?"Keep only "+e.length+" characters from the end of column "+t[e.target_column]:"Remove "+e.length+" characters from the end of column "+t[e.target_column],n},init:function(e,t){t?(e.addColumnSubstrTarget=t.target_column,e.addColumnSubstrLength=t.length,e.addColumnSubstrType=t.substr_type):(e.addColumnSubstrTarget=0,e.addColumnSubstrType="keep_prefix",e.addColumnSubstrLength=1)},save:function(e,t){t.target_column=e.addColumnSubstrTarget,t.length=parseInt(e.addColumnSubstrLength),t.substr_type=e.addColumnSubstrType},apply:function(e,t,a,n){var r=e.target_column,u=e.length,o=e.substr_type;return t=t.map(function(e){var t=e.slice(),a=e[r],n=0,l=a.length;return"keep_prefix"==o?l=u:"drop_prefix"==o?n=u:"keep_suffix"==o?(n=l-u)<0&&(n=0):(l-=u)<0&&(l=0),t.push(a.substr(n,l)),t}),n.push("new"),{data:t}}},remove_columns:{title:(0,r.default)("Remove Column(s)"),display:function(e,t){var a=e.target_columns;return"Remove "+l(a,t)},init:function(e,t){e.removeColumnTargets=t?t.target_columns:[]},save:function(e,t){t.target_columns=e.removeColumnTargets},apply:function(e,t,a,n){var r=e.target_columns;return t=t.map(function(e){var t=[];for(var a in e)-1==r.indexOf(parseInt(a))&&t.push(e[a]);return t}),n=i(n,r),{data:t,columns:n}}},add_filter_regex:{title:(0,r.default)("Using a Regular Expression"),display:function(e,t){return"Filter rows using regular expression "+e.expression+" on column "+t[e.target_column]},init:function(e,t){t?(e.addFilterRegexTarget=t.target_column,e.addFilterRegexExpression=t.expression,e.addFilterRegexInvert=t.invert):(e.addFilterRegexTarget=0,e.addFilterRegexExpression="",e.addFilterRegexInvert=!1)},save:function(e,t){t.target_column=e.addFilterRegexTarget,t.expression=e.addFilterRegexExpression,t.invert=e.addFilterRegexInvert},apply:function(e,t,a,n){var r,o=String(e.expression);try{r=(0,u.default)(o)}catch(e){return{error:"Invalid regular expression specified."}}var l=e.target_column,i=e.invert,d=function(e,a){var n=t[parseInt(a)];return r.exec(n[l])?!i:i};return a=a.filter(d),t=t.filter(d),{data:t,sources:a}}},add_filter_count:{title:(0,r.default)("First or Last N Rows"),display:function(e,t){var a=e.which,n=e.invert;return"first"!=a||n?"first"==a&&n?"Keep only first "+e.count+" row(s).":"last"!=a||n?"Keep only last "+e.count+" row(s).":"Filter out last "+e.count+" row(s).":"Filter out first "+e.count+" row(s)."},init:function(e,t){t?(e.addFilterCountN=parseInt(t.count),e.addFilterCountWhich=t.which,e.addFilterCountInvert=t.inverse):(e.addFilterCountN=0,e.addFilterCountWhich="first",e.addFilterCountInvert=!1)},save:function(e,t){t.count=parseInt(e.addFilterCountN),t.which=e.addFilterCountWhich,t.invert=e.addFilterCountInvert},apply:function(e,t,a,n){var r=e.count,u=e.invert,o=e.which,l=t.length,i=function(e,t){return("first"==o?t>=r:t<l-r)?!u:u};return a=a.filter(i),t=t.filter(i),{data:t,sources:a}}},add_filter_empty:{title:(0,r.default)("On Emptiness"),display:function(e,t){return"Filter rows if no value for column "+t[e.target_column]},init:function(e,t){t?(e.addFilterEmptyTarget=t.target_column,e.addFilterEmptyInvert=t.invert):(e.addFilterEmptyTarget=0,e.addFilterEmptyInvert=!1)},save:function(e,t){t.target_column=e.addFilterEmptyTarget,t.invert=e.addFilterEmptyInvert},apply:function(e,t,a,n){var r=e.target_column,u=e.invert,o=function(e,a){return t[parseInt(a)][r].length?!u:u};return a=a.filter(o),t=t.filter(o),{data:t,sources:a}}},add_filter_matches:{title:(0,r.default)("Matching a Supplied Value"),display:function(e,t){return"Filter rows with value "+e.value+" for column "+t[e.target_column]},init:function(e,t){t?(e.addFilterMatchesTarget=t.target_column,e.addFilterMatchesValue=t.value,e.addFilterMatchesInvert=t.invert):(e.addFilterMatchesTarget=0,e.addFilterMatchesValue="",e.addFilterMatchesInvert=!1)},save:function(e,t){t.target_column=e.addFilterMatchesTarget,t.value=e.addFilterMatchesValue,t.invert=e.addFilterMatchesInvert},apply:function(e,t,a,n){var r=e.target_column,u=e.invert,o=e.value,l=function(e,a){return t[parseInt(a)][r]==o?!u:u};return a=a.filter(l),t=t.filter(l),{data:t,sources:a}}},add_filter_compare:{title:(0,r.default)("By Comparing to a Numeric Value"),display:function(e,t){return"Filter rows with value "+e.compare_type+" "+e.value+" for column "+t[e.target_column]},init:function(e,t){t?(e.addFilterCompareTarget=t.target_column,e.addFilterCompareValue=t.value,e.addFilterCompareType=t.compare_type):(e.addFilterCompareTarget=0,e.addFilterCompareValue=0,e.addFilterCompareType="less_than")},save:function(e,t){t.target_column=e.addFilterCompareTarget,t.value=e.addFilterCompareValue,t.compare_type=e.addFilterCompareType},apply:function(e,t,a,n){var r=e.target_column,u=e.compare_type,o=e.value,l=function(e,a){var n=t[parseInt(a)],l=parseFloat(n[r]),i=void 0;return"less_than"==u?i=l<o:"less_than_equal"==u?i=l<=o:"greater_than"==u?i=l>o:"greater_than_equal"==u&&(i=l>=o),i};return a=a.filter(l),t=t.filter(l),{data:t,sources:a}}},sort:{title:(0,r.default)("Sort"),display:function(e,t){return"Sort on column "+t[e.target_column]},init:function(e,t){t?(e.addSortingTarget=t.target_column,e.addSortingNumeric=t.numeric):(e.addSortingTarget=0,e.addSortingNumeric=!1)},save:function(e,t){t.target_column=e.addSortingTarget,t.numeric=e.addSortingNumeric},apply:function(e,t,a,n){var r=e.target_column,u=e.numeric,o=_.zip(t,a);o.sort(function(e,t){var a=e[0][r],n=t[0][r];return u&&(a=parseFloat(a),n=parseFloat(n)),a<n?-1:n<a?1:0});var l=[],i=[];return o.map(function(e){l.push(e[0]),i.push(e[1])}),{data:l,sources:i}}},swap_columns:{title:(0,r.default)("Swap Column(s)"),display:function(e,t){return"Swap "+l([e.target_column_0,e.target_column_1],t)},init:function(e,t){t?(e.swapColumnsTarget0=t.target_column_0,e.swapColumnsTarget1=t.target_column_1):(e.swapColumnsTarget0=0,e.swapColumnsTarget1=0)},save:function(e,t){t.target_column_0=e.swapColumnsTarget0,t.target_column_1=e.swapColumnsTarget1},apply:function(e,t,a,n){var r=e.target_column_0,u=e.target_column_1;t=t.map(function(e){var t=e.slice();return t[r]=e[u],t[u]=e[r],t});var o=n[r];return n[r]=n[u],n[u]=o,{data:t,columns:n}}},split_columns:{title:(0,r.default)("Split Column(s)"),display:function(e,t){return"Duplicate each row and split up columns"},init:function(e,t){t?(e.splitColumnsTargets0=t.target_columns_0,e.splitColumnsTargets1=t.target_columns_1):(e.splitColumnsTargets0=[],e.splitColumnsTargets1=[])},save:function(e,t){t.target_columns_0=e.splitColumnsTargets0,t.target_columns_1=e.splitColumnsTargets1},apply:function(e,t,a,n){var r=e.target_columns_0,u=e.target_columns_1;return t=s(function(e){var t=[],a=[];for(var n in e)n=parseInt(n),r.indexOf(n)>-1?t.push(e[n]):u.indexOf(n)>-1?a.push(e[n]):(t.push(e[n]),a.push(e[n]));return[t,a]},t),a=s(function(e){return[e,e]},a),n=i(n,r),{data:t,sources:a,columns:n}}}},p={list_identifiers:{multiple:!0,label:(0,r.default)("List Identifier(s)"),columnHeader:(0,r.default)("List Identifier"),help:(0,r.default)("This should be a short description of the replicate, sample name, condition, etc... that describes each level of the list structure."),importType:"collections"},paired_identifier:{label:(0,r.default)("Paired-end Indicator"),columnHeader:(0,r.default)("Paired Indicator"),help:(0,r.default)("This should be set to '1', 'R1', 'forward', 'f', or 'F' to indicate forward reads, and '2', 'r', 'reverse', 'R2', 'R', or 'R2' to indicate reverse reads."),importType:"collections"},collection_name:{label:(0,r.default)("Collection Name"),help:(0,r.default)("If this is set, all rows with the same collection name will be joined into a collection and it is possible to create multiple collections at once."),modes:["raw","ftp","datasets","library_datasets"],importType:"collections"},name_tag:{label:(0,r.default)("Name Tag"),help:(0,r.default)("Add a name tag or hash tag based on the specified column value for imported datasets."),importType:"datasets",modes:["raw","ftp"]},tags:{multiple:!0,label:(0,r.default)("General Purpose Tag(s)"),help:(0,r.default)("Add a general purpose tag based on the specified column value, use : to separate key-value pairs if desired. These tags are not propagated to derived datasets the way name and group tags are."),modes:["raw","ftp","datasets","library_datasets"]},group_tags:{multiple:!0,label:(0,r.default)("Group Tag(s)"),help:(0,r.default)("Add a group tag based on the specified column value, use : to separate key-value pairs. These tags are propagated to derived datasets and may be useful for factorial experiments."),modes:["raw","ftp","datasets","library_datasets"]},name:{label:(0,r.default)("Name"),importType:"datasets"},dbkey:{label:(0,r.default)("Genome"),modes:["raw","ftp"]},file_type:{label:(0,r.default)("Type"),modes:["raw","ftp"],help:(0,r.default)("This should be the Galaxy file type corresponding to this file.")},url:{label:(0,r.default)("URL"),modes:["raw"],help:(0,r.default)("This should be a URL the file can be downloaded from.")},info:{label:(0,r.default)("Info"),help:(0,r.default)("Unstructured text associated with the dataset that shows up in the history panel, this is optional and can be whatever you would like."),modes:["raw","ftp"]},ftp_path:{label:(0,r.default)("FTP Path"),modes:["raw","ftp"],help:(0,r.default)("This should be the path to the target file to include relative to your FTP directory on the Galaxy server"),requiresFtp:!0}},m=function(e,t){return 0==e.length?t?t.map(function(e,t){return String.fromCharCode(65+t)}):[]:e[0].map(function(e,t){return String.fromCharCode(65+t)})};e.default={applyRules:function(e,t,a,n,u){var u=u||[],o=!1;for(var l in n){var i=m(e,a);u[l]=i;var d=n[l];if(d.error=null,d.warn=null,o)d.warn=(0,r.default)("Skipped due to previous errors.");else{var s=d.type,p=c[s].apply(d,e,t,a);p.error?(o=!0,d.error=p.error):(p.warn&&(d.warn=p.warn),e=p.data||e,t=p.sources||t,a=p.columns||a)}}return{data:e,sources:t,columns:a}},columnDisplay:function(e,t){var a=void 0;return 2==(a="object"==(void 0===e?"undefined":o(e))?e.map(function(e){return t[e]}):[t[e]]).length?"columns "+a[0]+" and "+a[1]:a.length>2?"columns "+a.slice(0,-1).join(", ")+", and "+a[a.length-1]:"column "+a[0]},colHeadersFor:m,RULES:c,MAPPING_TARGETS:p}});