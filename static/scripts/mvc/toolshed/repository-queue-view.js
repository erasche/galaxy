define("mvc/toolshed/repository-queue-view",["exports","backbone","underscore","utils/localization","mvc/toolshed/toolshed-model","mvc/toolshed/util"],function(e,t,o,r,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}Object.defineProperty(e,"__esModule",{value:!0});var n=l(t),d=l(o),u=a(r),p=a(i),c=a(s),_=n.View.extend({el:"#center",defaults:[],initialize:function(e){this.model=new p.default.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),this.render()},render:function(e){var t=this.templateRepoQueue,o=this.model.models;this.$el.html(t({title:(0,u.default)("Repository Installation Queue"),repositories:o,empty:(0,u.default)("No repositories in queue."),queue:c.default.queueLength()})),$("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var e=this;$(".install_one").on("click",function(t){var o=e.loadFromQueue($(t.target).attr("data-repokey"));e.installFromQueue(o,$(t.target).attr("data-repokey"))}),$(".remove_one").on("click",function(e){var t=$(e.target).attr("data-repokey"),o=JSON.parse(window.localStorage.repositories);if(o.hasOwnProperty(t)){var r=o[t].repository.id;delete o[t],$("#queued_repository_"+r).remove()}window.localStorage.repositories=JSON.stringify(o)}),$("#clear_queue").on("click",function(){window.localStorage.repositories="{}"}),$("#from_workflow").on("click",function(){n.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(e,t){var o={};o.install_tool_dependencies=e.install_tool_dependencies,o.install_repository_dependencies=e.install_repository_dependencies,o.install_resolver_dependencies=e.install_resolver_dependencies,o.tool_panel_section=e.tool_panel_section,o.shed_tool_conf=e.shed_tool_conf,o.repositories=JSON.stringify([[e.repository.id,e.changeset_revision]]),o.tool_shed_repository_ids=JSON.stringify([e.repository.id]),o.tool_shed_url=t.split("|")[0],o.changeset=e.changeset_revision;var r=Galaxy.root+"api/tool_shed_repositories/install?async=True";if($("#queued_repository_"+e.repository.id).remove(),window.localStorage.repositories){void 0===t&&(t=c.default.queueKey(e));var i=JSON.parse(window.localStorage.repositories);i.hasOwnProperty(t)&&(delete i[t],window.localStorage.repositories=JSON.stringify(i))}$.post(r,o,function(e){var t=JSON.parse(e),o="status/r/"+t.repositories.join("|");$.post(Galaxy.root+"admin_toolshed/install_repositories",t,function(e){console.log("Initializing repository installation succeeded")}),n.history.navigate(o,{trigger:!0,replace:!0})})},loadFromQueue:function(e){var t=JSON.parse(window.localStorage.repositories);return t.hasOwnProperty(e)?t[e]:this.defaults},templateRepoQueue:d.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %><a class="ml-auto" href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% if (repositories.length > 0) { %>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","<% } else { %>",'<tr><td colspan="6"><%= empty %></td></tr>',"<% } %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))});e.default={RepoQueueView:_}});